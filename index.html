<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOGISTICS AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--gold:#FFD700;--neon-blue:#00D4FF;--neon-green:#00FF88;--neon-red:#FF3366;--neon-orange:#FF8C00;--neon-purple:#BF00FF;--bg:#050510;--ease:cubic-bezier(.23,1,.32,1)}
html,body{width:100%;height:100%;min-height:100vh;background:var(--bg);color:#fff;font-family:'Rajdhani',sans-serif;overflow:hidden}
.sf{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse at 20% 50%,rgba(0,80,150,.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(80,0,150,.15) 0%,transparent 50%),var(--bg)}
.spots{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.spot{position:absolute;top:-200px;width:6px;height:110vh;background:linear-gradient(to bottom,rgba(255,255,255,.1) 0%,transparent 100%);transform-origin:top center;filter:blur(12px)}
.spot:nth-child(1){left:15%;animation:s1 8s ease-in-out infinite}
.spot:nth-child(2){left:40%;animation:s2 11s ease-in-out infinite 2s}
.spot:nth-child(3){left:68%;animation:s3 9s ease-in-out infinite 1s}
.spot:nth-child(4){left:85%;animation:s4 12s ease-in-out infinite 3s}
@keyframes s1{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(18deg)}}
@keyframes s2{0%,100%{transform:rotate(25deg)}50%{transform:rotate(-18deg)}}
@keyframes s3{0%,100%{transform:rotate(-15deg)}50%{transform:rotate(22deg)}}
@keyframes s4{0%,100%{transform:rotate(20deg)}50%{transform:rotate(-25deg)}}
#flash{position:fixed;inset:0;z-index:9999;pointer-events:none;opacity:0;transition:opacity .1s}
#flash.g{background:rgba(0,255,136,.35)}#flash.r{background:rgba(255,51,102,.35)}#flash.on{opacity:1}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 32px;border:none;border-radius:10px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:700;font-size:14px;letter-spacing:2px;text-transform:uppercase;transition:all .3s var(--ease);position:relative}
.btn:active{transform:scale(.97)}
.btn-gold{background:linear-gradient(135deg,#7a5900,#FFD700,#7a5900);color:#000;box-shadow:0 0 20px rgba(255,215,0,.5),0 4px 15px rgba(0,0,0,.4)}
.btn-gold:hover{box-shadow:0 0 45px rgba(255,215,0,.9),0 4px 20px rgba(0,0,0,.5);transform:translateY(-3px)}
.btn-blue{background:linear-gradient(135deg,#004466,#00D4FF,#004466);color:#fff;box-shadow:0 0 20px rgba(0,212,255,.35),0 4px 15px rgba(0,0,0,.4)}
.btn-blue:hover{box-shadow:0 0 45px rgba(0,212,255,.8),0 4px 20px rgba(0,0,0,.5);transform:translateY(-3px)}
.btn-lg{padding:20px 52px;font-size:18px;letter-spacing:3px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important;box-shadow:none!important}
.neon-gold{color:var(--gold);text-shadow:0 0 15px var(--gold),0 0 40px var(--gold),0 0 90px rgba(255,215,0,.4)}
.neon-blue{color:var(--neon-blue);text-shadow:0 0 15px var(--neon-blue),0 0 40px var(--neon-blue)}
.confetti-piece{position:fixed;top:-20px;z-index:9998;border-radius:2px;animation:cf linear forwards;pointer-events:none}
@keyframes cf{0%{transform:translateX(0) rotate(0deg) translateY(0);opacity:1}85%{opacity:1}100%{transform:translateX(var(--dx)) rotate(720deg) translateY(110vh);opacity:0}}
.firework{position:fixed;pointer-events:none;z-index:9997;border-radius:50%;animation:fw 1s var(--ease) forwards}
@keyframes fw{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--fx),var(--fy)) scale(0);opacity:0}}
/* LIVE BADGE */
.lbadge{display:inline-flex;align-items:center;gap:8px;background:rgba(255,51,102,.15);border:1px solid var(--neon-red);border-radius:4px;padding:4px 14px;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;color:var(--neon-red);letter-spacing:2px}
.ldot{width:8px;height:8px;border-radius:50%;background:var(--neon-red);animation:blink 1s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}
/* APP CONTAINER */
#app{position:relative;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;z-index:10}
/* SCREENS */
.screen{display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:24px;padding:30px;width:100%}

/* INTRO */
#intro-screen{animation:fadeUp .8s var(--ease) both}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.show-sub{font-family:'Orbitron',sans-serif;font-size:clamp(9px,1.5vw,13px);letter-spacing:6px;color:var(--neon-blue);margin-bottom:8px}
.show-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(58px,12vw,130px);line-height:.85;color:var(--gold);letter-spacing:4px;text-shadow:0 0 20px var(--gold),0 0 60px var(--gold),0 0 120px rgba(255,215,0,.4);animation:breath 3s ease-in-out infinite}
@keyframes breath{0%,100%{text-shadow:0 0 20px var(--gold),0 0 60px var(--gold)}50%{text-shadow:0 0 40px var(--gold),0 0 100px var(--gold),0 0 200px rgba(255,215,0,.5)}}
.show-tag{font-family:'Rajdhani',sans-serif;font-size:clamp(12px,2vw,19px);letter-spacing:4px;color:rgba(255,255,255,.5);margin-top:10px}
.divr{width:260px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);position:relative;margin:4px auto}
.divr::after{content:'‚óÜ';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:var(--gold);font-size:12px;background:var(--bg);padding:0 8px}
.intro-btns{display:flex;gap:18px;flex-wrap:wrap;justify-content:center}
#wait-msg{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--neon-orange);display:none}

/* SPIN */
#spin-screen{max-width:700px}
.spin-ttl{font-family:'Bebas Neue',sans-serif;font-size:clamp(32px,6vw,64px);color:var(--neon-blue);text-shadow:0 0 20px var(--neon-blue);letter-spacing:4px}
.spin-sub{font-family:'Rajdhani',sans-serif;font-size:16px;color:rgba(255,255,255,.6);letter-spacing:2px}
.wheel-wrap{position:relative;width:min(380px,76vw);height:min(380px,76vw)}
#wcanvas{width:100%;height:100%;filter:drop-shadow(0 0 24px rgba(0,212,255,.5));transition:transform 5s cubic-bezier(.17,.67,.12,.99)}
.wheel-ptr{position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:28px solid var(--gold);filter:drop-shadow(0 0 8px var(--gold));z-index:10}
.wheel-ctr{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:46px;height:46px;border-radius:50%;background:radial-gradient(circle,#fff 0%,var(--neon-blue) 60%,var(--bg) 100%);box-shadow:0 0 20px var(--neon-blue);z-index:11}
#spin-msg{font-family:'Orbitron',sans-serif;font-size:15px;color:var(--gold);min-height:52px;display:flex;align-items:center;justify-content:center;text-align:center;padding:0 16px}
#already-spun-msg{font-family:'Rajdhani',sans-serif;font-size:16px;color:rgba(255,255,255,.6);letter-spacing:1px;display:none}

/* LOBBY */
#lobby-screen{max-width:700px}
.lobby-title{font-family:'Bebas Neue',sans-serif;font-size:clamp(36px,7vw,80px);color:var(--gold);text-shadow:0 0 20px var(--gold)}
.teams-grid{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
.t-chip{padding:10px 20px;border-radius:8px;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:16px;background:rgba(0,212,255,.06);border:1px solid rgba(0,212,255,.25);transition:all .3s}
.t-chip.joined{background:rgba(0,255,136,.08);border-color:rgba(0,255,136,.4);color:var(--neon-green)}
#lobby-status{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:rgba(255,255,255,.4)}

/* GAME */
#game-screen{flex-direction:column;width:100vw;height:100vh;overflow-y:auto;padding:12px;gap:10px;align-items:stretch}
.shdr{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:rgba(0,0,0,.55);border-radius:10px;border:1px solid rgba(0,212,255,.15)}
.slogo{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--gold);letter-spacing:3px}
.sround{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);letter-spacing:3px}
.ann{background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.2);padding:8px 18px;text-align:center;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--gold);border-radius:6px;min-height:34px;display:flex;align-items:center;justify-content:center}
.sbody{display:grid;grid-template-columns:1fr 265px;gap:10px;flex:1}
@media(max-width:860px){.sbody{grid-template-columns:1fr}}
.smain{display:flex;flex-direction:column;gap:10px}
.tbox{text-align:center;padding:18px;border-radius:12px;background:rgba(0,0,0,.5);border:1px solid rgba(0,212,255,.15)}
.tlbl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-bottom:3px}
.tnum{font-family:'Orbitron',sans-serif;font-weight:900;font-size:72px;line-height:1;color:var(--neon-blue);text-shadow:0 0 20px var(--neon-blue);transition:color .3s}
.tnum.warn{color:var(--neon-orange);animation:tp .5s ease-in-out infinite}
.tnum.dang{color:var(--neon-red);animation:tp .25s ease-in-out infinite}
@keyframes tp{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
.qpanel{padding:22px 26px;border-radius:14px;background:rgba(5,10,35,.9);border:1px solid rgba(0,212,255,.25)}
.qnum{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:8px}
.qtext{font-family:'Rajdhani',sans-serif;font-size:clamp(15px,2.2vw,22px);font-weight:600;line-height:1.4;margin-bottom:16px}
.qopts{display:grid;grid-template-columns:1fr 1fr;gap:7px}
@media(max-width:600px){.qopts{grid-template-columns:1fr}}
.qopt{padding:11px 14px;border-radius:8px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;display:flex;gap:9px;align-items:center;transition:all .3s}
.qopt.cr{background:rgba(0,255,136,.18);border-color:var(--neon-green);box-shadow:0 0 18px rgba(0,255,136,.3)}
.qopt.wr{background:rgba(255,51,102,.1);border-color:rgba(255,51,102,.25)}
.oltr{font-family:'Orbitron',sans-serif;font-size:10px;font-weight:900;color:var(--neon-blue);min-width:17px}
.qopt.cr .oltr{color:var(--neon-green)}
.abanner{padding:11px 16px;border-radius:9px;display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,.4);border:1px solid rgba(0,212,255,.12)}
.albl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.4)}
.aname{font-family:'Rajdhani',sans-serif;font-size:19px;font-weight:700}
.astatus{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon-blue)}
.sidebar{display:flex;flex-direction:column;gap:9px}
.bboard{padding:12px;border-radius:11px;background:rgba(0,0,0,.4);border:1px solid rgba(255,215,0,.18)}
.btitle{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--gold);margin-bottom:9px}
.brow{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-radius:5px;margin-bottom:3px;background:rgba(255,255,255,.03);font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:600;transition:all .3s}
.brow.hb{background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.2)}
.bamt{font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold);font-weight:700}
.lbboard{padding:12px;border-radius:11px;background:rgba(0,0,0,.4);border:1px solid rgba(0,212,255,.12);flex:1}
.lbtitle{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:9px}
.lbrow{display:flex;align-items:center;gap:8px;padding:7px 9px;border-radius:7px;margin-bottom:4px;background:rgba(255,255,255,.03);transition:all .4s}
.lbrow.at{background:rgba(0,212,255,.09);border:1px solid rgba(0,212,255,.35)}
.lbrank{font-family:'Orbitron',sans-serif;font-size:15px;color:rgba(255,255,255,.4);min-width:26px}
.lbname{flex:1;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px}
.lbmoney{font-family:'Orbitron',sans-serif;font-weight:700;font-size:11px;color:var(--gold)}
.wl{display:inline-flex;align-items:center;padding:2px 7px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:8px;font-weight:700}
.ww{background:rgba(0,255,136,.15);color:var(--neon-green);border:1px solid rgba(0,255,136,.3)}
.wloss{background:rgba(255,51,102,.12);color:var(--neon-red);border:1px solid rgba(255,51,102,.28)}

/* WINNER */
#winner-screen{height:100%;max-width:none}
.wtrophy{font-size:80px;animation:tb 1s var(--ease) infinite}
@keyframes tb{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-16px) scale(1.12)}}
.wname{font-family:'Bebas Neue',sans-serif;font-size:clamp(50px,11vw,120px);color:var(--gold);text-shadow:0 0 30px var(--gold),0 0 80px var(--gold);animation:wp 1.5s ease-in-out infinite}
@keyframes wp{0%,100%{text-shadow:0 0 30px var(--gold),0 0 80px var(--gold)}50%{text-shadow:0 0 60px var(--gold),0 0 150px var(--gold),0 0 250px rgba(255,215,0,.3)}}
.wamount{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(22px,4vw,46px);color:var(--neon-green);text-shadow:0 0 20px var(--neon-green)}
.wsub{font-family:'Rajdhani',sans-serif;font-size:17px;color:rgba(255,255,255,.55);letter-spacing:3px}
</style>
</head>
<body>
<div class="sf"></div>
<div class="spots"><div class="spot"></div><div class="spot"></div><div class="spot"></div><div class="spot"></div></div>
<div id="flash"></div>
<div id="app">

<!-- INTRO -->
<div id="intro-screen" class="screen" style="display:flex">
  <div>
    <div class="show-sub">SEASON 1 ‚óÜ LIVE BROADCAST</div>
    <div class="show-title neon-gold">LOGISTICS<br>AUCTION<br>SHOW</div>
    <div class="show-tag">KNOWLEDGE ¬∑ STRATEGY ¬∑ FORTUNE</div>
  </div>
  <div class="divr"></div>
  <div class="intro-btns">
    <button class="btn btn-gold btn-lg" id="join-btn">‚ñ∂ JOIN THE SHOW</button>
    <button class="btn btn-blue" id="admin-btn">‚öô ADMIN PANEL</button>
  </div>
  <div class="lbadge"><div class="ldot"></div> LIVE</div>
  <div id="wait-msg">‚è≥ WAITING FOR ADMIN TO START THE SHOW...</div>
</div>

<!-- SPIN -->
<div id="spin-screen" class="screen">
  <div class="spin-ttl neon-blue">TEAM ASSIGNMENT</div>
  <div class="spin-sub">SPIN THE WHEEL TO CLAIM YOUR TEAM</div>
  <div class="wheel-wrap">
    <div class="wheel-ptr"></div>
    <canvas id="wcanvas" width="380" height="380"></canvas>
    <div class="wheel-ctr"></div>
  </div>
  <div id="spin-msg">Press SPIN to claim your team!</div>
  <button class="btn btn-gold btn-lg" id="spin-btn">üé∞ SPIN THE WHEEL</button>
  <div id="already-spun-msg">‚úÖ You have already claimed a team on this device.</div>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen">
  <div class="lobby-title neon-gold">TEAMS READY</div>
  <div style="font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;color:var(--neon-blue)">WAITING FOR SHOW TO BEGIN</div>
  <div class="teams-grid" id="lobby-grid"></div>
  <div id="lobby-status"></div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="shdr">
    <div class="slogo">üèÜ LOGISTICS AUCTION SHOW</div>
    <div class="lbadge"><div class="ldot"></div> LIVE</div>
    <div class="sround" id="sround">ROUND 1</div>
  </div>
  <div class="ann" id="sann">WELCOME TO THE LOGISTICS AUCTION SHOW ¬∑ BET SMART ¬∑ WIN BIG</div>
  <div class="sbody">
    <div class="smain">
      <div class="tbox"><div class="tlbl">TIME REMAINING</div><div class="tnum" id="stimer">--</div></div>
      <div class="qpanel">
        <div class="qnum" id="sqnum">WAITING FOR QUESTION</div>
        <div class="qtext" id="sqtext">Waiting for admin to select a question...</div>
        <div class="qopts" id="sqopts"></div>
      </div>
      <div class="abanner">
        <div><div class="albl">ACTIVE TEAM</div><div class="aname" id="sateam">‚Äî</div></div>
        <div class="astatus" id="sastatus">BETTING PHASE</div>
      </div>
    </div>
    <div class="sidebar">
      <div class="bboard"><div class="btitle">üí∞ AUCTION BETS</div><div id="sbets"></div></div>
      <div class="lbboard"><div class="lbtitle">üèÜ LEADERBOARD</div><div id="slb"></div></div>
    </div>
  </div>
</div>

<!-- WINNER -->
<div id="winner-screen" class="screen">
  <div style="font-family:'Orbitron',sans-serif;font-size:13px;letter-spacing:6px;color:var(--neon-blue)">üéâ CONGRATULATIONS üéâ</div>
  <div class="wtrophy">üèÜ</div>
  <div class="wname" id="wname">TEAM NAME</div>
  <div class="wsub">WINNER OF THE LOGISTICS AUCTION SHOW</div>
  <div class="wamount" id="wamount">$0</div>
  <button class="btn btn-gold btn-lg" id="replay-btn">üîÑ PLAY AGAIN</button>
</div>

</div>
<script>
// ‚îÄ‚îÄ‚îÄ SHARED ENGINE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SK='LAS_STATE';
const DQ=[
  {id:'q1',text:'What does "ETA" stand for in logistics?',options:['Estimated Time of Arrival','Electronic Tracking Agent','Express Transport Authorization','Enhanced Transit Algorithm'],correct:0},
  {id:'q2',text:'Which shipping term means the seller bears all risks until goods reach the buyer\'s destination?',options:['FOB Origin','CIF','EXW','DDP'],correct:3},
  {id:'q3',text:'What is the maximum weight allowed for a standard 20-foot intermodal shipping container?',options:['24,000 kg','28,000 kg','33,000 kg','38,000 kg'],correct:0},
  {id:'q4',text:'In "Last Mile" delivery, what does "last mile" refer to?',options:['The final 1-mile drive','Delivery from hub to end customer','International customs clearance','Warehouse-to-port transport'],correct:1},
  {id:'q5',text:'Which inventory method assumes the first item received is the first sold?',options:['LIFO','FIFO','JIT','ABC Analysis'],correct:1},
  {id:'q6',text:'What does 3PL stand for in supply chain management?',options:['Third-Party Logistics','Three-Point Loading','Triple Parcel Layer','Tri-Phase Logistics'],correct:0},
  {id:'q7',text:'Which document is required for all international ocean freight shipments?',options:['Air Waybill','Bill of Lading','Packing Slip','Purchase Order'],correct:1},
  {id:'q8',text:'What is the total time from order placement to customer delivery called?',options:['Transit Time','Lead Time','Cycle Time','Processing Time'],correct:1},
  {id:'q9',text:'Which technology uses radio waves to automatically identify and track inventory?',options:['GPS','NFC','RFID','Barcode'],correct:2},
  {id:'q10',text:'What is a "cross-dock" operation in logistics?',options:['Loading cargo across borders','Transferring goods from inbound to outbound without storage','A dock shared between two warehouses','Overnight freight handling at airports'],correct:1}
];
function initSt(){return{phase:'lobby',teams:[],questions:JSON.parse(JSON.stringify(DQ)),currentQuestionIndex:-1,activeTeam:null,timerDuration:30,timerRemaining:30,timerRunning:false,timerStartedAt:null,gameStarted:false,announcement:'',round:0,bets:{},bettingOpen:false,selectedAnswer:null,lastResult:null,winner:null,assignedDevices:[],version:0}}
class SM{
  constructor(){this.s=null;this.ls=[];this.ch=null;this.did=this.gid();this.init()}
  gid(){let i=sessionStorage.getItem('LAS_DID');if(!i){i='d'+Math.random().toString(36).substr(2,9);sessionStorage.setItem('LAS_DID',i)}return i}
  init(){
    const sv=localStorage.getItem(SK);
    if(sv){try{this.s=JSON.parse(sv)}catch{this.s=initSt()}}else{this.s=initSt();this.save()}
    if(typeof BroadcastChannel!=='undefined'){this.ch=new BroadcastChannel('LAS');this.ch.onmessage=e=>{if(e.data&&e.data.t==='SU'&&e.data.s.version>this.s.version){this.s=e.data.s;this.notify()}}}
    window.addEventListener('storage',e=>{if(e.key===SK&&e.newValue){try{const n=JSON.parse(e.newValue);if(n.version>this.s.version){this.s=n;this.notify()}}catch{}}});
  }
  save(){localStorage.setItem(SK,JSON.stringify(this.s))}
  bcast(){if(this.ch)this.ch.postMessage({t:'SU',s:this.s})}
  notify(){this.ls.forEach(f=>f(this.s))}
  get(){return this.s}
  update(u){this.s={...this.s,...u,version:this.s.version+1};this.save();this.bcast();this.notify()}
  sub(f){this.ls.push(f)}
  reset(){this.s=initSt();this.s.questions=JSON.parse(JSON.stringify(DQ));this.save();this.bcast();this.notify()}
}
class Aud{
  constructor(){this.c=null}
  gc(){if(!this.c)try{this.c=new(window.AudioContext||window.webkitAudioContext)()}catch{}return this.c}
  t(f,tp,d,v=.3,st=0){const c=this.gc();if(!c)return;const o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.type=tp;o.frequency.value=f;g.gain.setValueAtTime(v,c.currentTime+st);g.gain.exponentialRampToValueAtTime(.001,c.currentTime+st+d);o.start(c.currentTime+st);o.stop(c.currentTime+st+d)}
  correct(){[523,659,784,1047].forEach((f,i)=>this.t(f,'sine',.3,.4,i*.1))}
  wrong(){[300,200,150].forEach((f,i)=>this.t(f,'sawtooth',.4,.5,i*.15))}
  victory(){[523,659,784,1047,1319,1568].forEach((f,i)=>this.t(f,'sine',.5,.4,i*.12));setTimeout(()=>[523,659,784,1047,1319,1568].forEach((f,i)=>this.t(f*1.5,'sine',.3,.3,i*.08)),800)}
  tick(){this.t(800,'sine',.1,.2)}
}
function confetti(n=140){const cols=['#FFD700','#00D4FF','#BF00FF','#00FF88','#FF3366','#FF8C00','#fff'];for(let i=0;i<n;i++)setTimeout(()=>{const el=document.createElement('div');el.className='confetti-piece';const dx=(Math.random()-.5)*400;el.style.cssText=`left:${Math.random()*innerWidth}px;background:${cols[Math.floor(Math.random()*cols.length)]};width:${6+Math.random()*10}px;height:${10+Math.random()*14}px;--dx:${dx}px;animation-duration:${2+Math.random()*2}s;animation-delay:${Math.random()*.4}s;`;document.body.appendChild(el);setTimeout(()=>el.remove(),5500);},i*12)}
function flashScr(c){const el=document.getElementById('flash');el.className=`${c} on`;setTimeout(()=>el.classList.remove('on'),250)}
function $m(v){return'$'+Number(v).toLocaleString('en-US')}
function esc(s){if(typeof s!=='string')return'';return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

const S=new SM();const A=new Aud();

// ‚îÄ‚îÄ‚îÄ INDEX PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let curPhase=null,wRot=0,lastRes=null;

function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='flex';
}

function render(st){
  const p=st.phase;
  if(p===curPhase){updatePhase(st);return}
  curPhase=p;
  if(p==='lobby'){showScreen('intro-screen');if(st.gameStarted)document.getElementById('wait-msg').style.display='block'}
  else if(p==='spin'){showScreen('spin-screen');initSpin(st)}
  else if(p==='pregame'){showScreen('lobby-screen');updateLobby(st)}
  else if(p==='game'){showScreen('game-screen');updateGame(st)}
  else if(p==='reveal'){showScreen('winner-screen');showWinner(st)}
}
function updatePhase(st){
  if(st.phase==='game')updateGame(st);
  if(st.phase==='pregame')updateLobby(st);
  if(st.phase==='lobby'&&st.gameStarted)document.getElementById('wait-msg').style.display='block';
}

// Button events
document.getElementById('join-btn').onclick=function(){
  const st=S.get();
  if(st.phase==='spin'){showScreen('spin-screen');curPhase='spin';initSpin(st)}
  else if(st.phase==='pregame'){showScreen('lobby-screen');curPhase='pregame';updateLobby(st)}
  else if(st.phase==='game'){showScreen('game-screen');curPhase='game';updateGame(st)}
  else document.getElementById('wait-msg').style.display='block';
};
document.getElementById('admin-btn').onclick=function(){window.open('admin.html','_blank')};
document.getElementById('replay-btn').onclick=function(){S.reset();localStorage.removeItem('LAS_SPUN_'+S.did);location.reload()};
document.getElementById('spin-btn').onclick=doSpin;

// SPIN
function initSpin(st){
  drawWheel(st.teams||[]);
  const spun=localStorage.getItem('LAS_SPUN_'+S.did);
  if(spun){
    document.getElementById('spin-btn').style.display='none';
    document.getElementById('already-spun-msg').style.display='block';
    document.getElementById('spin-msg').textContent='‚úÖ You joined as: '+spun;
  }
}
function drawWheel(teams){
  const c=document.getElementById('wcanvas');if(!c)return;
  const ctx=c.getContext('2d'),W=c.width,H=c.height,cx=W/2,cy=H/2,r=W/2-10;
  ctx.clearRect(0,0,W,H);
  if(!teams.length){ctx.fillStyle='rgba(0,212,255,.15)';ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.fill();ctx.fillStyle='#fff';ctx.font='bold 14px Orbitron,sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('NO TEAMS',cx,cy);return}
  const sa=Math.PI*2/teams.length;
  const cols=['#FF3366','#00D4FF','#FFD700','#BF00FF','#00FF88','#FF8C00','#00BFFF','#FF69B4','#7FFF00','#DC143C'];
  teams.forEach((t,i)=>{
    const a=i*sa-Math.PI/2,b=a+sa;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,a,b);ctx.closePath();
    ctx.fillStyle=cols[i%cols.length];ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,.5)';ctx.lineWidth=2;ctx.stroke();
    ctx.save();ctx.translate(cx,cy);ctx.rotate(a+sa/2);
    ctx.textAlign='right';ctx.fillStyle='rgba(0,0,0,.85)';
    ctx.font=`bold ${Math.min(13,160/teams.length)}px Rajdhani,sans-serif`;
    ctx.fillText(t.name.length>10?t.name.substr(0,9)+'‚Ä¶':t.name,r-10,5);ctx.restore();
  });
  ctx.beginPath();ctx.arc(cx,cy,26,0,Math.PI*2);ctx.fillStyle='#0a0a1f';ctx.fill();
  ctx.strokeStyle='rgba(0,212,255,.6)';ctx.lineWidth=3;ctx.stroke();
}
function doSpin(){
  const st=S.get();
  if(!st.teams||!st.teams.length){document.getElementById('spin-msg').textContent='‚ö† No teams yet. Wait for admin.';return}
  const spun=localStorage.getItem('LAS_SPUN_'+S.did);
  if(spun){document.getElementById('spin-msg').textContent='‚úÖ Already assigned: '+spun;return}
  const assigned=(st.assignedDevices||[]).map(d=>d.teamName);
  const avail=st.teams.filter(t=>!assigned.includes(t.name));
  if(!avail.length){document.getElementById('spin-msg').textContent='‚ö† All teams taken!';return}
  document.getElementById('spin-btn').disabled=true;
  const picked=avail[Math.floor(Math.random()*avail.length)];
  const idx=st.teams.findIndex(t=>t.name===picked.name);
  const sliceAngle=360/st.teams.length;
  const target=360-(idx*sliceAngle+sliceAngle/2);
  wRot=5*360+Math.floor(Math.random()*360)+target;
  document.getElementById('wcanvas').style.transform=`rotate(${wRot}deg)`;
  document.getElementById('spin-msg').textContent='üé∞ SPINNING...';
  setTimeout(()=>{
    S.update({assignedDevices:[...(st.assignedDevices||[]),{deviceId:S.did,teamName:picked.name}]});
    localStorage.setItem('LAS_SPUN_'+S.did,picked.name);
    document.getElementById('spin-msg').innerHTML=`<span style="color:var(--gold)">üèÜ YOU ARE: ${picked.name.toUpperCase()}</span>`;
    document.getElementById('spin-btn').style.display='none';
    document.getElementById('already-spun-msg').style.display='block';
    setTimeout(()=>location.href=`team.html?team=${encodeURIComponent(picked.name)}`,2500);
  },5200);
}

// LOBBY
function updateLobby(st){
  const asgn=(st.assignedDevices||[]).map(d=>d.teamName);
  document.getElementById('lobby-grid').innerHTML=(st.teams||[]).map(t=>`<div class="t-chip ${asgn.includes(t.name)?'joined':''}">${asgn.includes(t.name)?'‚úÖ':'‚è≥'} ${esc(t.name)}</div>`).join('');
  document.getElementById('lobby-status').textContent=`${asgn.length} / ${(st.teams||[]).length} teams joined`;
}

// GAME
function getRem(st){let r=st.timerRemaining;if(st.timerRunning&&st.timerStartedAt)r=Math.max(0,st.timerRemaining-(Date.now()-st.timerStartedAt)/1000);return r}
function updateGame(st){
  document.getElementById('sround').textContent='ROUND '+(st.round||1);
  if(st.announcement)document.getElementById('sann').textContent=st.announcement;
  const rem=getRem(st),secs=Math.ceil(rem);
  const te=document.getElementById('stimer');
  te.textContent=secs>0?secs:'00';
  te.className='tnum'+(secs<=3?' dang':secs<=5?' warn':'');
  document.getElementById('sateam').textContent=st.activeTeam||'‚Äî';
  document.getElementById('sastatus').textContent=st.bettingOpen?'üîì BETTING OPEN':st.activeTeam?'‚ö° ANSWERING':'WAITING...';
  const qi=st.currentQuestionIndex;
  if(qi>=0&&st.questions&&st.questions[qi]){
    const q=st.questions[qi];
    document.getElementById('sqnum').textContent=`QUESTION ${qi+1} OF ${st.questions.length}`;
    document.getElementById('sqtext').textContent=q.text;
    document.getElementById('sqopts').innerHTML=q.options.map((o,i)=>{let cl='qopt';if(st.lastResult){if(i===q.correct)cl+=' cr';else if(i===st.selectedAnswer&&i!==q.correct)cl+=' wr'}return`<div class="${cl}"><span class="oltr">${'ABCD'[i]}</span>${esc(o)}</div>`}).join('');
  }else{document.getElementById('sqnum').textContent='WAITING FOR QUESTION';document.getElementById('sqtext').textContent='Waiting for admin to select a question...';document.getElementById('sqopts').innerHTML=''}
  document.getElementById('sbets').innerHTML=(st.teams||[]).map(t=>{const b=st.bets&&st.bets[t.name];return`<div class="brow ${b?'hb':''}"><span>${esc(t.name)}</span>${b?`<span class="bamt">${$m(b)}</span>`:`<span style="color:rgba(255,255,255,.3);font-size:10px">‚Äî</span>`}</div>`}).join('');
  const sorted=[...(st.teams||[])].sort((a,b)=>b.money-a.money);
  document.getElementById('slb').innerHTML=sorted.map((t,i)=>{const at=st.activeTeam===t.name;return`<div class="lbrow ${at?'at':''}"><div class="lbrank">#${i+1}</div><div style="flex:1"><div class="lbname" style="${at?'color:var(--neon-blue)':''}">${esc(t.name)}</div><div style="display:flex;gap:3px;margin-top:2px"><span class="wl ww">W:${t.wins||0}</span><span class="wl wloss">L:${t.losses||0}</span></div></div><div class="lbmoney">${$m(t.money)}</div></div>`}).join('');
  if(st.lastResult&&st.lastResult!==lastRes){lastRes=st.lastResult;flashScr(st.lastResult.correct?'g':'r');if(st.lastResult.correct)A.correct();else A.wrong()}
}

// WINNER
function showWinner(st){
  if(st.winner){document.getElementById('wname').textContent=st.winner.name.toUpperCase();document.getElementById('wamount').textContent=$m(st.winner.money)}
  confetti(200);A.victory();
  const cols=['#FFD700','#00D4FF','#BF00FF','#00FF88','#FF3366'];
  for(let i=0;i<50;i++)setTimeout(()=>{const el=document.createElement('div');el.className='firework';el.style.cssText=`left:${Math.random()*innerWidth}px;top:${Math.random()*innerHeight*.8}px;background:${cols[Math.floor(Math.random()*cols.length)]};width:${4+Math.random()*8}px;height:${4+Math.random()*8}px;--fx:${(Math.random()-.5)*250}px;--fy:${(Math.random()-.5)*250}px;`;document.body.appendChild(el);setTimeout(()=>el.remove(),1200)},i*60);
}

S.sub(render);
render(S.get());
setInterval(()=>{const st=S.get();if(st.phase==='game'&&st.timerRunning)updateGame(st)},500);
</script>
</body>
</html>
