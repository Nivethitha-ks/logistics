<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN â€” LOGISTICS AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --gold:#FFD700;--neon-blue:#00D4FF;--neon-green:#00FF88;
  --neon-red:#FF3366;--neon-orange:#FF8C00;--neon-purple:#BF00FF;
  --bg:#050510;--ease:cubic-bezier(.23,1,.32,1);
}
html,body{width:100%;min-height:100vh;background:var(--bg);color:#fff;font-family:'Rajdhani',sans-serif;overflow-y:auto}
.sf{position:fixed;inset:0;z-index:0;
  background:radial-gradient(ellipse at 20% 50%,rgba(0,80,150,.12) 0%,transparent 50%),
             radial-gradient(ellipse at 80% 20%,rgba(80,0,150,.12) 0%,transparent 50%),
             var(--bg);pointer-events:none}
.spots{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.spot{position:absolute;top:-200px;width:5px;height:110vh;
  background:linear-gradient(to bottom,rgba(255,255,255,.08) 0%,transparent 100%);
  transform-origin:top center;filter:blur(10px)}
.spot:nth-child(1){left:15%;animation:s1 8s ease-in-out infinite}
.spot:nth-child(2){left:45%;animation:s2 11s ease-in-out infinite 2s}
.spot:nth-child(3){left:70%;animation:s3 9s ease-in-out infinite 1s}
.spot:nth-child(4){left:88%;animation:s4 12s ease-in-out infinite 3s}
@keyframes s1{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(18deg)}}
@keyframes s2{0%,100%{transform:rotate(25deg)}50%{transform:rotate(-18deg)}}
@keyframes s3{0%,100%{transform:rotate(-15deg)}50%{transform:rotate(22deg)}}
@keyframes s4{0%,100%{transform:rotate(20deg)}50%{transform:rotate(-25deg)}}

/* === PHASE ENGINE VISUAL STATES === */
.phase-lobby #btn-start-show{opacity:1;pointer-events:auto}
.phase-spin #btn-start-show{opacity:.4;pointer-events:none}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;
  padding:11px 24px;border:none;border-radius:8px;cursor:pointer;
  font-family:'Orbitron',sans-serif;font-weight:700;font-size:12px;
  letter-spacing:1.5px;text-transform:uppercase;transition:all .25s var(--ease)}
.btn:active{transform:scale(.97)}
.btn-gold{background:linear-gradient(135deg,#7a5900,#FFD700,#7a5900);color:#000;box-shadow:0 0 18px rgba(255,215,0,.4)}
.btn-gold:hover{box-shadow:0 0 35px rgba(255,215,0,.8);transform:translateY(-2px)}
.btn-blue{background:linear-gradient(135deg,#004466,#00D4FF,#004466);color:#fff;box-shadow:0 0 15px rgba(0,212,255,.3)}
.btn-blue:hover{box-shadow:0 0 30px rgba(0,212,255,.7);transform:translateY(-2px)}
.btn-green{background:linear-gradient(135deg,#005533,#00FF88,#005533);color:#000;box-shadow:0 0 15px rgba(0,255,136,.3)}
.btn-green:hover{box-shadow:0 0 30px rgba(0,255,136,.7);transform:translateY(-2px)}
.btn-red{background:linear-gradient(135deg,#7a001a,#FF3366,#7a001a);color:#fff;box-shadow:0 0 15px rgba(255,51,102,.3)}
.btn-red:hover{box-shadow:0 0 30px rgba(255,51,102,.7);transform:translateY(-2px)}
.btn-purple{background:linear-gradient(135deg,#3a0066,#BF00FF,#3a0066);color:#fff;box-shadow:0 0 15px rgba(191,0,255,.3)}
.btn-purple:hover{box-shadow:0 0 30px rgba(191,0,255,.7);transform:translateY(-2px)}
.btn-orange{background:linear-gradient(135deg,#7a3c00,#FF8C00,#7a3c00);color:#fff;box-shadow:0 0 15px rgba(255,140,0,.3)}
.btn-orange:hover{box-shadow:0 0 30px rgba(255,140,0,.7);transform:translateY(-2px)}
.btn-lg{padding:16px 40px;font-size:16px;letter-spacing:2px}
.btn-sm{padding:7px 14px;font-size:10px;letter-spacing:1px}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none!important;box-shadow:none!important}
/* INPUTS */
.inp{background:rgba(0,0,0,.4);border:1px solid rgba(0,212,255,.22);border-radius:7px;
  padding:10px 14px;color:#fff;font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;
  width:100%;transition:border-color .3s,box-shadow .3s;outline:none}
.inp:focus{border-color:var(--neon-blue);box-shadow:0 0 12px rgba(0,212,255,.3)}
.inp::placeholder{color:rgba(255,255,255,.3)}
.lbl{display:block;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon-blue);margin-bottom:5px}
/* NEON TEXT */
.neon-gold{color:var(--gold);text-shadow:0 0 12px var(--gold),0 0 35px var(--gold)}
/* GLASS */
.glass{background:rgba(10,15,40,.82);backdrop-filter:blur(18px);border:1px solid rgba(0,212,255,.2);border-radius:14px}
/* NOTIFICATION */
#notif{position:fixed;top:76px;right:20px;z-index:500;padding:12px 22px;border-radius:9px;min-width:220px;
  font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;
  transform:translateX(120%);transition:transform .4s var(--ease);backdrop-filter:blur(16px)}
#notif.show{transform:translateX(0)}
#notif.ok{background:rgba(0,255,136,.12);border:1px solid var(--neon-green);color:var(--neon-green)}
#notif.err{background:rgba(255,51,102,.12);border:1px solid var(--neon-red);color:var(--neon-red)}
#notif.info{background:rgba(0,212,255,.12);border:1px solid var(--neon-blue);color:var(--neon-blue)}
/* PHASE BANNER */
#phase-banner{position:fixed;top:0;left:0;right:0;z-index:200;pointer-events:none;
  display:flex;align-items:center;justify-content:center;height:3px}
.phase-bar{width:100%;height:3px;transition:background .6s}
.pb-lobby{background:rgba(0,212,255,.4)}
.pb-spin{background:linear-gradient(90deg,var(--neon-blue),var(--neon-purple))}
.pb-betting{background:linear-gradient(90deg,var(--gold),var(--neon-orange));animation:pbar 1s ease-in-out infinite}
.pb-answering{background:linear-gradient(90deg,var(--neon-green),var(--neon-blue));animation:pbar .6s ease-in-out infinite}
.pb-result{background:linear-gradient(90deg,var(--neon-green),var(--gold))}
.pb-reveal{background:var(--gold)}
@keyframes pbar{0%,100%{opacity:.7}50%{opacity:1}}
/* LAYOUT */
#app{position:relative;z-index:10;min-height:100vh}
#login{min-height:100vh;display:flex;align-items:center;justify-content:center}
.login-card{padding:44px;max-width:400px;width:90%;text-align:center}
.login-title{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--gold);margin-bottom:6px;text-shadow:0 0 15px var(--gold)}
.login-sub{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-bottom:28px}
.login-err{color:var(--neon-red);font-family:'Rajdhani',sans-serif;font-size:14px;margin-top:10px;min-height:18px}
#admin{display:none}
.ahdr{background:rgba(0,0,0,.65);backdrop-filter:blur(18px);border-bottom:1px solid rgba(0,212,255,.18);
  padding:14px 22px;position:sticky;top:0;z-index:100;
  display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.alogo{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--gold);letter-spacing:3px}
.aphase{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--neon-blue)}
.abody{display:grid;grid-template-columns:300px 1fr;min-height:calc(100vh - 78px)}
@media(max-width:900px){.abody{grid-template-columns:1fr}}
.aside{background:rgba(0,0,0,.4);border-right:1px solid rgba(0,212,255,.12);
  padding:16px 14px;display:flex;flex-direction:column;gap:16px;overflow-y:auto}
.aside-sec{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:14px}
.aside-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:10px}
.amain{padding:18px 22px;overflow-y:auto}
/* TABS */
.tabs{display:flex;gap:3px;margin-bottom:20px;background:rgba(0,0,0,.3);padding:5px;border-radius:10px;flex-wrap:wrap}
.tab{padding:9px 18px;border:none;border-radius:7px;background:transparent;color:rgba(255,255,255,.4);
  cursor:pointer;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;transition:all .3s}
.tab.on{background:rgba(0,212,255,.15);color:var(--neon-blue);box-shadow:0 0 12px rgba(0,212,255,.2)}
.tab:hover:not(.on){color:rgba(255,255,255,.7);background:rgba(255,255,255,.05)}
.tabp{display:none;animation:fadeIn .3s}
.tabp.on{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
/* SECTION CARD */
.scard{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:18px;margin-bottom:14px}
.scard-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:12px}
/* TEAM ROWS */
.trow{display:flex;gap:7px;align-items:center;margin-bottom:7px;animation:fadeIn .3s}
/* Q CARD */
.qcard{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:14px;margin-bottom:10px;transition:all .3s}
.qcard:hover{border-color:rgba(0,212,255,.3)}
.qcard.sel{border-color:var(--neon-blue);background:rgba(0,212,255,.07);box-shadow:0 0 18px rgba(0,212,255,.2)}
.qhdr{display:flex;align-items:flex-start;gap:10px;margin-bottom:8px}
.qnum-lbl{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);font-weight:700;min-width:28px}
.qtext-lbl{flex:1;font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600}
.qactions{display:flex;gap:5px;flex-shrink:0}
.qorow{display:flex;gap:7px;align-items:center;margin-bottom:5px}
.qorow input{flex:1}
.corr-dot{width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,.2);cursor:pointer;
  flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s}
.corr-dot.on{background:var(--neon-green);border-color:var(--neon-green);box-shadow:0 0 8px var(--neon-green)}
/* LIVE CONTROL */
.ctrl-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px}
@media(max-width:800px){.ctrl-grid{grid-template-columns:1fr}}
.team-act-btn{display:flex;align-items:center;justify-content:space-between;padding:11px 13px;
  border-radius:8px;margin-bottom:7px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
  cursor:pointer;transition:all .3s;border-width:0;width:100%;color:#fff;text-align:left}
.team-act-btn:hover{background:rgba(0,212,255,.08);border-color:rgba(0,212,255,.3)}
.team-act-btn.on{background:rgba(0,212,255,.14);border:1px solid var(--neon-blue);box-shadow:0 0 14px rgba(0,212,255,.2)}
/* SIDEBAR DATA ROWS */
.lb-row{display:flex;align-items:center;gap:8px;padding:7px 9px;border-radius:7px;margin-bottom:5px;background:rgba(255,255,255,.03)}
.lb-row.at{background:rgba(0,212,255,.09);border:1px solid rgba(0,212,255,.3)}
.bet-row{display:flex;align-items:center;justify-content:space-between;padding:7px 9px;border-radius:7px;margin-bottom:4px;background:rgba(255,255,255,.03)}
.bet-row.hb{border:1px solid rgba(255,215,0,.25);background:rgba(255,215,0,.05)}
/* TIMER BIG */
.timer-big{font-family:'Orbitron',sans-serif;font-size:52px;font-weight:900;text-align:center;color:var(--neon-blue);text-shadow:0 0 18px var(--neon-blue)}
/* FOOTER */
.afoot{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:14px 22px;
  background:rgba(0,0,0,.5);border-top:1px solid rgba(0,212,255,.12);position:sticky;bottom:0;z-index:50}
.dot{width:9px;height:9px;border-radius:50%}
.dot.on{background:var(--neon-green);box-shadow:0 0 6px var(--neon-green)}
.dot.wait{background:var(--neon-orange);box-shadow:0 0 6px var(--neon-orange)}
.wl{display:inline-flex;padding:2px 7px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:8px;font-weight:700}
.ww{background:rgba(0,255,136,.15);color:var(--neon-green);border:1px solid rgba(0,255,136,.3)}
.wloss{background:rgba(255,51,102,.12);color:var(--neon-red);border:1px solid rgba(255,51,102,.25)}

/* PHASE INDICATOR CARD */
.phase-indicator{padding:10px 16px;border-radius:9px;margin-bottom:14px;display:flex;align-items:center;gap:10px;
  background:rgba(0,212,255,.06);border:1px solid rgba(0,212,255,.2);font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--neon-blue)}
.phase-dot-animated{width:10px;height:10px;border-radius:50%;background:var(--neon-green);
  box-shadow:0 0 8px var(--neon-green);animation:pdot 1s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1}50%{opacity:.2}}
</style>
</head>
<body>
<div class="sf"></div>
<div class="spots"><div class="spot"></div><div class="spot"></div><div class="spot"></div><div class="spot"></div></div>
<div id="phase-banner"><div class="phase-bar pb-lobby" id="phase-bar"></div></div>
<div id="notif"></div>
<div id="app">

<!-- LOGIN -->
<div id="login">
  <div class="glass login-card">
    <div class="login-title neon-gold">âš™ ADMIN</div>
    <div class="login-sub">LOGISTICS AUCTION SHOW Â· MASTER CONTROL</div>
    <div style="margin-bottom:14px">
      <label class="lbl">ADMIN PASSWORD</label>
      <input class="inp" type="password" id="pw" placeholder="Enter password" style="margin-bottom:12px">
    </div>
    <button class="btn btn-gold" style="width:100%" id="login-btn">ğŸ”“ ACCESS CONTROL PANEL</button>
    <div class="login-err" id="login-err"></div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="admin">
  <div class="ahdr">
    <div>
      <div class="alogo">âš™ ADMIN CONTROL</div>
      <div style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(255,255,255,.35)">LOGISTICS AUCTION SHOW Â· MASTER</div>
    </div>
    <div class="aphase" id="aphase">PHASE: LOBBY</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-red btn-sm" id="btn-reset">ğŸ”„ RESET GAME</button>
      <button class="btn btn-gold btn-sm" id="btn-display">ğŸ“º MAIN DISPLAY</button>
    </div>
  </div>

  <div class="abody">
    <!-- SIDEBAR -->
    <div class="aside">
      <div class="aside-sec">
        <div class="aside-ttl">ğŸ“¡ CURRENT PHASE</div>
        <div class="phase-indicator"><div class="phase-dot-animated"></div><span id="aside-phase-txt">LOBBY</span></div>
        <div style="display:flex;gap:5px;flex-wrap:wrap" id="phase-btns-quick">
          <button class="btn btn-blue btn-sm" id="btn-phase-spin">â†’ SPIN</button>
          <button class="btn btn-purple btn-sm" id="btn-phase-betting">â†’ BETTING</button>
          <button class="btn btn-green btn-sm" id="btn-phase-answering">â†’ ANSWERING</button>
          <button class="btn btn-orange btn-sm" id="btn-phase-result">â†’ RESULT</button>
        </div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">ğŸ† LEADERBOARD</div>
        <div id="aside-lb"></div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">ğŸ’° LIVE BETS</div>
        <div id="aside-bets"></div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">â“ ACTIVE QUESTION</div>
        <div id="aside-q" style="font-family:'Rajdhani',sans-serif;font-size:12px;color:rgba(255,255,255,.6);line-height:1.5">No question selected</div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">â± TIMER</div>
        <div class="timer-big" id="aside-timer">--</div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="amain">
      <div class="tabs">
        <button class="tab on" data-tab="setup">âš™ SETUP</button>
        <button class="tab" data-tab="questions">â“ QUESTIONS</button>
        <button class="tab" data-tab="live">ğŸ¬ LIVE CONTROL</button>
        <button class="tab" data-tab="broadcast">ğŸ“¢ BROADCAST</button>
      </div>

      <!-- SETUP TAB -->
      <div id="tabp-setup" class="tabp on">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">PRE-GAME SETUP</h2>
        <div class="scard">
          <div class="scard-ttl">TEAM COUNT (2â€“10)</div>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <input class="inp" type="number" id="team-count" min="2" max="10" value="4" style="width:90px">
            <button class="btn btn-blue btn-sm" id="btn-gen-slots">GENERATE SLOTS</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">TEAM NAMES & STARTING MONEY</div>
          <div id="team-inputs"></div>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap">
            <div style="flex:1;min-width:180px">
              <label class="lbl">SET ALL TO SAME AMOUNT</label>
              <input class="inp" type="number" id="all-money" placeholder="e.g. 10000" value="10000">
            </div>
            <button class="btn btn-blue btn-sm" id="btn-all-money">APPLY ALL</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">DEFAULT TIMER (5â€“60 SECONDS)</div>
          <div style="display:flex;gap:10px;align-items:center">
            <input class="inp" type="number" id="timer-default" min="5" max="60" value="30" style="width:90px">
            <span style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.5)">seconds</span>
          </div>
        </div>
        <button class="btn btn-green" id="btn-save-setup">ğŸ’¾ SAVE CONFIGURATION</button>
        <div id="setup-msg" style="margin-top:10px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;min-height:18px"></div>
        <div style="margin-top:24px;padding:22px;border:1px solid rgba(255,215,0,.3);border-radius:12px;background:rgba(255,215,0,.04)">
          <div style="font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:3px;color:var(--gold);margin-bottom:10px">âš¡ LAUNCH SEQUENCE</div>
          <p style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.6);margin-bottom:14px;line-height:1.6">Save configuration above, then click START LIVE SHOW. Teams open index.html on their devices and spin the wheel to claim a team slot.</p>
          <button class="btn btn-gold btn-lg" id="btn-start-show">ğŸ¬ START LIVE SHOW</button>
        </div>
      </div>

      <!-- QUESTIONS TAB -->
      <div id="tabp-questions" class="tabp">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:20px">
          <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold)">QUESTION BANK</h2>
          <button class="btn btn-green btn-sm" id="btn-add-q">+ ADD QUESTION</button>
        </div>
        <div id="q-bank"></div>
      </div>

      <!-- LIVE CONTROL TAB -->
      <div id="tabp-live" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">LIVE SHOW CONTROL</h2>

        <!-- PHASE FLOW GUIDE -->
        <div class="scard" style="border-color:rgba(255,215,0,.25);background:rgba(255,215,0,.03);margin-bottom:18px">
          <div class="scard-ttl" style="color:var(--gold)">GAME FLOW (PHASES)</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:rgba(255,255,255,.5)">
            <span style="color:var(--neon-blue)">1. SELECT Q</span> â†’
            <span style="color:var(--gold)">2. OPEN BETTING</span> â†’
            <span style="color:var(--neon-red)">3. CLOSE BETTING</span> â†’
            <span style="color:var(--neon-green)">4. ACTIVATE TEAM</span> â†’
            <span style="color:var(--neon-orange)">5. START TIMER</span> â†’
            <span style="color:var(--neon-purple)">6. JUDGE ANSWER</span>
          </div>
        </div>

        <div class="ctrl-grid">
          <div class="scard">
            <div class="scard-ttl">SELECT QUESTION</div>
            <select class="inp" id="q-select" style="margin-bottom:10px"><option value="-1">â€” Choose question â€”</option></select>
            <div style="display:flex;gap:7px;flex-wrap:wrap">
              <button class="btn btn-blue btn-sm" id="btn-set-q">ğŸ“Œ SET QUESTION</button>
            </div>
          </div>
          <div class="scard">
            <div class="scard-ttl">BETTING PHASE</div>
            <div style="display:flex;gap:7px;flex-wrap:wrap">
              <button class="btn btn-purple" id="btn-open-bet">ğŸ’° OPEN BETTING</button>
              <button class="btn btn-red" id="btn-close-bet">ğŸ”’ CLOSE BETTING</button>
            </div>
            <div style="margin-top:8px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1px;color:rgba(255,255,255,.4)">
              Close betting â†’ Phase moves to ANSWERING â†’ Question revealed to teams
            </div>
          </div>
          <div class="scard">
            <div class="scard-ttl">TIMER CONTROL</div>
            <div style="display:flex;gap:7px;align-items:center;margin-bottom:10px">
              <input class="inp" type="number" id="timer-override" placeholder="Seconds" style="width:90px">
              <span style="font-family:'Rajdhani',sans-serif;font-size:12px;color:rgba(255,255,255,.4)">override</span>
            </div>
            <div style="display:flex;gap:7px;flex-wrap:wrap">
              <button class="btn btn-green btn-sm" id="btn-timer-start">â–¶ START</button>
              <button class="btn btn-red btn-sm" id="btn-timer-stop">â¹ STOP</button>
              <button class="btn btn-blue btn-sm" id="btn-timer-reset">â†º RESET</button>
            </div>
          </div>
          <div class="scard" style="grid-column:span 2">
            <div class="scard-ttl">ACTIVATE TEAM TO ANSWER</div>
            <div id="team-act-list"></div>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">ANSWER RESULT</div>
          <div id="ans-display" style="font-family:'Rajdhani',sans-serif;font-size:17px;color:rgba(255,255,255,.6);margin-bottom:14px">Waiting for team answer...</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-green" id="btn-correct" disabled>âœ… CORRECT â€” AWARD BET</button>
            <button class="btn btn-red" id="btn-wrong" disabled>âŒ WRONG â€” DEDUCT BET</button>
          </div>
        </div>
        <div class="scard" style="margin-top:16px">
          <div class="scard-ttl">NEXT QUESTION / END</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-blue" id="btn-next-q">â­ NEXT QUESTION</button>
            <button class="btn btn-gold" id="btn-end-game">ğŸ† REVEAL WINNER &amp; END SHOW</button>
          </div>
        </div>
      </div>

      <!-- BROADCAST TAB -->
      <div id="tabp-broadcast" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">BROADCAST</h2>
        <div class="scard">
          <div class="scard-ttl">SEND ANNOUNCEMENT TO ALL SCREENS</div>
          <label class="lbl">MESSAGE</label>
          <textarea class="inp" id="ann-input" rows="3" placeholder="Type announcement..." style="margin-bottom:10px;resize:vertical"></textarea>
          <div style="display:flex;gap:8px">
            <button class="btn btn-gold" id="btn-ann-send">ğŸ“¢ BROADCAST NOW</button>
            <button class="btn btn-blue btn-sm" id="btn-ann-clear">âœ• CLEAR</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">QUICK MESSAGES</div>
          <div id="quick-msgs" style="display:flex;gap:7px;flex-wrap:wrap;margin-top:6px"></div>
        </div>
        <div class="scard">
          <div class="scard-ttl">MANUAL MONEY ADJUSTMENT</div>
          <div id="money-adj"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="afoot">
    <div style="display:flex;align-items:center;gap:8px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px">
      <div class="dot wait" id="phase-dot"></div>
      <span id="phase-label">LOBBY PHASE</span>
    </div>
    <div style="flex:1"></div>
    <button class="btn btn-blue btn-sm" id="btn-sync">ğŸ”„ SYNC ALL</button>
  </div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey: "AIzaSyCSyzYtCd-uiolBucZnncuIWpnE5mPG9Cs",
  authDomain: "logistics-auction-show.firebaseapp.com",
  databaseURL: "https://logistics-auction-show-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "logistics-auction-show",
  storageBucket: "logistics-auction-show.firebasestorage.app",
  messagingSenderId: "596983567254",
  appId: "1:596983567254:web:91f5b863db7464886503b7"
};
const fbApp = initializeApp(firebaseConfig);
const db = getDatabase(fbApp);
const gameRef = ref(db, "gameState");

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEFAULT QUESTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DQ = [
  {id:'q1',text:'What does "ETA" stand for in logistics?',options:['Estimated Time of Arrival','Electronic Tracking Agent','Express Transport Authorization','Enhanced Transit Algorithm'],correct:0},
  {id:'q2',text:'Which shipping term means the seller bears all risks until goods reach the buyer\'s destination?',options:['FOB Origin','CIF','EXW','DDP'],correct:3},
  {id:'q3',text:'What is the maximum weight allowed for a standard 20-foot intermodal shipping container?',options:['24,000 kg','28,000 kg','33,000 kg','38,000 kg'],correct:0},
  {id:'q4',text:'In "Last Mile" delivery, what does "last mile" refer to?',options:['The final 1-mile drive','Delivery from hub to end customer','International customs clearance','Warehouse-to-port transport'],correct:1},
  {id:'q5',text:'Which inventory method assumes the first item received is the first sold?',options:['LIFO','FIFO','JIT','ABC Analysis'],correct:1},
  {id:'q6',text:'What does 3PL stand for in supply chain management?',options:['Third-Party Logistics','Three-Point Loading','Triple Parcel Layer','Tri-Phase Logistics'],correct:0},
  {id:'q7',text:'Which document is required for all international ocean freight shipments?',options:['Air Waybill','Bill of Lading','Packing Slip','Purchase Order'],correct:1},
  {id:'q8',text:'What is the total time from order placement to customer delivery called?',options:['Transit Time','Lead Time','Cycle Time','Processing Time'],correct:1},
  {id:'q9',text:'Which technology uses radio waves to automatically identify and track inventory?',options:['GPS','NFC','RFID','Barcode'],correct:2},
  {id:'q10',text:'What is a "cross-dock" operation in logistics?',options:['Loading cargo across borders','Transferring goods from inbound to outbound without storage','A dock shared between two warehouses','Overnight freight handling at airports'],correct:1}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASES: lobby | spin | betting | answering | result | reveal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeDefaultState() {
  return {
    phase: 'lobby',
    version: Date.now(),
    teams: [],
    questions: JSON.parse(JSON.stringify(DQ)),
    currentQuestionIndex: -1,
    activeTeam: null,
    timerDuration: 30,
    timerRemaining: 30,
    timerRunning: false,
    timerStartedAt: null,
    announcement: '',
    round: 0,
    bets: {},
    selectedAnswer: null,
    lastResult: null,
    winner: null,
    assignedDevices: []
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _state = makeDefaultState();
const _subs = [];

onValue(gameRef, snap => {
  const data = snap.val();
  if (!data) {
    _state = makeDefaultState();
    set(gameRef, _state);
  } else {
    _state = data;
    _subs.forEach(fn => { try { fn(_state); } catch(e) { console.warn(e); } });
  }
});

function getState() { return _state; }
function updateState(patch) { update(gameRef, patch); }
function resetState() {
  const fresh = makeDefaultState();
  fresh.version = Date.now();
  set(gameRef, fresh);
}
function setPhase(phase) { updateState({ phase }); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PW = 'admin123';
function $m(v) { return '$' + Number(v||0).toLocaleString('en-US'); }
function esc(s) { if(typeof s!=='string') return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function safeClone(obj) { try { return JSON.parse(JSON.stringify(obj)); } catch{ return obj; } }

let editTeams = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function notif(msg, type='info') {
  const el = document.getElementById('notif');
  el.textContent = msg;
  el.className = `show ${type==='success'?'ok':type==='error'?'err':'info'}`;
  clearTimeout(el._t);
  el._t = setTimeout(() => el.className = type==='success'?'ok':type==='error'?'err':'info', 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin() {
  const pw = document.getElementById('pw').value;
  if (pw === PW) {
    document.getElementById('login').style.display = 'none';
    document.getElementById('admin').style.display = 'block';
    initAdmin();
  } else {
    document.getElementById('login-err').textContent = 'âŒ Incorrect password';
    setTimeout(() => document.getElementById('login-err').textContent = '', 2200);
  }
}
document.getElementById('login-btn').addEventListener('click', doLogin);
document.getElementById('pw').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAdmin() {
  const st = getState();
  editTeams = (st.teams && st.teams.length) ? safeClone(st.teams) : genTeams(4);
  document.getElementById('team-count').value = editTeams.length;
  document.getElementById('timer-default').value = st.timerDuration || 30;

  renderTeamInputs();
  renderQBank();
  renderLive();
  renderSidebar();
  applyPhaseToUI(st.phase);
  wireButtons();

  _subs.push(onStateChange);
  setInterval(timerTick, 500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIRE ALL BUTTONS â€” NO INLINE ONCLICK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function wireButtons() {
  document.getElementById('btn-gen-slots').addEventListener('click', genSlots);
  document.getElementById('btn-all-money').addEventListener('click', applyAllMoney);
  document.getElementById('btn-save-setup').addEventListener('click', saveSetup);
  document.getElementById('btn-start-show').addEventListener('click', startShow);
  document.getElementById('btn-add-q').addEventListener('click', addQ);
  document.getElementById('btn-set-q').addEventListener('click', setQ);
  document.getElementById('btn-open-bet').addEventListener('click', openBet);
  document.getElementById('btn-close-bet').addEventListener('click', closeBet);
  document.getElementById('btn-timer-start').addEventListener('click', startTimer);
  document.getElementById('btn-timer-stop').addEventListener('click', stopTimer);
  document.getElementById('btn-timer-reset').addEventListener('click', resetTimer);
  document.getElementById('btn-correct').addEventListener('click', () => judge(true));
  document.getElementById('btn-wrong').addEventListener('click', () => judge(false));
  document.getElementById('btn-next-q').addEventListener('click', nextQuestion);
  document.getElementById('btn-end-game').addEventListener('click', endGame);
  document.getElementById('btn-ann-send').addEventListener('click', sendAnn);
  document.getElementById('btn-ann-clear').addEventListener('click', clearAnn);
  document.getElementById('btn-sync').addEventListener('click', () => { updateState({ _sync: Date.now() }); notif('All screens synced!', 'success'); });
  document.getElementById('btn-display').addEventListener('click', () => window.open('index.html', '_blank'));
  document.getElementById('btn-reset').addEventListener('click', () => {
    if (confirm('RESET ENTIRE GAME? This will clear all teams, bets, assignments, and return to lobby.')) {
      resetState();
      editTeams = genTeams(4);
      renderTeamInputs();
      renderQBank();
      notif('âš  Game fully reset to default state', 'info');
    }
  });

  // Phase quick-set buttons
  document.getElementById('btn-phase-spin').addEventListener('click', () => setPhase('spin'));
  document.getElementById('btn-phase-betting').addEventListener('click', () => setPhase('betting'));
  document.getElementById('btn-phase-answering').addEventListener('click', () => setPhase('answering'));
  document.getElementById('btn-phase-result').addEventListener('click', () => setPhase('result'));

  // TABS
  document.querySelectorAll('.tab').forEach(t => {
    t.addEventListener('click', function() {
      document.querySelectorAll('.tab').forEach(x => x.classList.remove('on'));
      document.querySelectorAll('.tabp').forEach(x => x.classList.remove('on'));
      this.classList.add('on');
      document.getElementById('tabp-' + this.dataset.tab).classList.add('on');
    });
  });

  // Quick messages
  const qms = [
    ['Welcome', 'ğŸ¬ Welcome to the Logistics Auction Show! Let the bidding begin!'],
    ['Betting Open', 'ğŸ’° Betting is now OPEN â€” place your bets!'],
    ['Betting Closed', 'ğŸ”’ Betting is closed. Activating team now...'],
    ['Timer Start', 'â± Timer starting now â€” good luck!'],
    ['Round Done', 'ğŸ† Great round! Get ready for the next question.'],
    ['Stand By', 'âš  Technical break â€” please stand by...']
  ];
  document.getElementById('quick-msgs').innerHTML = qms.map(([l, m], idx) =>
    `<button class="btn btn-blue btn-sm" data-qmsg="${idx}"> ${l}</button>`
  ).join('');
  document.getElementById('quick-msgs').addEventListener('click', e => {
    const btn = e.target.closest('[data-qmsg]');
    if (btn) quickMsg(qms[parseInt(btn.dataset.qmsg)][1]);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE CHANGE HANDLER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onStateChange(st) {
  renderLive();
  renderSidebar();
  applyPhaseToUI(st.phase);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE UI MAPPING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PHASE_COLORS = {
  lobby: '#00D4FF', spin: '#BF00FF', betting: '#FFD700',
  answering: '#00FF88', result: '#FF8C00', reveal: '#FFD700'
};
const PHASE_BAR_CLASS = {
  lobby: 'pb-lobby', spin: 'pb-spin', betting: 'pb-betting',
  answering: 'pb-answering', result: 'pb-result', reveal: 'pb-reveal'
};
function applyPhaseToUI(phase) {
  const labels = { lobby:'LOBBY', spin:'TEAM SPIN', betting:'BETTING OPEN', answering:'ANSWERING', result:'RESULT', reveal:'GAME OVER' };
  const lbl = labels[phase] || phase.toUpperCase();
  document.getElementById('aphase').textContent = 'PHASE: ' + lbl;
  document.getElementById('phase-label').textContent = lbl + ' PHASE';
  document.getElementById('aside-phase-txt').textContent = lbl;
  const dot = document.getElementById('phase-dot');
  dot.className = 'dot ' + (phase === 'answering' ? 'on' : 'wait');
  const bar = document.getElementById('phase-bar');
  bar.className = 'phase-bar ' + (PHASE_BAR_CLASS[phase] || 'pb-lobby');
  const col = PHASE_COLORS[phase] || 'var(--neon-blue)';
  document.getElementById('aside-phase-txt').style.color = col;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEAM SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genTeams(n) {
  return Array.from({ length: n }, (_, i) => ({ name: `Team ${i + 1}`, money: 10000, wins: 0, losses: 0 }));
}
function genSlots() {
  const n = parseInt(document.getElementById('team-count').value);
  if (isNaN(n) || n < 2 || n > 10) { notif('Enter 2â€“10 teams', 'error'); return; }
  while (editTeams.length < n) editTeams.push({ name: `Team ${editTeams.length + 1}`, money: 10000, wins: 0, losses: 0 });
  editTeams = editTeams.slice(0, n);
  renderTeamInputs();
}
function renderTeamInputs() {
  document.getElementById('team-inputs').innerHTML = editTeams.map((t, i) => `
    <div class="trow">
      <span style="font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);min-width:22px">${i+1}</span>
      <input class="inp" type="text" value="${esc(t.name)}" placeholder="Team name" data-team-name="${i}" style="flex:1.5">
      <input class="inp" type="number" value="${t.money}" min="0" data-team-money="${i}" style="width:105px">
      <button class="btn btn-red btn-sm" data-team-del="${i}">âœ•</button>
    </div>`).join('');
  // Bind events after render
  document.querySelectorAll('[data-team-name]').forEach(el => {
    el.addEventListener('change', () => { editTeams[parseInt(el.dataset.teamName)].name = el.value; });
  });
  document.querySelectorAll('[data-team-money]').forEach(el => {
    el.addEventListener('change', () => { editTeams[parseInt(el.dataset.teamMoney)].money = parseInt(el.value) || 0; });
  });
  document.querySelectorAll('[data-team-del]').forEach(el => {
    el.addEventListener('click', () => {
      editTeams.splice(parseInt(el.dataset.teamDel), 1);
      document.getElementById('team-count').value = editTeams.length;
      renderTeamInputs();
    });
  });
}
function applyAllMoney() {
  const v = parseInt(document.getElementById('all-money').value);
  if (isNaN(v) || v < 0) { notif('Invalid amount', 'error'); return; }
  editTeams.forEach(t => t.money = v);
  renderTeamInputs();
  notif(`All teams set to ${$m(v)}`, 'success');
}
function saveSetup() {
  if (editTeams.length < 2) { notif('Need at least 2 teams', 'error'); return; }
  // Sync names from inputs before saving
  document.querySelectorAll('[data-team-name]').forEach(el => { editTeams[parseInt(el.dataset.teamName)].name = el.value.trim(); });
  document.querySelectorAll('[data-team-money]').forEach(el => { editTeams[parseInt(el.dataset.teamMoney)].money = parseInt(el.value) || 0; });
  const names = editTeams.map(t => t.name.trim()).filter(Boolean);
  if (new Set(names).size !== names.length) { notif('Duplicate team names!', 'error'); return; }
  const td = parseInt(document.getElementById('timer-default').value);
  if (isNaN(td) || td < 5 || td > 60) { notif('Timer must be 5â€“60s', 'error'); return; }
  const teams = editTeams.map(t => ({ ...t, name: t.name.trim() || `Team_${Date.now()}` }));
  updateState({ teams, timerDuration: td, timerRemaining: td });
  notif('âœ… Configuration saved!', 'success');
  document.getElementById('setup-msg').innerHTML = `<span style="color:var(--neon-green)">âœ… SAVED â€” ${teams.length} TEAMS CONFIGURED</span>`;
}
function startShow() {
  const st = getState();
  if (!st.teams || st.teams.length < 2) { notif('Save team config first!', 'error'); return; }
  updateState({ phase: 'spin', assignedDevices: [] });
  notif('ğŸ¬ SHOW STARTED â€” Teams can now spin!', 'success');
  updateState({ announcement: 'ğŸ¬ Welcome! Open index.html to spin and join your team!' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION BANK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQBank() {
  const st = getState();
  const qs = Array.isArray(st.questions) ? st.questions : [];
  const sel = document.getElementById('q-select');
  if (sel) {
    sel.innerHTML = '<option value="-1">â€” Choose question â€”</option>' +
      qs.map((q, i) => `<option value="${i}" ${st.currentQuestionIndex===i?'selected':''}>${'Q'+(i+1)}: ${q.text.substr(0,50)}...</option>`).join('');
  }
  const el = document.getElementById('q-bank');
  if (!el) return;
  el.innerHTML = qs.map((q, i) => `
    <div class="qcard ${st.currentQuestionIndex===i?'sel':''}" id="qc-${i}">
      <div class="qhdr" id="qhdr-${i}">
        <span class="qnum-lbl">Q${i+1}</span>
        <span class="qtext-lbl">${esc(q.text)}</span>
        <div class="qactions">
          <button class="btn btn-blue btn-sm" data-edit-q="${i}">âœ EDIT</button>
          <button class="btn btn-red btn-sm" data-del-q="${i}">ğŸ—‘</button>
        </div>
      </div>
      <div id="qedit-${i}" style="display:none">
        <div style="margin-bottom:8px"><label class="lbl">QUESTION TEXT</label><textarea class="inp" id="qt-${i}" rows="2">${esc(q.text)}</textarea></div>
        <div style="margin-bottom:8px"><label class="lbl">OPTIONS (click â— = correct answer)</label>
          ${q.options.map((o,j)=>`<div class="qorow"><span style="font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);min-width:18px">${'ABCD'[j]}</span><input class="inp" id="qo-${i}-${j}" value="${esc(o)}"><div class="corr-dot ${q.correct===j?'on':''}" id="cd-${i}-${j}" data-corr-qi="${i}" data-corr-oi="${j}">${q.correct===j?'âœ“':''}</div></div>`).join('')}
        </div>
        <div style="display:flex;gap:7px">
          <button class="btn btn-green btn-sm" data-save-q="${i}">ğŸ’¾ SAVE</button>
          <button class="btn btn-blue btn-sm" data-cancel-q="${i}">âœ• CANCEL</button>
        </div>
      </div>
    </div>`).join('');

  // Bind q bank events
  el.querySelectorAll('[data-edit-q]').forEach(b => b.addEventListener('click', () => editQ(parseInt(b.dataset.editQ))));
  el.querySelectorAll('[data-del-q]').forEach(b => b.addEventListener('click', () => delQ(parseInt(b.dataset.delQ))));
  el.querySelectorAll('[data-save-q]').forEach(b => b.addEventListener('click', () => saveQ(parseInt(b.dataset.saveQ))));
  el.querySelectorAll('[data-cancel-q]').forEach(b => b.addEventListener('click', () => cancelQ(parseInt(b.dataset.cancelQ))));
  el.querySelectorAll('[data-corr-qi]').forEach(b => b.addEventListener('click', () => setCorr(parseInt(b.dataset.corrQi), parseInt(b.dataset.corrOi))));
}
function editQ(i) { document.getElementById(`qedit-${i}`).style.display='block'; document.getElementById(`qhdr-${i}`).style.display='none'; }
function cancelQ(i) { document.getElementById(`qedit-${i}`).style.display='none'; document.getElementById(`qhdr-${i}`).style.display='flex'; }
function setCorr(qi, oi) {
  const st = getState();
  const qs = safeClone(st.questions || []);
  if (qs[qi]) { qs[qi].correct = oi; updateState({ questions: qs }); }
}
function saveQ(i) {
  const st = getState();
  const qs = safeClone(st.questions || []);
  const textEl = document.getElementById(`qt-${i}`);
  if (!qs[i] || !textEl) return;
  qs[i].text = textEl.value.trim();
  qs[i].options = [0,1,2,3].map(j => {
    const el = document.getElementById(`qo-${i}-${j}`);
    return el ? el.value.trim() : qs[i].options[j];
  });
  updateState({ questions: qs });
  notif('Question saved!', 'success');
}
function delQ(i) {
  if (!confirm('Delete this question?')) return;
  const st = getState();
  const qs = safeClone(st.questions || []);
  qs.splice(i, 1);
  updateState({ questions: qs, currentQuestionIndex: -1 });
  notif('Deleted', 'info');
}
function addQ() {
  const st = getState();
  const qs = safeClone(Array.isArray(st.questions) ? st.questions : []);
  qs.push({ id: 'q_' + Date.now(), text: 'New question â€” click Edit to update', options: ['Option A','Option B','Option C','Option D'], correct: 0 });
  updateState({ questions: qs });
  notif('New question added', 'success');
  setTimeout(() => editQ(qs.length - 1), 100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE CONTROL RENDERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLive() {
  const st = getState();
  const qs = Array.isArray(st.questions) ? st.questions : [];
  // q selector sync
  const sel = document.getElementById('q-select');
  if (sel) {
    sel.innerHTML = '<option value="-1">â€” Choose question â€”</option>' +
      qs.map((q, i) => `<option value="${i}" ${st.currentQuestionIndex===i?'selected':''}>${'Q'+(i+1)}: ${q.text.substr(0,45)}...</option>`).join('');
  }
  // team activate list
  const tal = document.getElementById('team-act-list');
  if (tal) {
    tal.innerHTML = (st.teams || []).map(t => {
      const b = st.bets && st.bets[t.name];
      const isOn = st.activeTeam === t.name;
      return `<button class="team-act-btn ${isOn?'on':''}" data-activate="${esc(t.name)}">
        <div>
          <div style="font-family:'Rajdhani',sans-serif;font-weight:700;font-size:15px;${isOn?'color:var(--neon-blue)':''}">${esc(t.name)}</div>
          <div style="font-family:'Orbitron',sans-serif;font-size:9px;color:rgba(255,255,255,.4)">${$m(t.money)} Â· W:${t.wins||0} L:${t.losses||0}${b?` Â· BET:${$m(b)}`:' Â· No bet'}</div>
        </div>
        <span style="font-size:17px">${isOn?'âš¡':'â—‹'}</span>
      </button>`;
    }).join('');
    tal.querySelectorAll('[data-activate]').forEach(btn => {
      btn.addEventListener('click', () => activateTeam(btn.dataset.activate));
    });
  }
  // answer display
  const ad = document.getElementById('ans-display');
  if (ad) {
    if (st.selectedAnswer !== null && st.selectedAnswer !== undefined && st.currentQuestionIndex >= 0) {
      const q = qs[st.currentQuestionIndex];
      ad.innerHTML = `<span style="color:var(--gold)">ğŸ“ ${esc(st.activeTeam||'Team')} answered: </span><span style="color:var(--neon-blue)">[${('ABCD')[st.selectedAnswer]}] ${q ? esc(q.options[st.selectedAnswer]) : ''}</span>`;
      document.getElementById('btn-correct').disabled = false;
      document.getElementById('btn-wrong').disabled = false;
    } else {
      ad.textContent = 'Waiting for team answer...';
      document.getElementById('btn-correct').disabled = true;
      document.getElementById('btn-wrong').disabled = true;
    }
  }
  // aside q
  const aq = document.getElementById('aside-q');
  if (aq && st.currentQuestionIndex >= 0 && qs[st.currentQuestionIndex]) {
    aq.textContent = `Q${st.currentQuestionIndex+1}: ${qs[st.currentQuestionIndex].text.substr(0,80)}...`;
  }
  // money adj
  const ma = document.getElementById('money-adj');
  if (ma) {
    ma.innerHTML = (st.teams || []).map((t, i) =>
      `<div style="display:flex;gap:7px;align-items:center;margin-bottom:7px">
        <span style="font-family:'Rajdhani',sans-serif;font-weight:600;min-width:120px">${esc(t.name)}</span>
        <span style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold);min-width:75px">${$m(t.money)}</span>
        <input class="inp" type="number" data-adj-i="${i}" placeholder="Â±amount" style="width:95px">
        <button class="btn btn-blue btn-sm" data-adj-apply="${i}">APPLY</button>
      </div>`
    ).join('');
    ma.querySelectorAll('[data-adj-apply]').forEach(btn => {
      btn.addEventListener('click', () => adjustMoney(parseInt(btn.dataset.adjApply)));
    });
  }
  renderSidebar();
}

function renderSidebar() {
  const st = getState();
  const sorted = [...(st.teams || [])].sort((a, b) => b.money - a.money);
  document.getElementById('aside-lb').innerHTML = sorted.map((t, i) =>
    `<div class="lb-row ${st.activeTeam===t.name?'at':''}">
      <div style="font-family:'Orbitron',sans-serif;font-size:13px;color:rgba(255,255,255,.4);min-width:22px">#${i+1}</div>
      <div style="flex:1;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px">${esc(t.name)}</div>
      <div style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold)">${$m(t.money)}</div>
    </div>`
  ).join('');
  document.getElementById('aside-bets').innerHTML = (st.teams || []).map(t => {
    const b = st.bets && st.bets[t.name];
    return `<div class="bet-row ${b?'hb':''}">
      <span style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px">${esc(t.name)}</span>
      ${b ? `<span style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold)">${$m(b)}</span>` : `<span style="color:rgba(255,255,255,.3);font-size:11px">waiting...</span>`}
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setQ() {
  const idx = parseInt(document.getElementById('q-select').value);
  if (idx < 0) { notif('Select a question first', 'error'); return; }
  updateState({ currentQuestionIndex: idx, selectedAnswer: null, lastResult: null, bets: {} });
  notif(`Q${idx+1} selected`, 'success');
}
function openBet() {
  const st = getState();
  if (st.currentQuestionIndex < 0) { notif('Select a question first', 'error'); return; }
  updateState({ phase: 'betting', bets: {}, selectedAnswer: null, lastResult: null });
  notif('ğŸ’° Betting OPEN', 'success');
  updateState({ announcement: 'ğŸ’° Betting is now OPEN â€” place your bets!' });
}
function closeBet() {
  updateState({ phase: 'answering' });
  notif('ğŸ”’ Betting CLOSED â†’ Answering phase', 'info');
  updateState({ announcement: 'ğŸ”’ Betting closed. Active team â€” answer now!' });
}
function activateTeam(name) {
  updateState({ activeTeam: name, selectedAnswer: null, lastResult: null, phase: 'answering' });
  notif(`âš¡ ${name} activated!`, 'info');
  updateState({ announcement: `âš¡ ${name} is now answering!` });
}
function nextQuestion() {
  updateState({ phase: 'betting', activeTeam: null, selectedAnswer: null, lastResult: null, bets: {}, timerRunning: false, timerRemaining: getState().timerDuration });
  notif('â­ Ready for next question', 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIMER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startTimer() {
  const ov = parseInt(document.getElementById('timer-override').value);
  const st = getState();
  const d = isNaN(ov) ? st.timerDuration : Math.min(60, Math.max(5, ov));
  updateState({ timerDuration: d, timerRemaining: d, timerRunning: true, timerStartedAt: Date.now() });
  notif(`â–¶ Timer: ${d}s`, 'info');
}
function stopTimer() {
  const st = getState();
  const elapsed = st.timerStartedAt ? (Date.now() - st.timerStartedAt) / 1000 : 0;
  const rem = Math.max(0, (st.timerRemaining || 0) - elapsed);
  updateState({ timerRunning: false, timerRemaining: rem });
  notif('â¹ Stopped', 'info');
}
function resetTimer() {
  const st = getState();
  updateState({ timerRunning: false, timerRemaining: st.timerDuration });
}
function timerTick() {
  const st = getState();
  const el = document.getElementById('aside-timer');
  if (!el) return;
  let rem = st.timerRemaining || 0;
  if (st.timerRunning && st.timerStartedAt) {
    rem = Math.max(0, (st.timerRemaining || 0) - (Date.now() - st.timerStartedAt) / 1000);
    if (rem <= 0 && st.timerRunning) {
      // Auto-judge as wrong on timeout
      updateState({ timerRunning: false, timerRemaining: 0 });
      if (st.phase === 'answering' && st.activeTeam) {
        autoJudgeTimeout();
      }
    }
  }
  const secs = Math.ceil(rem);
  el.textContent = secs > 0 ? secs : '00';
  el.style.color = secs <= 3 ? 'var(--neon-red)' : secs <= 5 ? 'var(--neon-orange)' : 'var(--neon-blue)';
}
function autoJudgeTimeout() {
  const st = getState();
  if (!st.activeTeam) return;
  const ti = (st.teams || []).findIndex(t => t.name === st.activeTeam);
  if (ti < 0) return;
  const teams = safeClone(st.teams);
  const bet = (st.bets && st.bets[st.activeTeam]) ? parseInt(st.bets[st.activeTeam]) : 0;
  teams[ti].money = Math.max(0, teams[ti].money - bet);
  teams[ti].losses = (teams[ti].losses || 0) + 1;
  updateState({
    teams,
    phase: 'result',
    lastResult: { teamName: st.activeTeam, correct: false, betAmount: bet, timestamp: Date.now(), timeout: true },
    timerRunning: false,
    activeTeam: null
  });
  updateState({ announcement: `â° TIME'S UP! ${st.activeTeam} lost ${$m(bet)}` });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JUDGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function judge(correct) {
  const st = getState();
  if (!st.activeTeam || (st.selectedAnswer === null || st.selectedAnswer === undefined)) {
    notif('No answer to judge', 'error'); return;
  }
  const ti = (st.teams || []).findIndex(t => t.name === st.activeTeam);
  if (ti < 0) return;
  const teams = safeClone(st.teams);
  const team = teams[ti];
  const bet = (st.bets && st.bets[st.activeTeam]) ? parseInt(st.bets[st.activeTeam]) : 0;
  if (correct) { team.money += bet; team.wins = (team.wins || 0) + 1; }
  else { team.money = Math.max(0, team.money - bet); team.losses = (team.losses || 0) + 1; }
  updateState({
    teams,
    phase: 'result',
    lastResult: { teamName: st.activeTeam, correct, betAmount: bet, timestamp: Date.now() },
    timerRunning: false,
    activeTeam: null
  });
  notif(correct ? `âœ… ${st.activeTeam} CORRECT! +${$m(bet)}` : `âŒ ${st.activeTeam} WRONG! -${$m(bet)}`, correct ? 'success' : 'error');
  updateState({ announcement: correct ? `âœ… ${st.activeTeam} got it RIGHT! +${$m(bet)}` : `âŒ ${st.activeTeam} got it WRONG! -${$m(bet)}` });
}
function adjustMoney(i) {
  const st = getState();
  const inp = document.querySelector(`[data-adj-i="${i}"]`);
  if (!inp) return;
  const v = parseInt(inp.value);
  if (isNaN(v)) { notif('Invalid amount', 'error'); return; }
  const teams = safeClone(st.teams);
  if (!teams[i]) return;
  teams[i].money = Math.max(0, teams[i].money + v);
  updateState({ teams });
  inp.value = '';
  notif(`${teams[i].name}: ${v>0?'+':''}${$m(v)}`, 'info');
}
function endGame() {
  const st = getState();
  if (!st.teams || !st.teams.length) { notif('No teams!', 'error'); return; }
  if (!confirm('End the show and reveal the winner?')) return;
  const winner = [...st.teams].sort((a, b) => b.money - a.money)[0];
  updateState({ phase: 'reveal', winner, timerRunning: false });
  notif(`ğŸ† ${winner.name} WINS!`, 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANNOUNCEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendAnn() {
  const m = document.getElementById('ann-input').value.trim();
  if (!m) { notif('Enter a message', 'error'); return; }
  updateState({ announcement: m });
  notif('ğŸ“¢ Broadcast sent!', 'success');
}
function clearAnn() {
  updateState({ announcement: '' });
  document.getElementById('ann-input').value = '';
}
function quickMsg(m) {
  document.getElementById('ann-input').value = m;
  sendAnn();
}

</script>
</body>
</html>
