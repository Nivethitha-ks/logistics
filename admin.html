<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN ‚Äî LOGISTICS AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--gold:#FFD700;--neon-blue:#00D4FF;--neon-green:#00FF88;--neon-red:#FF3366;--neon-orange:#FF8C00;--neon-purple:#BF00FF;--bg:#050510;--ease:cubic-bezier(.23,1,.32,1)}
html,body{width:100%;min-height:100vh;background:var(--bg);color:#fff;font-family:'Rajdhani',sans-serif;overflow-y:auto}
.sf{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse at 20% 50%,rgba(0,80,150,.12) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(80,0,150,.12) 0%,transparent 50%),var(--bg);pointer-events:none}
.spots{position:fixed;inset:0;z-index:1;pointer-events:none;overflow:hidden}
.spot{position:absolute;top:-200px;width:5px;height:110vh;background:linear-gradient(to bottom,rgba(255,255,255,.08) 0%,transparent 100%);transform-origin:top center;filter:blur(10px)}
.spot:nth-child(1){left:15%;animation:s1 8s ease-in-out infinite}
.spot:nth-child(2){left:45%;animation:s2 11s ease-in-out infinite 2s}
.spot:nth-child(3){left:70%;animation:s3 9s ease-in-out infinite 1s}
.spot:nth-child(4){left:88%;animation:s4 12s ease-in-out infinite 3s}
@keyframes s1{0%,100%{transform:rotate(-20deg)}50%{transform:rotate(18deg)}}
@keyframes s2{0%,100%{transform:rotate(25deg)}50%{transform:rotate(-18deg)}}
@keyframes s3{0%,100%{transform:rotate(-15deg)}50%{transform:rotate(22deg)}}
@keyframes s4{0%,100%{transform:rotate(20deg)}50%{transform:rotate(-25deg)}}
/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:11px 24px;border:none;border-radius:8px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:700;font-size:12px;letter-spacing:1.5px;text-transform:uppercase;transition:all .25s var(--ease)}
.btn:active{transform:scale(.97)}
.btn-gold{background:linear-gradient(135deg,#7a5900,#FFD700,#7a5900);color:#000;box-shadow:0 0 18px rgba(255,215,0,.4)}
.btn-gold:hover{box-shadow:0 0 35px rgba(255,215,0,.8);transform:translateY(-2px)}
.btn-blue{background:linear-gradient(135deg,#004466,#00D4FF,#004466);color:#fff;box-shadow:0 0 15px rgba(0,212,255,.3)}
.btn-blue:hover{box-shadow:0 0 30px rgba(0,212,255,.7);transform:translateY(-2px)}
.btn-green{background:linear-gradient(135deg,#005533,#00FF88,#005533);color:#000;box-shadow:0 0 15px rgba(0,255,136,.3)}
.btn-green:hover{box-shadow:0 0 30px rgba(0,255,136,.7);transform:translateY(-2px)}
.btn-red{background:linear-gradient(135deg,#7a001a,#FF3366,#7a001a);color:#fff;box-shadow:0 0 15px rgba(255,51,102,.3)}
.btn-red:hover{box-shadow:0 0 30px rgba(255,51,102,.7);transform:translateY(-2px)}
.btn-purple{background:linear-gradient(135deg,#3a0066,#BF00FF,#3a0066);color:#fff;box-shadow:0 0 15px rgba(191,0,255,.3)}
.btn-purple:hover{box-shadow:0 0 30px rgba(191,0,255,.7);transform:translateY(-2px)}
.btn-lg{padding:16px 40px;font-size:16px;letter-spacing:2px}
.btn-sm{padding:7px 14px;font-size:10px;letter-spacing:1px}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none!important;box-shadow:none!important}
/* INPUTS */
.inp{background:rgba(0,0,0,.4);border:1px solid rgba(0,212,255,.22);border-radius:7px;padding:10px 14px;color:#fff;font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;width:100%;transition:border-color .3s,box-shadow .3s;outline:none}
.inp:focus{border-color:var(--neon-blue);box-shadow:0 0 12px rgba(0,212,255,.3)}
.inp::placeholder{color:rgba(255,255,255,.3)}
.lbl{display:block;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;color:var(--neon-blue);margin-bottom:5px}
/* NEON TEXT */
.neon-gold{color:var(--gold);text-shadow:0 0 12px var(--gold),0 0 35px var(--gold)}
/* GLASS */
.glass{background:rgba(10,15,40,.82);backdrop-filter:blur(18px);border:1px solid rgba(0,212,255,.2);border-radius:14px}
/* NOTIFICATION */
#notif{position:fixed;top:76px;right:20px;z-index:500;padding:12px 22px;border-radius:9px;min-width:220px;font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;transform:translateX(120%);transition:transform .4s var(--ease);backdrop-filter:blur(16px)}
#notif.show{transform:translateX(0)}
#notif.ok{background:rgba(0,255,136,.12);border:1px solid var(--neon-green);color:var(--neon-green)}
#notif.err{background:rgba(255,51,102,.12);border:1px solid var(--neon-red);color:var(--neon-red)}
#notif.info{background:rgba(0,212,255,.12);border:1px solid var(--neon-blue);color:var(--neon-blue)}
/* LAYOUT */
#app{position:relative;z-index:10;min-height:100vh}
#login{min-height:100vh;display:flex;align-items:center;justify-content:center}
.login-card{padding:44px;max-width:400px;width:90%;text-align:center}
.login-title{font-family:'Bebas Neue',sans-serif;font-size:44px;color:var(--gold);margin-bottom:6px;text-shadow:0 0 15px var(--gold)}
.login-sub{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-bottom:28px}
.login-err{color:var(--neon-red);font-family:'Rajdhani',sans-serif;font-size:14px;margin-top:10px;min-height:18px}
#admin{display:none}
.ahdr{background:rgba(0,0,0,.65);backdrop-filter:blur(18px);border-bottom:1px solid rgba(0,212,255,.18);padding:14px 22px;position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.alogo{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--gold);letter-spacing:3px}
.aphase{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--neon-blue)}
.abody{display:grid;grid-template-columns:300px 1fr;min-height:calc(100vh - 78px)}
@media(max-width:900px){.abody{grid-template-columns:1fr}}
.aside{background:rgba(0,0,0,.4);border-right:1px solid rgba(0,212,255,.12);padding:16px 14px;display:flex;flex-direction:column;gap:16px;overflow-y:auto}
.aside-sec{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:14px}
.aside-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:10px}
.amain{padding:18px 22px;overflow-y:auto}
/* TABS */
.tabs{display:flex;gap:3px;margin-bottom:20px;background:rgba(0,0,0,.3);padding:5px;border-radius:10px;flex-wrap:wrap}
.tab{padding:9px 18px;border:none;border-radius:7px;background:transparent;color:rgba(255,255,255,.4);cursor:pointer;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;transition:all .3s}
.tab.on{background:rgba(0,212,255,.15);color:var(--neon-blue);box-shadow:0 0 12px rgba(0,212,255,.2)}
.tab:hover:not(.on){color:rgba(255,255,255,.7);background:rgba(255,255,255,.05)}
.tabp{display:none;animation:fadeIn .3s}
.tabp.on{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
/* SECTION CARD */
.scard{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:18px;margin-bottom:14px}
.scard-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--neon-blue);margin-bottom:12px}
/* TEAM ROWS */
.trow{display:flex;gap:7px;align-items:center;margin-bottom:7px;animation:fadeIn .3s}
/* Q CARD */
.qcard{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:11px;padding:14px;margin-bottom:10px;transition:all .3s}
.qcard:hover{border-color:rgba(0,212,255,.3)}
.qcard.sel{border-color:var(--neon-blue);background:rgba(0,212,255,.07);box-shadow:0 0 18px rgba(0,212,255,.2)}
.qhdr{display:flex;align-items:flex-start;gap:10px;margin-bottom:8px}
.qnum-lbl{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);font-weight:700;min-width:28px}
.qtext-lbl{flex:1;font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600}
.qactions{display:flex;gap:5px;flex-shrink:0}
.qorow{display:flex;gap:7px;align-items:center;margin-bottom:5px}
.qorow input{flex:1}
.corr-dot{width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,.2);cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s}
.corr-dot.on{background:var(--neon-green);border-color:var(--neon-green);box-shadow:0 0 8px var(--neon-green)}
/* LIVE CONTROL */
.ctrl-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px}
@media(max-width:800px){.ctrl-grid{grid-template-columns:1fr}}
.team-act-btn{display:flex;align-items:center;justify-content:space-between;padding:11px 13px;border-radius:8px;margin-bottom:7px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);cursor:pointer;transition:all .3s}
.team-act-btn:hover{background:rgba(0,212,255,.08);border-color:rgba(0,212,255,.3)}
.team-act-btn.on{background:rgba(0,212,255,.14);border-color:var(--neon-blue);box-shadow:0 0 14px rgba(0,212,255,.2)}
/* SIDEBAR DATA ROWS */
.lb-row{display:flex;align-items:center;gap:8px;padding:7px 9px;border-radius:7px;margin-bottom:5px;background:rgba(255,255,255,.03)}
.lb-row.at{background:rgba(0,212,255,.09);border:1px solid rgba(0,212,255,.3)}
.bet-row{display:flex;align-items:center;justify-content:space-between;padding:7px 9px;border-radius:7px;margin-bottom:4px;background:rgba(255,255,255,.03)}
.bet-row.hb{border:1px solid rgba(255,215,0,.25);background:rgba(255,215,0,.05)}
/* TIMER BIG */
.timer-big{font-family:'Orbitron',sans-serif;font-size:52px;font-weight:900;text-align:center;color:var(--neon-blue);text-shadow:0 0 18px var(--neon-blue)}
/* FOOTER */
.afoot{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:14px 22px;background:rgba(0,0,0,.5);border-top:1px solid rgba(0,212,255,.12);position:sticky;bottom:0;z-index:50}
.dot{width:9px;height:9px;border-radius:50%}
.dot.on{background:var(--neon-green);box-shadow:0 0 6px var(--neon-green)}
.dot.wait{background:var(--neon-orange);box-shadow:0 0 6px var(--neon-orange)}
.wl{display:inline-flex;padding:2px 7px;border-radius:20px;font-family:'Orbitron',sans-serif;font-size:8px;font-weight:700}
.ww{background:rgba(0,255,136,.15);color:var(--neon-green);border:1px solid rgba(0,255,136,.3)}
.wloss{background:rgba(255,51,102,.12);color:var(--neon-red);border:1px solid rgba(255,51,102,.25)}
</style>
</head>
<body>
<div class="sf"></div>
<div class="spots"><div class="spot"></div><div class="spot"></div><div class="spot"></div><div class="spot"></div></div>
<div id="notif"></div>
<div id="app">

<!-- LOGIN -->
<div id="login">
  <div class="glass login-card">
    <div class="login-title neon-gold">‚öô ADMIN</div>
    <div class="login-sub">LOGISTICS AUCTION SHOW ¬∑ MASTER CONTROL</div>
    <div style="margin-bottom:14px">
      <label class="lbl">ADMIN PASSWORD</label>
      <input class="inp" type="password" id="pw" placeholder="Enter password" style="margin-bottom:12px">
    </div>
    <button class="btn btn-gold" style="width:100%" id="login-btn">üîì ACCESS CONTROL PANEL</button>
    <div class="login-err" id="login-err"></div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="admin">
  <div class="ahdr">
    <div><div class="alogo">‚öô ADMIN CONTROL</div><div style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(255,255,255,.35)">LOGISTICS AUCTION SHOW ¬∑ MASTER</div></div>
    <div class="aphase" id="aphase">PHASE: SETUP</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-red btn-sm" id="reset-btn">üîÑ RESET</button>
      <button class="btn btn-gold btn-sm" id="display-btn">üì∫ MAIN DISPLAY</button>
    </div>
  </div>

  <div class="abody">
    <!-- SIDEBAR -->
    <div class="aside">
      <div class="aside-sec">
        <div class="aside-ttl">üèÜ LEADERBOARD</div>
        <div id="aside-lb"></div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">üí∞ LIVE BETS</div>
        <div id="aside-bets"></div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">‚ùì ACTIVE QUESTION</div>
        <div id="aside-q" style="font-family:'Rajdhani',sans-serif;font-size:12px;color:rgba(255,255,255,.6);line-height:1.5">No question selected</div>
      </div>
      <div class="aside-sec">
        <div class="aside-ttl">‚è± TIMER</div>
        <div class="timer-big" id="aside-timer">--</div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="amain">
      <div class="tabs">
        <button class="tab on" data-tab="setup">‚öô SETUP</button>
        <button class="tab" data-tab="questions">‚ùì QUESTIONS</button>
        <button class="tab" data-tab="live">üé¨ LIVE CONTROL</button>
        <button class="tab" data-tab="broadcast">üì¢ BROADCAST</button>
      </div>

      <!-- SETUP TAB -->
      <div id="tabp-setup" class="tabp on">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">PRE-GAME SETUP</h2>
        <div class="scard">
          <div class="scard-ttl">TEAM COUNT (2‚Äì10)</div>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <input class="inp" type="number" id="team-count" min="2" max="10" value="4" style="width:90px">
            <button class="btn btn-blue btn-sm" id="gen-btn">GENERATE SLOTS</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">TEAM NAMES & STARTING MONEY</div>
          <div id="team-inputs"></div>
          <div style="margin-top:12px;display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap">
            <div style="flex:1;min-width:180px">
              <label class="lbl">SET ALL TO SAME AMOUNT</label>
              <input class="inp" type="number" id="all-money" placeholder="e.g. 10000" value="10000">
            </div>
            <button class="btn btn-blue btn-sm" id="all-money-btn">APPLY ALL</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">DEFAULT TIMER (5‚Äì60 SECONDS)</div>
          <div style="display:flex;gap:10px;align-items:center">
            <input class="inp" type="number" id="timer-default" min="5" max="60" value="30" style="width:90px">
            <span style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.5)">seconds</span>
          </div>
        </div>
        <button class="btn btn-green" id="save-setup-btn">üíæ SAVE CONFIGURATION</button>
        <div id="setup-msg" style="margin-top:10px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;min-height:18px"></div>
        <div style="margin-top:24px;padding:22px;border:1px solid rgba(255,215,0,.3);border-radius:12px;background:rgba(255,215,0,.04)">
          <div style="font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:3px;color:var(--gold);margin-bottom:10px">‚ö° LAUNCH SEQUENCE</div>
          <p style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.6);margin-bottom:14px;line-height:1.6">Save configuration above, then click START LIVE SHOW. Teams open index.html on their devices and spin the wheel to claim a team slot.</p>
          <button class="btn btn-gold btn-lg" id="start-show-btn">üé¨ START LIVE SHOW</button>
        </div>
      </div>

      <!-- QUESTIONS TAB -->
      <div id="tabp-questions" class="tabp">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:20px">
          <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold)">QUESTION BANK</h2>
          <button class="btn btn-green btn-sm" id="add-q-btn">+ ADD QUESTION</button>
        </div>
        <div id="q-bank"></div>
      </div>

      <!-- LIVE CONTROL TAB -->
      <div id="tabp-live" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">LIVE SHOW CONTROL</h2>
        <div class="ctrl-grid">
          <div class="scard">
            <div class="scard-ttl">SELECT QUESTION</div>
            <select class="inp" id="q-select" style="margin-bottom:10px"><option value="-1">‚Äî Choose question ‚Äî</option></select>
            <div style="display:flex;gap:7px;flex-wrap:wrap">
              <button class="btn btn-blue btn-sm" id="set-q-btn">üìå SET QUESTION</button>
              <button class="btn btn-purple btn-sm" id="open-bet-btn">üí∞ OPEN BETTING</button>
              <button class="btn btn-red btn-sm" id="close-bet-btn">üîí CLOSE BETTING</button>
            </div>
          </div>
          <div class="scard">
            <div class="scard-ttl">TIMER CONTROL</div>
            <div style="display:flex;gap:7px;align-items:center;margin-bottom:10px">
              <input class="inp" type="number" id="timer-override" placeholder="Seconds" style="width:90px">
              <span style="font-family:'Rajdhani',sans-serif;font-size:12px;color:rgba(255,255,255,.4)">override</span>
            </div>
            <div style="display:flex;gap:7px;flex-wrap:wrap">
              <button class="btn btn-green btn-sm" id="timer-start-btn">‚ñ∂ START</button>
              <button class="btn btn-red btn-sm" id="timer-stop-btn">‚èπ STOP</button>
              <button class="btn btn-blue btn-sm" id="timer-reset-btn">‚Ü∫ RESET</button>
            </div>
          </div>
          <div class="scard" style="grid-column:span 2">
            <div class="scard-ttl">ACTIVATE TEAM TO ANSWER</div>
            <div id="team-act-list"></div>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">ANSWER RESULT</div>
          <div id="ans-display" style="font-family:'Rajdhani',sans-serif;font-size:17px;color:rgba(255,255,255,.6);margin-bottom:14px">Waiting for team answer...</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-green" id="correct-btn" disabled>‚úÖ CORRECT ‚Äî AWARD BET</button>
            <button class="btn btn-red" id="wrong-btn" disabled>‚ùå WRONG ‚Äî DEDUCT BET</button>
          </div>
        </div>
        <div class="scard" style="margin-top:16px">
          <div class="scard-ttl">END GAME</div>
          <p style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.6);margin-bottom:12px">End the show and reveal the winner. The team with the most money wins.</p>
          <button class="btn btn-gold" id="end-game-btn">üèÜ REVEAL WINNER &amp; END SHOW</button>
        </div>
      </div>

      <!-- BROADCAST TAB -->
      <div id="tabp-broadcast" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:30px;color:var(--gold);margin-bottom:18px">BROADCAST</h2>
        <div class="scard">
          <div class="scard-ttl">SEND ANNOUNCEMENT TO ALL SCREENS</div>
          <label class="lbl">MESSAGE</label>
          <textarea class="inp" id="ann-input" rows="3" placeholder="Type announcement..." style="margin-bottom:10px;resize:vertical"></textarea>
          <div style="display:flex;gap:8px">
            <button class="btn btn-gold" id="ann-send-btn">üì¢ BROADCAST NOW</button>
            <button class="btn btn-blue btn-sm" id="ann-clear-btn">‚úï CLEAR</button>
          </div>
        </div>
        <div class="scard">
          <div class="scard-ttl">QUICK MESSAGES</div>
          <div id="quick-msgs" style="display:flex;gap:7px;flex-wrap:wrap;margin-top:6px"></div>
        </div>
        <div class="scard">
          <div class="scard-ttl">MANUAL MONEY ADJUSTMENT</div>
          <div id="money-adj"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="afoot">
    <div style="display:flex;align-items:center;gap:8px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px">
      <div class="dot wait" id="phase-dot"></div>
      <span id="phase-label">SETUP PHASE</span>
    </div>
    <div style="flex:1"></div>
    <button class="btn btn-blue btn-sm" id="sync-btn">üîÑ SYNC ALL</button>
  </div>
</div>

</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";


const firebaseConfig = {
  apiKey: "AIzaSyCSyzYtCd-uiolBucZnncuIWpnE5mPG9Cs",
  authDomain: "logistics-auction-show.firebaseapp.com",
  databaseURL: "https://logistics-auction-show-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "logistics-auction-show",
  storageBucket: "logistics-auction-show.firebasestorage.app",
  messagingSenderId: "596983567254",
  appId: "1:596983567254:web:91f5b863db7464886503b7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const gameRef = ref(db, "gameState");










// LISTEN FOR LIVE UPDATES
onValue(gameRef, (snapshot) => {
  const data = snapshot.val();
  if (!data) {
    state = defaultState;
    set(gameRef, defaultState);
  } else {
    state = data;

    subscribers.forEach(cb => {
      try { cb(state); } catch(e) {}
    });
  }
});


// REPLACES S.get()
function getState(){
  return state;
}

function updateState(newData){
  update(gameRef, newData);
}


// REPLACES S.reset()
function resetState(){
  set(gameRef, defaultState);
}

// MAKE GLOBAL (so old functions still work)
window.S = {
  get: getState,
  update: updateState,
  reset: resetState,
  sub: function(callback){
    subscribers.push(callback);
  }
};
// Generate device ID once per browser
if(!localStorage.getItem('LAS_DEVICE_ID')){
  localStorage.setItem('LAS_DEVICE_ID', 'dev_' + Math.random().toString(36).substr(2,9));
}
S.did = localStorage.getItem('LAS_DEVICE_ID');

const SK='LAS_STATE';
const DQ=[
  {id:'q1',text:'What does "ETA" stand for in logistics?',options:['Estimated Time of Arrival','Electronic Tracking Agent','Express Transport Authorization','Enhanced Transit Algorithm'],correct:0},
  {id:'q2',text:'Which shipping term means the seller bears all risks until goods reach the buyer\'s destination?',options:['FOB Origin','CIF','EXW','DDP'],correct:3},
  {id:'q3',text:'What is the maximum weight allowed for a standard 20-foot intermodal shipping container?',options:['24,000 kg','28,000 kg','33,000 kg','38,000 kg'],correct:0},
  {id:'q4',text:'In "Last Mile" delivery, what does "last mile" refer to?',options:['The final 1-mile drive','Delivery from hub to end customer','International customs clearance','Warehouse-to-port transport'],correct:1},
  {id:'q5',text:'Which inventory method assumes the first item received is the first sold?',options:['LIFO','FIFO','JIT','ABC Analysis'],correct:1},
  {id:'q6',text:'What does 3PL stand for in supply chain management?',options:['Third-Party Logistics','Three-Point Loading','Triple Parcel Layer','Tri-Phase Logistics'],correct:0},
  {id:'q7',text:'Which document is required for all international ocean freight shipments?',options:['Air Waybill','Bill of Lading','Packing Slip','Purchase Order'],correct:1},
  {id:'q8',text:'What is the total time from order placement to customer delivery called?',options:['Transit Time','Lead Time','Cycle Time','Processing Time'],correct:1},
  {id:'q9',text:'Which technology uses radio waves to automatically identify and track inventory?',options:['GPS','NFC','RFID','Barcode'],correct:2},
  {id:'q10',text:'What is a "cross-dock" operation in logistics?',options:['Loading cargo across borders','Transferring goods from inbound to outbound without storage','A dock shared between two warehouses','Overnight freight handling at airports'],correct:1}
];
const defaultState = {
  phase:'lobby',
  teams:[],
  questions: JSON.parse(JSON.stringify(DQ)),  // üî• THIS LINE
  currentQuestionIndex:-1,
  activeTeam:null,
  timerDuration:30,
  timerRemaining:30,
  timerRunning:false,
  timerStartedAt:null,
  gameStarted:false,
  announcement:'',
  round:0,
  bets:{},
  bettingOpen:false,
  selectedAnswer:null,
  lastResult:null,
  winner:null,
  assignedDevices:[],
  version:0
};
let state = defaultState;
let subscribers = [];

function initSt(){return{phase:'lobby',teams:[],questions:JSON.parse(JSON.stringify(DQ)),currentQuestionIndex:-1,activeTeam:null,timerDuration:30,timerRemaining:30,timerRunning:false,timerStartedAt:null,gameStarted:false,announcement:'',round:0,bets:{},bettingOpen:false,selectedAnswer:null,lastResult:null,winner:null,assignedDevices:[],version:0}}

function $m(v){return'$'+Number(v).toLocaleString('en-US')}
function esc(s){if(typeof s!=='string')return'';return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}


const PW='admin123';
let editTeams=[];

// ‚îÄ‚îÄ‚îÄ NOTIF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function notif(msg,type='info'){const el=document.getElementById('notif');el.textContent=msg;el.className=`show ${type==='success'?'ok':type==='error'?'err':'info'}`;clearTimeout(el._t);el._t=setTimeout(()=>el.className=type==='success'?'ok':type==='error'?'err':'info',3000)}

// ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('login-btn').onclick=doLogin;
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin()});
function doLogin(){
  if(document.getElementById('pw').value===PW){
    document.getElementById('login').style.display='none';
    document.getElementById('admin').style.display='block';
    initAdmin();
  }else{document.getElementById('login-err').textContent='‚ùå Incorrect password';setTimeout(()=>document.getElementById('login-err').textContent='',2200)}
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initAdmin(){
  const st=S.get();
  editTeams = (st.teams && st.teams.length)
  ? JSON.parse(JSON.stringify(st.teams))
  : genTeams(4);

  document.getElementById('team-count').value=editTeams.length;
  document.getElementById('timer-default').value=st.timerDuration||30;
  renderTeamInputs();renderQBank();renderLive();renderSidebar();
  // button wires
  document.getElementById('gen-btn').onclick=genSlots;
  document.getElementById('all-money-btn').onclick=applyAllMoney;
  document.getElementById('save-setup-btn').onclick=saveSetup;
  document.getElementById('start-show-btn').onclick=startShow;
  document.getElementById('add-q-btn').onclick=addQ;
  document.getElementById('set-q-btn').onclick=setQ;
  document.getElementById('open-bet-btn').onclick=openBet;
  document.getElementById('close-bet-btn').onclick=closeBet;
  document.getElementById('timer-start-btn').onclick=startTimer;
  document.getElementById('timer-stop-btn').onclick=stopTimer;
  document.getElementById('timer-reset-btn').onclick=resetTimer;
  document.getElementById('correct-btn').onclick=()=>judge(true);
  document.getElementById('wrong-btn').onclick=()=>judge(false);
  document.getElementById('end-game-btn').onclick=endGame;
  document.getElementById('ann-send-btn').onclick=sendAnn;
  document.getElementById('ann-clear-btn').onclick=clearAnn;
  document.getElementById('sync-btn').onclick=()=>{S.update({});notif('All screens synced!','success')};
  document.getElementById('reset-btn').onclick=()=>{if(confirm('RESET ENTIRE GAME?')){S.reset();editTeams=genTeams(4);renderTeamInputs();renderQBank();renderLive();renderSidebar();notif('Game reset','info')}};
  document.getElementById('display-btn').onclick=()=>window.open('index.html','_blank');
  // tabs
  document.querySelectorAll('.tab').forEach(t=>t.onclick=function(){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('on'));document.querySelectorAll('.tabp').forEach(x=>x.classList.remove('on'));this.classList.add('on');document.getElementById('tabp-'+this.dataset.tab).classList.add('on')});
  // quick msgs
  const qms=[['Welcome','üé¨ Welcome to the Logistics Auction Show! Let the bidding begin!'],['Betting Open','üí∞ Betting is now OPEN ‚Äî place your bets!'],['Betting Closed','üîí Betting is closed. Activating team now...'],['Timer Start','‚è± Timer starting now ‚Äî good luck!'],['Round Done','üèÜ Great round! Get ready for the next question.'],['Stand By','‚ö† Technical break ‚Äî please stand by...']];
  document.getElementById('quick-msgs').innerHTML=qms.map(([l,m])=>`<button class="btn btn-blue btn-sm" onclick="quickMsg('${m.replace(/'/g,"\\'")}')">  ${l}</button>`).join('');
  S.sub(onChange);
  setInterval(timerTick,500);
}

function onChange(st){renderLive();renderSidebar();updatePhase(st)}
function genTeams(n){return Array.from({length:n},(_,i)=>({name:`Team ${i+1}`,money:10000,wins:0,losses:0}))}
function updatePhase(st){
  const labels={lobby:'SETUP',spin:'TEAM SPIN',pregame:'PRE-GAME',game:'LIVE GAME',reveal:'GAME OVER'};
  const lbl=labels[st.phase]||st.phase.toUpperCase();
  document.getElementById('aphase').textContent='PHASE: '+lbl;
  document.getElementById('phase-label').textContent=lbl+' PHASE';
  const dot=document.getElementById('phase-dot');
  dot.className='dot '+(st.phase==='game'?'on':'wait');
}

// TEAM INPUTS
function genSlots(){const n=parseInt(document.getElementById('team-count').value);if(isNaN(n)||n<2||n>10){notif('Enter 2‚Äì10 teams','error');return}while(editTeams.length<n)editTeams.push({name:`Team ${editTeams.length+1}`,money:10000,wins:0,losses:0});editTeams=editTeams.slice(0,n);renderTeamInputs()}
function renderTeamInputs(){
  document.getElementById('team-inputs').innerHTML=editTeams.map((t,i)=>`
    <div class="trow">
      <span style="font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);min-width:22px">${i+1}</span>
      <input class="inp" type="text" value="${esc(t.name)}" placeholder="Team name" onchange="editTeams[${i}].name=this.value" style="flex:1.5">
      <input class="inp" type="number" value="${t.money}" min="0" onchange="editTeams[${i}].money=parseInt(this.value)||0" style="width:105px">
      <button class="btn btn-red btn-sm" onclick="editTeams.splice(${i},1);document.getElementById('team-count').value=editTeams.length;renderTeamInputs()">‚úï</button>
    </div>`).join('');
}
function applyAllMoney(){const v=parseInt(document.getElementById('all-money').value);if(isNaN(v)||v<0){notif('Invalid amount','error');return}editTeams.forEach(t=>t.money=v);renderTeamInputs();notif(`All teams set to ${$m(v)}`,'success')}
function saveSetup(){
  if(editTeams.length<2){notif('Need at least 2 teams','error');return}
  const names=editTeams.map(t=>t.name.trim()).filter(Boolean);
  if(new Set(names).size!==names.length){notif('Duplicate team names!','error');return}
  const td=parseInt(document.getElementById('timer-default').value);
  if(isNaN(td)||td<5||td>60){notif('Timer must be 5‚Äì60s','error');return}
  const teams=editTeams.map(t=>({...t,name:t.name.trim()||`Team_${Date.now()}`}));
  S.update({teams,timerDuration:td,timerRemaining:td});
  notif('‚úÖ Configuration saved!','success');
  document.getElementById('setup-msg').innerHTML=`<span style="color:var(--neon-green)">‚úÖ SAVED ‚Äî ${teams.length} TEAMS CONFIGURED</span>`;
}
function startShow(){
  const st=S.get();if(!st.teams||st.teams.length<2){notif('Save team config first!','error');return}
  S.update({phase:'spin',gameStarted:true,assignedDevices:[]});
  notif('üé¨ SHOW STARTED ‚Äî Teams can now spin!','success');
}

// QUESTION BANK
function renderQBank(){
  const st=S.get();const qs=st.questions||[];
  const sel=document.getElementById('q-select');
  if(sel)sel.innerHTML='<option value="-1">‚Äî Choose question ‚Äî</option>'+qs.map((q,i)=>`<option value="${i}" ${st.currentQuestionIndex===i?'selected':''}>Q${i+1}: ${q.text.substr(0,45)}...</option>`).join('');
  const el=document.getElementById('q-bank');if(!el)return;
  el.innerHTML=qs.map((q,i)=>`
    <div class="qcard ${st.currentQuestionIndex===i?'sel':''}" id="qc-${i}">
      <div class="qhdr" id="qhdr-${i}">
        <span class="qnum-lbl">Q${i+1}</span>
        <span class="qtext-lbl">${esc(q.text)}</span>
        <div class="qactions">
          <button class="btn btn-blue btn-sm" onclick="editQ(${i})">‚úè EDIT</button>
          <button class="btn btn-red btn-sm" onclick="delQ(${i})">üóë</button>
        </div>
      </div>
      <div id="qedit-${i}" style="display:none">
        <div style="margin-bottom:8px"><label class="lbl">QUESTION TEXT</label><textarea class="inp" id="qt-${i}" rows="2">${esc(q.text)}</textarea></div>
        <div style="margin-bottom:8px"><label class="lbl">OPTIONS (click circle = correct answer)</label>
          ${q.options.map((o,j)=>`<div class="qorow"><span style="font-family:'Orbitron',sans-serif;font-size:10px;color:var(--neon-blue);min-width:18px">${'ABCD'[j]}</span><input class="inp" id="qo-${i}-${j}" value="${esc(o)}"><div class="corr-dot ${q.correct===j?'on':''}" id="cd-${i}-${j}" onclick="setCorr(${i},${j})">${q.correct===j?'‚úì':''}</div></div>`).join('')}
        </div>
        <div style="display:flex;gap:7px"><button class="btn btn-green btn-sm" onclick="saveQ(${i})">üíæ SAVE</button><button class="btn btn-blue btn-sm" onclick="cancelQ(${i})">‚úï CANCEL</button></div>
      </div>
    </div>`).join('');
}
function editQ(i){document.getElementById(`qedit-${i}`).style.display='block';document.getElementById(`qhdr-${i}`).style.display='none'}
function cancelQ(i){document.getElementById(`qedit-${i}`).style.display='none';document.getElementById(`qhdr-${i}`).style.display='flex'}
function setCorr(qi,oi){const st=S.get();const qs=JSON.parse(JSON.stringify(st.questions));qs[qi].correct=oi;S.update({questions:qs});renderQBank()}
function saveQ(i){const st=S.get();const qs=JSON.parse(JSON.stringify(st.questions));qs[i].text=document.getElementById(`qt-${i}`).value.trim();qs[i].options=[0,1,2,3].map(j=>document.getElementById(`qo-${i}-${j}`).value.trim());S.update({questions:qs});notif('Question saved!','success');renderQBank()}
function delQ(i){if(!confirm('Delete this question?'))return;const st=S.get();const qs=JSON.parse(JSON.stringify(st.questions));qs.splice(i,1);S.update({questions:qs,currentQuestionIndex:-1});renderQBank();notif('Deleted','info')}
function addQ(){const st=S.get();const qs=JSON.parse(JSON.stringify(st.questions));qs.push({id:'q_'+Date.now(),text:'New question ‚Äî click Edit to update',options:['Option A','Option B','Option C','Option D'],correct:0});S.update({questions:qs});renderQBank();setTimeout(()=>editQ(qs.length-1),80);notif('New question added','success')}

// LIVE CONTROL
function renderLive(){
  const st=S.get();
  // q selector
  const sel=document.getElementById('q-select');
  if(sel)sel.innerHTML='<option value="-1">‚Äî Choose question ‚Äî</option>'+(st.questions||[]).map((q,i)=>`<option value="${i}" ${st.currentQuestionIndex===i?'selected':''}>Q${i+1}: ${q.text.substr(0,45)}...</option>`).join('');
  // team activate
  const tal=document.getElementById('team-act-list');
  if(tal)tal.innerHTML=(st.teams||[]).map(t=>{const b=st.bets&&st.bets[t.name];const isOn=st.activeTeam===t.name;return`<div class="team-act-btn ${isOn?'on':''}" onclick="activateTeam('${esc(t.name).replace(/'/g,"\\'")}')"><div><div style="font-family:'Rajdhani',sans-serif;font-weight:700;font-size:15px;${isOn?'color:var(--neon-blue)':''}">${esc(t.name)}</div><div style="font-family:'Orbitron',sans-serif;font-size:9px;color:rgba(255,255,255,.4)">${$m(t.money)} ¬∑ W:${t.wins||0} L:${t.losses||0}${b?` ¬∑ BET:${$m(b)}`:' ¬∑ No bet'}</div></div><span style="font-size:17px">${isOn?'‚ö°':'‚óã'}</span></div>`}).join('');
  // answer display
  const ad=document.getElementById('ans-display');
  if(ad){
    if(st.selectedAnswer!==null&&st.selectedAnswer!==undefined&&st.currentQuestionIndex>=0){
      const q=st.questions[st.currentQuestionIndex];
      ad.innerHTML=`<span style="color:var(--gold)">üìù ${esc(st.activeTeam||'Team')} answered: </span><span style="color:var(--neon-blue)">[${('ABCD')[st.selectedAnswer]}] ${q?esc(q.options[st.selectedAnswer]):''}</span>`;
      document.getElementById('correct-btn').disabled=false;document.getElementById('wrong-btn').disabled=false;
    }else{ad.textContent='Waiting for team answer...';document.getElementById('correct-btn').disabled=true;document.getElementById('wrong-btn').disabled=true}
  }
  // aside q
  const aq=document.getElementById('aside-q');
  if(aq&&st.currentQuestionIndex>=0&&st.questions[st.currentQuestionIndex])aq.textContent=`Q${st.currentQuestionIndex+1}: ${st.questions[st.currentQuestionIndex].text.substr(0,80)}...`;
  // money adj
  const ma=document.getElementById('money-adj');
  if(ma)ma.innerHTML=(st.teams||[]).map((t,i)=>`<div style="display:flex;gap:7px;align-items:center;margin-bottom:7px"><span style="font-family:'Rajdhani',sans-serif;font-weight:600;min-width:120px">${esc(t.name)}</span><span style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold);min-width:75px">${$m(t.money)}</span><input class="inp" type="number" id="adj-${i}" placeholder="¬±amount" style="width:95px"><button class="btn btn-blue btn-sm" onclick="adjustMoney(${i})">APPLY</button></div>`).join('');
  renderSidebar();
}
function renderSidebar(){
  const st=S.get();
  const sorted=[...(st.teams||[])].sort((a,b)=>b.money-a.money);
  document.getElementById('aside-lb').innerHTML=sorted.map((t,i)=>`<div class="lb-row ${st.activeTeam===t.name?'at':''}"><div style="font-family:'Orbitron',sans-serif;font-size:13px;color:rgba(255,255,255,.4);min-width:22px">#${i+1}</div><div style="flex:1;font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px">${esc(t.name)}</div><div style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold)">${$m(t.money)}</div></div>`).join('');
  document.getElementById('aside-bets').innerHTML=(st.teams||[]).map(t=>{const b=st.bets&&st.bets[t.name];return`<div class="bet-row ${b?'hb':''}"><span style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:13px">${esc(t.name)}</span>${b?`<span style="font-family:'Orbitron',sans-serif;font-size:11px;color:var(--gold)">${$m(b)}</span>`:`<span style="color:rgba(255,255,255,.3);font-size:11px">waiting...</span>`}</div>`}).join('');
}

// QUESTION ACTIONS
function setQ(){const idx=parseInt(document.getElementById('q-select').value);if(idx<0){notif('Select a question first','error');return}S.update({currentQuestionIndex:idx,selectedAnswer:null,lastResult:null,bettingOpen:false,activeTeam:null,bets:{}});renderQBank();notif(`Q${idx+1} selected`,'success')}
function openBet(){const st=S.get();if(st.currentQuestionIndex<0){notif('Select a question first','error');return}S.update({bettingOpen:true,bets:{},selectedAnswer:null,lastResult:null});notif('üí∞ Betting OPEN','success');S.update({announcement:'üí∞ Betting is now OPEN ‚Äî place your bets!'})}
function closeBet(){S.update({bettingOpen:false});notif('üîí Betting CLOSED','info');S.update({announcement:'üîí Betting is closed. Activating team now...'})}
function activateTeam(name){S.update({activeTeam:name,selectedAnswer:null,lastResult:null,answerLocked:false});notif(`‚ö° ${name} activated!`,'info');S.update({announcement:`‚ö° ${name} is now answering!`})}

// TIMER
function startTimer(){const ov=parseInt(document.getElementById('timer-override').value);const st=S.get();const d=isNaN(ov)?st.timerDuration:Math.min(60,Math.max(5,ov));S.update({timerDuration:d,timerRemaining:d,timerRunning:true,timerStartedAt:Date.now()});notif(`‚ñ∂ Timer: ${d}s`,'info')}
function stopTimer(){const st=S.get();const el=(Date.now()-st.timerStartedAt)/1000;const rem=Math.max(0,st.timerRemaining-el);S.update({timerRunning:false,timerRemaining:rem});notif('‚èπ Stopped','info')}
function resetTimer(){const st=S.get();S.update({timerRunning:false,timerRemaining:st.timerDuration})}
function timerTick(){
  const st=S.get();const el=document.getElementById('aside-timer');if(!el)return;
  let rem=st.timerRemaining;
  if(st.timerRunning&&st.timerStartedAt){rem=Math.max(0,st.timerRemaining-(Date.now()-st.timerStartedAt)/1000);if(rem<=0&&st.timerRunning){S.update({timerRunning:false,timerRemaining:0});S.update({announcement:'‚è∞ TIME IS UP!'})}}
  el.textContent=Math.ceil(rem)>0?Math.ceil(rem):'00';
  el.style.color=Math.ceil(rem)<=3?'var(--neon-red)':Math.ceil(rem)<=5?'var(--neon-orange)':'var(--neon-blue)';
}

// JUDGE
function judge(correct){
  const st=S.get();
  if(!st.activeTeam||st.selectedAnswer===null||st.selectedAnswer===undefined){notif('No answer to judge','error');return}
  const ti=st.teams.findIndex(t=>t.name===st.activeTeam);if(ti<0)return;
  const teams=JSON.parse(JSON.stringify(st.teams));
  const team=teams[ti];
  const bet=st.bets&&st.bets[st.activeTeam]?parseInt(st.bets[st.activeTeam]):0;
  if(correct){team.money+=bet;team.wins=(team.wins||0)+1}else{team.money=Math.max(0,team.money-bet);team.losses=(team.losses||0)+1}
  S.update({teams,lastResult:{teamName:st.activeTeam,correct,betAmount:bet,timestamp:Date.now()},timerRunning:false,activeTeam:null,bettingOpen:false});
  notif(correct?`‚úÖ ${st.activeTeam} CORRECT! +${$m(bet)}`:`‚ùå ${st.activeTeam} WRONG! -${$m(bet)}`,correct?'success':'error');
  S.update({announcement:correct?`‚úÖ ${st.activeTeam} got it RIGHT! +${$m(bet)}`:`‚ùå ${st.activeTeam} got it WRONG! -${$m(bet)}`});
}
function adjustMoney(i){const st=S.get();const v=parseInt(document.getElementById(`adj-${i}`).value);if(isNaN(v)){notif('Invalid amount','error');return}const teams=JSON.parse(JSON.stringify(st.teams));teams[i].money=Math.max(0,teams[i].money+v);S.update({teams});document.getElementById(`adj-${i}`).value='';notif(`${teams[i].name}: ${v>0?'+':''}${$m(v)}`,'info')}
function endGame(){const st=S.get();if(!st.teams||!st.teams.length){notif('No teams!','error');return}if(!confirm('End the show and reveal the winner?'))return;const winner=[...st.teams].sort((a,b)=>b.money-a.money)[0];S.update({phase:'reveal',winner,timerRunning:false});notif(`üèÜ ${winner.name} WINS!`,'success')}

// ANNOUNCEMENTS
function sendAnn(){const m=document.getElementById('ann-input').value.trim();if(!m){notif('Enter a message','error');return}S.update({announcement:m});notif('üì¢ Broadcast sent!','success')}
function clearAnn(){S.update({announcement:''});document.getElementById('ann-input').value=''}
function quickMsg(m){document.getElementById('ann-input').value=m;sendAnn()}

S.sub(st=>{renderLive();renderSidebar();updatePhase(st)});
</script>




</body>
</html>
