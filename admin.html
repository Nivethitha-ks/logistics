<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN Â· LOGISTICS AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--gold:#F5C518;--nb:#00C9FF;--ng:#00E878;--nr:#FF2D55;--no:#FF9500;--np:#BF5FFF;--bg:#06070F}
html,body{width:100%;min-height:100vh;background:var(--bg);color:#fff;font-family:'Rajdhani',sans-serif}
#bg{position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(ellipse 70% 50% at 20% 40%,rgba(0,80,160,.18),transparent 60%),radial-gradient(ellipse 60% 45% at 80% 15%,rgba(100,0,180,.15),transparent 55%)}
#app{position:relative;z-index:5;min-height:100vh}
#phasebar{position:fixed;top:0;left:0;right:0;height:4px;z-index:999;transition:background 1s,box-shadow 1s;background:rgba(0,201,255,.5)}
#notif{position:fixed;top:22px;right:22px;z-index:9999;padding:12px 22px;border-radius:8px;min-width:200px;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:1.5px;transform:translateX(140%);transition:transform .4s;pointer-events:none;background:rgba(0,201,255,.1);border:1px solid var(--nb);color:var(--nb)}
#notif.show{transform:translateX(0)}
#notif.ok{background:rgba(0,232,120,.12);border-color:var(--ng);color:var(--ng)}
#notif.err{background:rgba(255,45,85,.12);border-color:var(--nr);color:var(--nr)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:12px 26px;border:none;border-radius:9px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:700;font-size:11px;letter-spacing:2px;text-transform:uppercase;transition:all .25s;position:relative;overflow:hidden}
.btn:hover{filter:brightness(1.2);transform:translateY(-2px)}
.btn:active{transform:scale(.96)!important;filter:brightness(.9)}
.btn-gold{background:linear-gradient(135deg,#4a3000,var(--gold),#4a3000);color:#000;box-shadow:0 0 22px rgba(245,197,24,.4)}
.btn-blue{background:linear-gradient(135deg,#003050,var(--nb),#003050);color:#fff;box-shadow:0 0 18px rgba(0,201,255,.3)}
.btn-green{background:linear-gradient(135deg,#004020,var(--ng),#004020);color:#000;box-shadow:0 0 18px rgba(0,232,120,.3)}
.btn-red{background:linear-gradient(135deg,#500015,var(--nr),#500015);color:#fff;box-shadow:0 0 18px rgba(255,45,85,.3)}
.btn-sm{padding:8px 16px;font-size:9px;letter-spacing:1.5px}
.btn-lg{padding:16px 44px;font-size:14px;letter-spacing:2.5px}
.btn:disabled{opacity:.3;cursor:not-allowed;transform:none!important;filter:none!important;box-shadow:none!important}
.inp{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:8px;padding:10px 14px;color:#fff;font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;width:100%;outline:none;transition:.3s}
.inp:focus{border-color:var(--nb);box-shadow:0 0 12px rgba(0,201,255,.2)}
.inp::placeholder{color:rgba(255,255,255,.25)}
.lbl{display:block;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2.5px;color:var(--nb);margin-bottom:5px}
/* LOGIN */
#login{min-height:100vh;display:flex;align-items:center;justify-content:center}
.lcard{width:min(420px,92vw);background:rgba(12,14,26,.95);backdrop-filter:blur(24px);border:1px solid rgba(0,201,255,.25);border-radius:18px;padding:48px 40px;text-align:center}
.l-eyebrow{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:5px;color:rgba(255,255,255,.3);margin-bottom:14px}
.l-title{font-family:'Bebas Neue',sans-serif;font-size:54px;color:var(--gold);text-shadow:0 0 20px var(--gold);margin-bottom:4px;letter-spacing:4px}
.l-sub{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:rgba(255,255,255,.35);margin-bottom:36px}
.l-err{color:var(--nr);font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;margin-top:10px;min-height:16px}
/* ADMIN */
#admin{display:none}
.a-hdr{background:rgba(6,7,15,.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,.08);padding:14px 24px;position:sticky;top:0;z-index:200;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.a-logo{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--gold);letter-spacing:4px}
.phase-badge{display:inline-flex;align-items:center;gap:8px;padding:5px 14px;border-radius:6px;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;background:rgba(0,201,255,.1);border:1px solid rgba(0,201,255,.3);color:var(--nb)}
.pdot{width:8px;height:8px;border-radius:50%;background:var(--nb);animation:pdot 1.2s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1}50%{opacity:.3}}
.a-body{display:grid;grid-template-columns:280px 1fr;min-height:calc(100vh - 62px)}
@media(max-width:900px){.a-body{grid-template-columns:1fr}}
.aside{padding:16px 14px;background:rgba(0,0,0,.35);border-right:1px solid rgba(255,255,255,.06);display:flex;flex-direction:column;gap:12px;overflow-y:auto;max-height:calc(100vh - 62px);position:sticky;top:62px}
.amain{padding:20px 24px;overflow-y:auto}
.sc{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px}
.sc-ttl{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:3px;color:rgba(255,255,255,.4);margin-bottom:10px}
.tabs{display:flex;gap:3px;background:rgba(0,0,0,.4);padding:5px;border-radius:10px;margin-bottom:22px;flex-wrap:wrap}
.tab{padding:10px 20px;border:none;border-radius:7px;background:transparent;color:rgba(255,255,255,.35);cursor:pointer;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;transition:.3s}
.tab.on{background:rgba(0,201,255,.15);color:var(--nb);box-shadow:0 0 14px rgba(0,201,255,.2)}
.tab:hover:not(.on){color:rgba(255,255,255,.7);background:rgba(255,255,255,.06)}
.tabp{display:none;animation:tpf .3s}
.tabp.on{display:block}
@keyframes tpf{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.mc{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:20px;margin-bottom:16px}
.mc-ttl{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:3px;color:var(--nb);margin-bottom:14px}
.trow{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.qcard{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.08);border-radius:11px;padding:14px;margin-bottom:9px;transition:.3s}
.qcard:hover{border-color:rgba(0,201,255,.3)}
.qcard.sel{border-color:var(--nb);background:rgba(0,201,255,.07);box-shadow:0 0 20px rgba(0,201,255,.15)}
.qhdr{display:flex;align-items:flex-start;gap:10px}
.qnl{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--nb);font-weight:700;min-width:28px;margin-top:2px}
.qtext{flex:1;font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;line-height:1.45}
.qbody{overflow:hidden;max-height:0;transition:max-height .4s}
.qbody.open{max-height:700px;margin-top:12px}
.qorow{display:flex;gap:8px;align-items:center;margin-bottom:7px}
.cdot{width:22px;height:22px;border-radius:50%;border:2px solid rgba(255,255,255,.2);cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;transition:.2s}
.cdot.on{background:var(--ng);border-color:var(--ng);box-shadow:0 0 10px var(--ng)}
.act-btn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:11px 14px;border-radius:9px;border:1px solid rgba(255,255,255,.09);background:rgba(255,255,255,.03);cursor:pointer;color:#fff;font-family:inherit;transition:.3s;margin-bottom:7px;text-align:left}
.act-btn:hover{background:rgba(0,201,255,.08);border-color:rgba(0,201,255,.3)}
.act-btn.on{background:rgba(0,232,120,.1);border-color:rgba(0,232,120,.4);box-shadow:0 0 16px rgba(0,232,120,.12)}
.lbr{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:7px;margin-bottom:4px;background:rgba(255,255,255,.03)}
.lbr.at{background:rgba(0,201,255,.09);border:1px solid rgba(0,201,255,.25)}
.betr{display:flex;align-items:center;justify-content:space-between;padding:6px 9px;border-radius:6px;margin-bottom:4px;background:rgba(255,255,255,.03)}
.betr.hb{border:1px solid rgba(245,197,24,.2);background:rgba(245,197,24,.05)}
.tbig{font-family:'Orbitron',sans-serif;font-weight:900;font-size:56px;text-align:center;color:var(--nb);text-shadow:0 0 20px var(--nb);line-height:1}
.tbig.warn{color:var(--no);text-shadow:0 0 20px var(--no)}
.tbig.dang{color:var(--nr);text-shadow:0 0 30px var(--nr);animation:tpulse .3s ease-in-out infinite}
@keyframes tpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
.flow{display:flex;align-items:center;gap:7px;flex-wrap:wrap;padding:12px 14px;background:rgba(0,0,0,.3);border-radius:10px;margin-bottom:16px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:1px}
.fstep{padding:5px 9px;border-radius:5px;white-space:nowrap}
.farrow{color:rgba(255,255,255,.25);font-size:12px}
.ans-box{padding:14px 16px;border-radius:9px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);font-family:'Rajdhani',sans-serif;font-size:16px;min-height:52px;display:flex;align-items:center;transition:.4s;margin-bottom:14px}
.a-foot{padding:12px 24px;background:rgba(0,0,0,.6);border-top:1px solid rgba(255,255,255,.07);display:flex;align-items:center;gap:14px;flex-wrap:wrap;position:sticky;bottom:0;z-index:100}
.cgrid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:800px){.cgrid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="bg"></div>
<div id="phasebar"></div>
<div id="notif"></div>
<div id="app">

<div id="login">
  <div class="lcard">
    <div class="l-eyebrow">MASTER CONTROL PANEL</div>
    <div class="l-title">ADMIN</div>
    <div class="l-sub">LOGISTICS AUCTION SHOW</div>
    <label class="lbl" style="margin-bottom:6px">PASSWORD</label>
    <input class="inp" type="password" id="pw" placeholder="admin123" style="margin-bottom:16px;text-align:center;letter-spacing:6px">
    <button class="btn btn-gold" style="width:100%;font-size:14px;padding:16px" id="L_btn">ğŸ”“ ACCESS PANEL</button>
    <div class="l-err" id="lerr"></div>
  </div>
</div>

<div id="admin">
  <div class="a-hdr">
    <div class="a-logo">âš™ ADMIN</div>
    <div style="width:1px;height:24px;background:rgba(255,255,255,.12)"></div>
    <div class="phase-badge" id="phase-badge"><div class="pdot" id="pdot"></div><span id="phase-lbl">LOBBY</span></div>
    <div style="flex:1"></div>
    <button class="btn btn-blue btn-sm" id="A_display">ğŸ“º DISPLAY</button>
    <button class="btn btn-red btn-sm" id="A_reset">ğŸ”„ RESET</button>
  </div>

  <div class="a-body">
    <div class="aside">
      <div class="sc">
        <div class="sc-ttl">â± LIVE TIMER</div>
        <div class="tbig" id="S_timer">--</div>
        <div style="text-align:center;margin-top:7px;font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:2px;color:rgba(255,255,255,.3)" id="S_tstatus">STOPPED</div>
      </div>
      <div class="sc"><div class="sc-ttl">ğŸ† LEADERBOARD</div><div id="S_lb"></div></div>
      <div class="sc"><div class="sc-ttl">ğŸ’° LIVE BETS</div><div id="S_bets"></div></div>
      <div class="sc"><div class="sc-ttl">â“ ACTIVE QUESTION</div><div id="S_q" style="font-family:'Rajdhani',sans-serif;font-size:12px;line-height:1.5;color:rgba(255,255,255,.5)">None</div></div>
    </div>

    <div class="amain">
      <div class="tabs">
        <button class="tab on" data-t="setup">âš™ SETUP</button>
        <button class="tab" data-t="questions">â“ QUESTIONS</button>
        <button class="tab" data-t="live">ğŸ¬ LIVE</button>
        <button class="tab" data-t="broadcast">ğŸ“¢ BROADCAST</button>
      </div>

      <div id="tabp-setup" class="tabp on">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--gold);margin-bottom:20px;letter-spacing:3px">PRE-SHOW SETUP</h2>
        <div class="mc">
          <div class="mc-ttl">TEAM CONFIGURATION</div>
          <div style="display:flex;gap:10px;align-items:flex-end;margin-bottom:14px;flex-wrap:wrap">
            <div><label class="lbl">TEAM COUNT (2â€“10)</label><input class="inp" type="number" id="teamCount" min="2" max="10" value="4" style="width:80px"></div>
            <button class="btn btn-blue btn-sm" id="A_gen">GENERATE</button>
          </div>
          <div id="teamInputs"></div>
          <div style="display:flex;gap:10px;align-items:flex-end;margin-top:10px;flex-wrap:wrap">
            <div style="flex:1;min-width:160px"><label class="lbl">SET ALL MONEY TO</label><input class="inp" type="number" id="allMoney" value="10000"></div>
            <button class="btn btn-blue btn-sm" id="A_allMoney">APPLY</button>
          </div>
        </div>
        <div class="mc">
          <div class="mc-ttl">TIMER DEFAULT (5â€“120s)</div>
          <div style="display:flex;gap:10px;align-items:center">
            <input class="inp" type="number" id="timerDef" min="5" max="120" value="30" style="width:90px">
            <span style="color:rgba(255,255,255,.4);font-family:'Rajdhani',sans-serif">seconds per question</span>
          </div>
        </div>
        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
          <button class="btn btn-green" id="A_save">ğŸ’¾ SAVE CONFIG</button>
        </div>
        <div id="setupMsg" style="font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;min-height:18px;margin-bottom:22px"></div>
        <div style="padding:22px;border:1px solid rgba(245,197,24,.3);border-radius:14px;background:rgba(245,197,24,.04)">
          <div style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--gold);margin-bottom:10px">LAUNCH SEQUENCE</div>
          <p style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.5);margin-bottom:16px;line-height:1.6">Save config first, then START. Teams open <strong style="color:var(--nb)">index.html</strong> to spin and join.</p>
          <button class="btn btn-gold btn-lg" id="A_start">â–¶ START LIVE SHOW</button>
        </div>
      </div>

      <div id="tabp-questions" class="tabp">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;flex-wrap:wrap;gap:10px">
          <h2 style="font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--gold);letter-spacing:3px">QUESTION BANK</h2>
          <button class="btn btn-green btn-sm" id="A_addQ">+ ADD QUESTION</button>
        </div>
        <div id="qBank"></div>
      </div>

      <div id="tabp-live" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--gold);margin-bottom:18px;letter-spacing:3px">LIVE CONTROL</h2>
        <div class="flow">
          <div class="fstep" style="background:rgba(0,201,255,.14);color:var(--nb)">1 SELECT Q</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(245,197,24,.12);color:var(--gold)">2 OPEN BETTING</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(191,95,255,.12);color:var(--np)">3 TEAMS BET</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(255,45,85,.1);color:var(--nr)">4 CLOSE &amp; REVEAL</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(0,232,120,.1);color:var(--ng)">5 ACTIVATE + TIMER</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(255,149,0,.1);color:var(--no)">6 JUDGE</div>
        </div>
        <div class="cgrid">
          <div class="mc">
            <div class="mc-ttl">STEP 1 Â· SELECT QUESTION</div>
            <select class="inp" id="qSelect" style="margin-bottom:10px"><option value="-1">â€” Choose question â€”</option></select>
            <button class="btn btn-blue btn-sm" id="A_setQ">ğŸ“Œ SET QUESTION</button>
          </div>
          <div class="mc" style="border-color:rgba(245,197,24,.25)">
            <div class="mc-ttl" style="color:var(--gold)">STEP 2 Â· BETTING</div>
            <p style="font-family:'Rajdhani',sans-serif;font-size:13px;color:rgba(255,255,255,.5);margin-bottom:12px;line-height:1.5">Teams see <strong style="color:var(--gold)">question text only</strong> â€” options hidden until you close betting.</p>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-gold" id="A_openBet">ğŸ’° OPEN BETTING</button>
              <button class="btn btn-red" id="A_closeBet">ğŸ”’ CLOSE &amp; REVEAL</button>
            </div>
          </div>
          <div class="mc" style="border-color:rgba(0,201,255,.2)">
            <div class="mc-ttl">STEP 3 Â· TIMER</div>
            <input class="inp" type="number" id="timerOvr" placeholder="Override seconds (blank=default)" style="margin-bottom:12px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-green btn-sm" id="A_timerStart">â–¶ START</button>
              <button class="btn btn-red btn-sm" id="A_timerStop">â¹ STOP</button>
              <button class="btn btn-blue btn-sm" id="A_timerReset">â†º RESET</button>
            </div>
          </div>
          <div class="mc" style="border-color:rgba(0,232,120,.18)">
            <div class="mc-ttl">STEP 3 Â· ACTIVATE TEAM</div>
            <div id="teamActList"></div>
          </div>
        </div>
        <div class="mc" style="border-color:rgba(255,149,0,.2)">
          <div class="mc-ttl" style="color:var(--no)">STEP 4 Â· JUDGE ANSWER</div>
          <div class="ans-box" id="ansDisplay">â³ Waiting for team answer...</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-green" id="A_correct" disabled>âœ… CORRECT â€” AWARD BET</button>
            <button class="btn btn-red" id="A_wrong" disabled>âŒ WRONG â€” DEDUCT BET</button>
          </div>
        </div>
        <div class="mc">
          <div class="mc-ttl">GAME FLOW</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-blue" id="A_nextQ">â­ NEXT QUESTION</button>
            <button class="btn btn-gold btn-lg" id="A_endGame">ğŸ† END SHOW &amp; REVEAL WINNER</button>
          </div>
        </div>
      </div>

      <div id="tabp-broadcast" class="tabp">
        <h2 style="font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--gold);margin-bottom:20px;letter-spacing:3px">BROADCAST</h2>
        <div class="mc">
          <div class="mc-ttl">ANNOUNCEMENT TO ALL SCREENS</div>
          <textarea class="inp" id="annInput" rows="3" placeholder="Type announcement..." style="margin-bottom:12px;resize:vertical"></textarea>
          <div style="display:flex;gap:8px"><button class="btn btn-gold" id="A_annSend">ğŸ“¢ BROADCAST</button><button class="btn btn-blue btn-sm" id="A_annClear">âœ• CLEAR</button></div>
        </div>
        <div class="mc">
          <div class="mc-ttl">QUICK MESSAGES</div>
          <div id="quickMsgs" style="display:flex;gap:7px;flex-wrap:wrap;margin-top:4px"></div>
        </div>
        <div class="mc"><div class="mc-ttl">MANUAL MONEY ADJUSTMENT</div><div id="moneyAdj"></div></div>
      </div>
    </div>
  </div>

  <div class="a-foot">
    <div style="font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(255,255,255,.3)">LOGISTICS AUCTION SHOW Â· ADMIN</div>
    <div style="flex:1"></div>
    <button class="btn btn-blue btn-sm" id="A_sync">ğŸ”„ SYNC</button>
  </div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var FB_CONFIG = {
  apiKey: "AIzaSyCSyzYtCd-uiolBucZnncuIWpnE5mPG9Cs",
  authDomain: "logistics-auction-show.firebaseapp.com",
  databaseURL: "https://logistics-auction-show-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "logistics-auction-show",
  storageBucket: "logistics-auction-show.firebasestorage.app",
  messagingSenderId: "596983567254",
  appId: "1:596983567254:web:91f5b863db7464886503b7"
};
try { firebase.initializeApp(FB_CONFIG); } catch(e) { document.body.innerHTML='<div style="position:fixed;inset:0;background:#000;color:#FF2D55;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;font-family:monospace;font-size:18px;z-index:9999"><div>âš  Firebase Error</div><div style="font-size:14px;color:#fff">'+e.message+'</div><div style="font-size:12px;color:rgba(255,255,255,.5)">Make sure you are serving files via HTTP (not file://)</div></div>'; }
var DB = firebase.database();
var GREF = DB.ref('gameState');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEFAULT QUESTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var DEFAULT_Q = [
  {id:'q1',text:'What does ETA stand for in logistics?',options:['Estimated Time of Arrival','Electronic Tracking Agent','Express Transport Authorization','Enhanced Transit Algorithm'],correct:0},
  {id:'q2',text:'Which Incoterm means seller bears all risk until buyer destination?',options:['FOB Origin','CIF','EXW','DDP'],correct:3},
  {id:'q3',text:'What is a cross-dock operation?',options:['Loading cargo across borders','Transfer inbound to outbound without storage','A shared dock between warehouses','Overnight freight handling'],correct:1},
  {id:'q4',text:'What does 3PL stand for?',options:['Third-Party Logistics','Three-Point Loading','Triple Parcel Layer','Tri-Phase Logistics'],correct:0},
  {id:'q5',text:'Which technology uses radio waves to track inventory?',options:['GPS','NFC','RFID','Barcode'],correct:2},
  {id:'q6',text:'Which inventory method assumes first item received is first sold?',options:['LIFO','FIFO','JIT','ABC Analysis'],correct:1},
  {id:'q7',text:'What document is required for international ocean freight?',options:['Air Waybill','Bill of Lading','Packing Slip','Purchase Order'],correct:1},
  {id:'q8',text:'What is "last mile" delivery?',options:['Final 1-mile drive','Delivery from hub to end customer','International customs','Warehouse to port transport'],correct:1},
  {id:'q9',text:'Total time from order to customer delivery?',options:['Transit Time','Lead Time','Cycle Time','Processing Time'],correct:1},
  {id:'q10',text:'What does SKU stand for?',options:['Stock Keeping Unit','Supply Key Update','Store Knowledge Upload','Shipment Kit Utility'],correct:0}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function freshState() {
  return {
    phase: 'lobby', version: Date.now(),
    teams: [], questions: JSON.parse(JSON.stringify(DEFAULT_Q)),
    currentQuestionIndex: -1, activeTeam: null,
    timerDuration: 30, timerRemaining: 30, timerRunning: false, timerStartedAt: null,
    announcement: '', round: 0, bets: {},
    selectedAnswer: null, lastResult: null, winner: null, assignedDevices: []
  };
}
var ST = freshState();
var editTeams = [];
var adminReady = false;
var _autoJudged = false;

function $m(v) { return '$' + Number(v || 0).toLocaleString(); }
function esc(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function clone(o) { return JSON.parse(JSON.stringify(o)); }
function upd(patch) { GREF.update(patch); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function notif(msg, type) {
  var el = document.getElementById('notif');
  el.textContent = msg;
  var map = {success:'ok', error:'err', info:'info'};
  el.className = 'show ' + (map[type] || 'info');
  clearTimeout(el._t);
  el._t = setTimeout(function() { el.className = (el.className || '').replace('show','').trim(); }, 3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE LISTENER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GREF.on('value', function(snap) {
  var d = snap.val();
  if (!d) { ST = freshState(); GREF.set(ST); return; }
  ST = d;
  if (adminReady) onST(ST);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN - wired at bottom after DOM ready
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin() {
  var pw = document.getElementById('pw').value;
  if (pw === 'admin123') {
    document.getElementById('login').style.display = 'none';
    document.getElementById('admin').style.display = 'block';
    initAdmin();
  } else {
    document.getElementById('lerr').textContent = 'Wrong password. Hint: admin123';
    setTimeout(function() { document.getElementById('lerr').textContent = ''; }, 3000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE COLORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var PINFO = {
  lobby:     {l:'LOBBY',     c:'#00C9FF'},
  spin:      {l:'SPIN',      c:'#BF5FFF'},
  betting:   {l:'BETTING',   c:'#F5C518'},
  answering: {l:'ANSWERING', c:'#00E878'},
  result:    {l:'RESULT',    c:'#FF9500'},
  reveal:    {l:'CHAMPION',  c:'#F5C518'}
};
function updatePhaseUI(phase) {
  var info = PINFO[phase] || {l: phase.toUpperCase(), c: '#00C9FF'};
  document.getElementById('phasebar').style.cssText = 'position:fixed;top:0;left:0;right:0;height:4px;z-index:999;background:linear-gradient(90deg,transparent,' + info.c + ',transparent);box-shadow:0 0 16px ' + info.c;
  document.getElementById('phase-lbl').textContent = info.l;
  var badge = document.getElementById('phase-badge');
  badge.style.cssText = 'display:inline-flex;align-items:center;gap:8px;padding:5px 14px;border-radius:6px;font-family:Orbitron,sans-serif;font-size:9px;letter-spacing:2px;background:' + info.c + '18;border:1px solid ' + info.c + '44;color:' + info.c;
  document.getElementById('pdot').style.background = info.c;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ON STATE CHANGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onST(st) {
  updatePhaseUI(st.phase);
  renderSidebar(st);
  renderLivePanel(st);
  renderQBank(st);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAdmin() {
  editTeams = ST.teams && ST.teams.length ? clone(ST.teams) : genDT(4);
  document.getElementById('teamCount').value = editTeams.length;
  document.getElementById('timerDef').value = ST.timerDuration || 30;
  renderTeamInputs();
  renderQBank(ST);
  renderSidebar(ST);
  renderLivePanel(ST);
  renderBroadcast();
  updatePhaseUI(ST.phase);
  adminReady = true;
  setInterval(timerTick, 250);
}
function genDT(n) {
  var arr = [];
  for (var i = 0; i < n; i++) arr.push({name: 'Team ' + (i+1), money: 10000, wins: 0, losses: 0});
  return arr;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEAM SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genSlots() {
  var n = parseInt(document.getElementById('teamCount').value);
  if (isNaN(n) || n < 2 || n > 10) { notif('2-10 teams', 'error'); return; }
  while (editTeams.length < n) editTeams.push({name:'Team '+(editTeams.length+1),money:10000,wins:0,losses:0});
  editTeams = editTeams.slice(0, n);
  renderTeamInputs();
}
function renderTeamInputs() {
  var el = document.getElementById('teamInputs');
  var html = '';
  for (var i = 0; i < editTeams.length; i++) {
    var t = editTeams[i];
    html += '<div class="trow">' +
      '<span style="font-family:Orbitron,sans-serif;font-size:10px;color:var(--nb);min-width:24px;font-weight:700">' + (i+1) + '</span>' +
      '<input class="inp" type="text" value="' + esc(t.name) + '" data-tn="' + i + '" style="flex:2" placeholder="Team name">' +
      '<input class="inp" type="number" value="' + (t.money || 10000) + '" data-tm="' + i + '" style="width:110px">' +
      '<button class="btn btn-red btn-sm" data-td="' + i + '">âœ•</button>' +
      '</div>';
  }
  el.innerHTML = html;
  var tns = el.querySelectorAll('[data-tn]');
  for (var i = 0; i < tns.length; i++) {
    (function(elem) {
      elem.addEventListener('input', function() { editTeams[parseInt(elem.dataset.tn)].name = elem.value; });
    })(tns[i]);
  }
  var tms = el.querySelectorAll('[data-tm]');
  for (var i = 0; i < tms.length; i++) {
    (function(elem) {
      elem.addEventListener('input', function() { editTeams[parseInt(elem.dataset.tm)].money = parseInt(elem.value) || 0; });
    })(tms[i]);
  }
  var tds = el.querySelectorAll('[data-td]');
  for (var i = 0; i < tds.length; i++) {
    (function(elem) {
      elem.addEventListener('click', function() {
        editTeams.splice(parseInt(elem.dataset.td), 1);
        document.getElementById('teamCount').value = editTeams.length;
        renderTeamInputs();
      });
    })(tds[i]);
  }
}
function applyAll() {
  var v = parseInt(document.getElementById('allMoney').value);
  if (isNaN(v) || v < 0) { notif('Invalid amount', 'error'); return; }
  for (var i = 0; i < editTeams.length; i++) editTeams[i].money = v;
  renderTeamInputs();
  notif('Applied!', 'success');
}
function saveSetup() {
  var tns = document.querySelectorAll('[data-tn]');
  for (var i = 0; i < tns.length; i++) editTeams[parseInt(tns[i].dataset.tn)].name = tns[i].value.trim() || 'Team '+(parseInt(tns[i].dataset.tn)+1);
  var tms = document.querySelectorAll('[data-tm]');
  for (var i = 0; i < tms.length; i++) editTeams[parseInt(tms[i].dataset.tm)].money = parseInt(tms[i].value) || 0;
  if (editTeams.length < 2) { notif('Need 2+ teams', 'error'); return; }
  var names = editTeams.map(function(t) { return t.name; });
  var uniq = {};
  for (var i = 0; i < names.length; i++) { if (uniq[names[i]]) { notif('Duplicate names!', 'error'); return; } uniq[names[i]] = 1; }
  var td = parseInt(document.getElementById('timerDef').value) || 30;
  upd({teams: clone(editTeams), timerDuration: td, timerRemaining: td});
  notif('Config saved!', 'success');
  document.getElementById('setupMsg').innerHTML = '<span style="color:var(--ng)">âœ… ' + editTeams.length + ' TEAMS SAVED</span>';
}
function startShow() {
  if (!ST.teams || ST.teams.length < 2) { notif('Save config first!', 'error'); return; }
  upd({phase: 'spin', assignedDevices: [], announcement: 'ğŸ¬ SHOW STARTING! Open index.html to spin and join!'});
  notif('Show started!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION BANK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQBank(st) {
  var qs = Array.isArray(st.questions) ? st.questions : [];
  // Sync select
  var sel = document.getElementById('qSelect');
  if (sel) {
    var opts = '<option value="-1">â€” Choose question â€”</option>';
    for (var i = 0; i < qs.length; i++) {
      var q = qs[i];
      var txt = q.text.length > 48 ? q.text.substr(0, 48) + '...' : q.text;
      opts += '<option value="' + i + '"' + (st.currentQuestionIndex === i ? ' selected' : '') + '>Q' + (i+1) + ': ' + esc(txt) + '</option>';
    }
    sel.innerHTML = opts;
  }
  var el = document.getElementById('qBank');
  if (!el) return;
  var html = '';
  for (var i = 0; i < qs.length; i++) {
    var q = qs[i];
    html += '<div class="qcard ' + (st.currentQuestionIndex === i ? 'sel' : '') + '" id="qcard-' + i + '">';
    html += '<div class="qhdr"><span class="qnl">Q' + (i+1) + '</span><div class="qtext">' + esc(q.text) + '</div>';
    html += '<button style="border:none;background:transparent;cursor:pointer;color:rgba(255,255,255,.4);font-size:16px;padding:4px" data-qe="' + i + '" title="Edit">âœ</button>';
    html += '<button style="border:none;background:transparent;cursor:pointer;color:rgba(255,100,100,.5);font-size:16px;padding:4px" data-qd="' + i + '" title="Delete">ğŸ—‘</button>';
    html += '</div>';
    html += '<div class="qbody" id="qbody-' + i + '">';
    html += '<div style="margin-bottom:10px"><label class="lbl">QUESTION</label><textarea class="inp" id="qt-' + i + '" rows="2">' + esc(q.text) + '</textarea></div>';
    html += '<div style="margin-bottom:10px"><label class="lbl">OPTIONS (click â— = correct)</label>';
    var letters = ['A','B','C','D'];
    for (var j = 0; j < q.options.length; j++) {
      html += '<div class="qorow">';
      html += '<span style="font-family:Orbitron,sans-serif;font-size:10px;color:var(--nb);min-width:18px;font-weight:700">' + letters[j] + '</span>';
      html += '<input class="inp" id="qo-' + i + '-' + j + '" value="' + esc(q.options[j]) + '" style="flex:1">';
      html += '<div class="cdot ' + (q.correct === j ? 'on' : '') + '" data-qi="' + i + '" data-qj="' + j + '">' + (q.correct === j ? 'âœ“' : '') + '</div>';
      html += '</div>';
    }
    html += '</div>';
    html += '<div style="display:flex;gap:8px"><button class="btn btn-green btn-sm" data-qs="' + i + '">ğŸ’¾ SAVE</button><button class="btn btn-blue btn-sm" data-qc="' + i + '">âœ• CANCEL</button></div>';
    html += '</div></div>';
  }
  el.innerHTML = html;
  // Wire question buttons
  var qes = el.querySelectorAll('[data-qe]');
  for (var i = 0; i < qes.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        var body = document.getElementById('qbody-' + btn.dataset.qe);
        if (body) body.classList.toggle('open');
      });
    })(qes[i]);
  }
  var qds = el.querySelectorAll('[data-qd]');
  for (var i = 0; i < qds.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        if (!confirm('Delete this question?')) return;
        var qs2 = clone(ST.questions || []);
        qs2.splice(parseInt(btn.dataset.qd), 1);
        upd({questions: qs2, currentQuestionIndex: -1});
        notif('Deleted', 'info');
      });
    })(qds[i]);
  }
  var qss = el.querySelectorAll('[data-qs]');
  for (var i = 0; i < qss.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() { saveQ(parseInt(btn.dataset.qs)); });
    })(qss[i]);
  }
  var qcs = el.querySelectorAll('[data-qc]');
  for (var i = 0; i < qcs.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        var body = document.getElementById('qbody-' + btn.dataset.qc);
        if (body) body.classList.remove('open');
      });
    })(qcs[i]);
  }
  var cdots = el.querySelectorAll('.cdot');
  for (var i = 0; i < cdots.length; i++) {
    (function(dot) {
      dot.addEventListener('click', function() {
        var qs2 = clone(ST.questions || []);
        var qi = parseInt(dot.dataset.qi);
        if (qs2[qi]) qs2[qi].correct = parseInt(dot.dataset.qj);
        upd({questions: qs2});
        notif('Correct answer set', 'success');
      });
    })(cdots[i]);
  }
}
function saveQ(i) {
  var qs = clone(ST.questions || []);
  if (!qs[i]) return;
  var qt = document.getElementById('qt-' + i);
  if (qt) qs[i].text = qt.value.trim() || qs[i].text;
  for (var j = 0; j < 4; j++) {
    var e = document.getElementById('qo-' + i + '-' + j);
    if (e) qs[i].options[j] = e.value.trim();
  }
  upd({questions: qs});
  notif('Question saved!', 'success');
  var body = document.getElementById('qbody-' + i);
  if (body) body.classList.remove('open');
}
function addQ() {
  var qs = clone(Array.isArray(ST.questions) ? ST.questions : []);
  qs.push({id:'q_'+Date.now(),text:'New question â€” click âœ to edit',options:['Option A','Option B','Option C','Option D'],correct:0});
  upd({questions: qs});
  notif('Question added', 'success');
  setTimeout(function() {
    var body = document.getElementById('qbody-' + (qs.length - 1));
    if (body) body.classList.add('open');
  }, 200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIDEBAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSidebar(st) {
  var sorted = (st.teams || []).slice().sort(function(a,b) { return b.money - a.money; });
  var lbHtml = '';
  for (var i = 0; i < sorted.length; i++) {
    var t = sorted[i];
    lbHtml += '<div class="lbr ' + (st.activeTeam === t.name ? 'at' : '') + '">' +
      '<span style="font-family:Orbitron,sans-serif;font-size:13px;color:rgba(255,255,255,.3);min-width:24px">#' + (i+1) + '</span>' +
      '<span style="flex:1;font-family:Rajdhani,sans-serif;font-weight:700;font-size:13px">' + esc(t.name) + '</span>' +
      '<span style="font-family:Orbitron,sans-serif;font-size:11px;color:var(--gold);font-weight:700">' + $m(t.money) + '</span></div>';
  }
  document.getElementById('S_lb').innerHTML = lbHtml;
  var betsHtml = '';
  var teams = st.teams || [];
  for (var i = 0; i < teams.length; i++) {
    var t = teams[i];
    var b = st.bets && st.bets[t.name];
    betsHtml += '<div class="betr ' + (b ? 'hb' : '') + '">' +
      '<span style="font-family:Rajdhani,sans-serif;font-weight:600;font-size:13px">' + esc(t.name) + '</span>' +
      (b ? '<span style="font-family:Orbitron,sans-serif;font-size:11px;color:var(--gold);font-weight:700">' + $m(b) + '</span>'
         : '<span style="color:rgba(255,255,255,.25);font-size:11px;font-family:Orbitron,sans-serif">â€”</span>') +
      '</div>';
  }
  document.getElementById('S_bets').innerHTML = betsHtml;
  var qs = Array.isArray(st.questions) ? st.questions : [];
  var q = st.currentQuestionIndex >= 0 ? qs[st.currentQuestionIndex] : null;
  document.getElementById('S_q').textContent = q ? ('Q' + (st.currentQuestionIndex+1) + ': ' + q.text) : 'None selected';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLivePanel(st) {
  var qs = Array.isArray(st.questions) ? st.questions : [];
  // Team activate list
  var tal = document.getElementById('teamActList');
  if (tal) {
    var html = '';
    var teams = st.teams || [];
    for (var i = 0; i < teams.length; i++) {
      var t = teams[i];
      var bet = st.bets && st.bets[t.name];
      var on = st.activeTeam === t.name;
      html += '<button class="act-btn ' + (on ? 'on' : '') + '" data-act="' + esc(t.name) + '">' +
        '<div><div style="font-family:Rajdhani,sans-serif;font-weight:700;font-size:15px;' + (on ? 'color:var(--ng)' : '') + '">' + esc(t.name) + '</div>' +
        '<div style="font-family:Orbitron,sans-serif;font-size:8px;color:rgba(255,255,255,.35)">' + $m(t.money) + ' Â· W:' + (t.wins||0) + ' L:' + (t.losses||0) + (bet ? ' Â· BET:' + $m(bet) : ' Â· no bet') + '</div></div>' +
        '<span style="font-size:18px">' + (on ? 'âš¡' : 'â—‹') + '</span></button>';
    }
    tal.innerHTML = html;
    var acts = tal.querySelectorAll('[data-act]');
    for (var i = 0; i < acts.length; i++) {
      (function(btn) {
        btn.addEventListener('click', function() { activateTeam(btn.dataset.act); });
      })(acts[i]);
    }
  }
  // Answer display
  var ad = document.getElementById('ansDisplay');
  if (ad) {
    if (st.selectedAnswer !== null && st.selectedAnswer !== undefined && st.currentQuestionIndex >= 0) {
      var q = qs[st.currentQuestionIndex];
      var ltr = 'ABCD'[st.selectedAnswer];
      var optTxt = q ? q.options[st.selectedAnswer] : '';
      ad.innerHTML = '<div style="display:flex;align-items:center;gap:12px;width:100%">' +
        '<span style="font-family:Orbitron,sans-serif;font-size:22px;color:var(--gold)">[' + ltr + ']</span>' +
        '<span style="flex:1;font-size:16px">' + esc(optTxt) + '</span>' +
        '<span style="font-family:Orbitron,sans-serif;font-size:10px;color:rgba(255,255,255,.4)">â€” ' + esc(st.activeTeam || '?') + '</span></div>';
      document.getElementById('A_correct').disabled = false;
      document.getElementById('A_wrong').disabled = false;
    } else {
      ad.innerHTML = 'â³ Waiting for team answer...';
      document.getElementById('A_correct').disabled = true;
      document.getElementById('A_wrong').disabled = true;
    }
  }
  // Money adjustments
  var ma = document.getElementById('moneyAdj');
  if (ma) {
    var html = '';
    var teams = st.teams || [];
    for (var i = 0; i < teams.length; i++) {
      var t = teams[i];
      html += '<div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">' +
        '<span style="font-family:Rajdhani,sans-serif;font-weight:700;min-width:110px;font-size:14px">' + esc(t.name) + '</span>' +
        '<span style="font-family:Orbitron,sans-serif;font-size:11px;color:var(--gold);min-width:80px">' + $m(t.money) + '</span>' +
        '<input class="inp" type="number" data-mai="' + i + '" placeholder="Â±amount" style="width:100px">' +
        '<button class="btn btn-blue btn-sm" data-maa="' + i + '">APPLY</button></div>';
    }
    ma.innerHTML = html;
    var maas = ma.querySelectorAll('[data-maa]');
    for (var i = 0; i < maas.length; i++) {
      (function(btn) {
        btn.addEventListener('click', function() {
          var idx = parseInt(btn.dataset.maa);
          var inp = ma.querySelector('[data-mai="' + idx + '"]');
          if (!inp) return;
          var v = parseInt(inp.value);
          if (isNaN(v)) { notif('Invalid amount', 'error'); return; }
          var teams2 = clone(ST.teams);
          if (!teams2[idx]) return;
          teams2[idx].money = Math.max(0, teams2[idx].money + v);
          upd({teams: teams2});
          inp.value = '';
          notif(teams2[idx].name + ': ' + (v >= 0 ? '+' : '') + $m(v), 'info');
        });
      })(maas[i]);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BROADCAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBroadcast() {
  var QM = [
    ['ğŸ¬ Welcome', 'ğŸ¬ Welcome to the Logistics Auction Show!'],
    ['ğŸ’° Bet Open', 'ğŸ’° Betting OPEN â€” read the question and place your bets!'],
    ['ğŸ”’ Reveal', 'ğŸ”’ Betting closed! Options revealed â€” answer now!'],
    ['â± Timer', 'â± Timer starting â€” good luck!'],
    ['â­ Next Q', 'â­ Next question loading â€” get ready!'],
    ['âš  Break', 'âš  Short break â€” please stand by...']
  ];
  var html = '';
  for (var i = 0; i < QM.length; i++) html += '<button class="btn btn-blue btn-sm" data-qmi="' + i + '">' + QM[i][0] + '</button>';
  var el = document.getElementById('quickMsgs');
  el.innerHTML = html;
  var btns = el.querySelectorAll('[data-qmi]');
  for (var i = 0; i < btns.length; i++) {
    (function(btn, msgs) {
      btn.addEventListener('click', function() {
        document.getElementById('annInput').value = msgs[parseInt(btn.dataset.qmi)][1];
        sendAnn();
      });
    })(btns[i], QM);
  }
}
function sendAnn() {
  var m = document.getElementById('annInput').value.trim();
  if (!m) { notif('Enter a message', 'error'); return; }
  upd({announcement: m});
  notif('Broadcast sent!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setQ() {
  var idx = parseInt(document.getElementById('qSelect').value);
  if (idx < 0) { notif('Choose a question first', 'error'); return; }
  upd({currentQuestionIndex: idx, selectedAnswer: null, lastResult: null, bets: {}});
  notif('Q' + (idx+1) + ' loaded', 'success');
}
function openBetting() {
  if (ST.currentQuestionIndex < 0) { notif('Select a question first!', 'error'); return; }
  upd({phase: 'betting', bets: {}, selectedAnswer: null, lastResult: null,
    timerRunning: false, timerRemaining: ST.timerDuration, timerStartedAt: null,
    announcement: 'ğŸ’° BETTING OPEN â€” Read question and place bets! Options hidden.'});
  notif('Betting opened', 'success');
}
function closeBetting() {
  upd({phase: 'answering', announcement: 'ğŸ”’ Betting closed! Options now REVEALED!'});
  notif('Options revealed â†’ Answering', 'info');
}
function activateTeam(name) {
  upd({activeTeam: name, selectedAnswer: null, phase: 'answering', announcement: 'âš¡ ' + name + ' is now answering!'});
  notif('âš¡ ' + name + ' activated', 'info');
}
function startTimer() {
  var ov = parseInt(document.getElementById('timerOvr').value);
  var dur = isNaN(ov) || ov < 1 ? (ST.timerDuration || 30) : Math.min(120, Math.max(1, ov));
  upd({timerDuration: dur, timerRemaining: dur, timerRunning: true, timerStartedAt: Date.now()});
  document.getElementById('timerOvr').value = '';
  notif('Timer: ' + dur + 's started', 'info');
}
function stopTimer() {
  var rem = ST.timerRemaining || 0;
  if (ST.timerRunning && ST.timerStartedAt) rem = Math.max(0, (ST.timerRemaining || 0) - (Date.now() - ST.timerStartedAt) / 1000);
  upd({timerRunning: false, timerRemaining: rem, timerStartedAt: null});
  notif('Timer stopped', 'info');
}
function resetTimer() {
  upd({timerRunning: false, timerRemaining: ST.timerDuration || 30, timerStartedAt: null});
  notif('Timer reset', 'info');
}
function timerTick() {
  if (!adminReady) return;
  var rem = ST.timerRemaining || 0;
  if (ST.timerRunning && ST.timerStartedAt) rem = Math.max(0, (ST.timerRemaining || 0) - (Date.now() - ST.timerStartedAt) / 1000);
  var s = Math.ceil(rem);
  var el = document.getElementById('S_timer');
  if (el) {
    el.textContent = s > 0 ? (s < 10 ? '0' + s : '' + s) : '00';
    el.className = 'tbig' + (s <= 3 && s > 0 ? ' dang' : s <= 5 && s > 0 ? ' warn' : '');
  }
  var ts = document.getElementById('S_tstatus');
  if (ts) { ts.textContent = ST.timerRunning ? 'â— RUNNING' : 'â–  STOPPED'; ts.style.color = ST.timerRunning ? 'var(--ng)' : 'rgba(255,255,255,.3)'; }
  if (rem <= 0 && ST.timerRunning && !_autoJudged && ST.phase === 'answering' && ST.activeTeam) {
    _autoJudged = true;
    upd({timerRunning: false, timerRemaining: 0, timerStartedAt: null});
    autoTimeout();
  }
  if (rem > 0) _autoJudged = false;
}
function autoTimeout() {
  var teams = clone(ST.teams || []);
  var ti = -1;
  for (var i = 0; i < teams.length; i++) { if (teams[i].name === ST.activeTeam) { ti = i; break; } }
  if (ti < 0) return;
  var bet = ST.bets && ST.bets[ST.activeTeam] ? parseInt(ST.bets[ST.activeTeam]) : 0;
  teams[ti].money = Math.max(0, teams[ti].money - bet);
  teams[ti].losses = (teams[ti].losses || 0) + 1;
  upd({teams: teams, phase: 'result', timerRunning: false, timerStartedAt: null,
    lastResult: {teamName: ST.activeTeam, correct: false, betAmount: bet, timestamp: Date.now(), timeout: true},
    announcement: "â° TIME'S UP! " + ST.activeTeam + " ran out of time!"});
  notif('Timeout!', 'error');
}
function judgeAnswer(correct) {
  if (ST.selectedAnswer === null || ST.selectedAnswer === undefined) { notif('No answer yet', 'error'); return; }
  if (!ST.activeTeam) { notif('No active team', 'error'); return; }
  var teams = clone(ST.teams || []);
  var ti = -1;
  for (var i = 0; i < teams.length; i++) { if (teams[i].name === ST.activeTeam) { ti = i; break; } }
  if (ti < 0) return;
  var team = teams[ti];
  var bet = ST.bets && ST.bets[ST.activeTeam] ? parseInt(ST.bets[ST.activeTeam]) : 0;
  if (correct) { team.money += bet; team.wins = (team.wins || 0) + 1; }
  else { team.money = Math.max(0, team.money - bet); team.losses = (team.losses || 0) + 1; }
  upd({teams: teams, phase: 'result', timerRunning: false, timerStartedAt: null,
    lastResult: {teamName: ST.activeTeam, correct: correct, betAmount: bet, timestamp: Date.now()},
    announcement: correct ? 'âœ… ' + ST.activeTeam + ' CORRECT! +' + $m(bet) : 'âŒ ' + ST.activeTeam + ' WRONG! -' + $m(bet)});
  notif(correct ? 'CORRECT +' + $m(bet) : 'WRONG -' + $m(bet), correct ? 'success' : 'error');
}
function nextQ() {
  upd({phase: 'betting', activeTeam: null, selectedAnswer: null, lastResult: null,
    bets: {}, timerRunning: false, timerRemaining: ST.timerDuration || 30, timerStartedAt: null,
    round: (ST.round || 0) + 1, announcement: 'â­ Next question loading â€” get ready to bet!'});
  notif('Next question', 'info');
}
function endGame() {
  if (!ST.teams || !ST.teams.length) { notif('No teams', 'error'); return; }
  if (!confirm('End show and reveal winner?')) return;
  var winner = (ST.teams || []).slice().sort(function(a,b) { return b.money - a.money; })[0];
  upd({phase: 'reveal', winner: winner, timerRunning: false, timerStartedAt: null,
    announcement: 'ğŸ† ' + winner.name + ' WINS THE LOGISTICS AUCTION SHOW!'});
  notif('ğŸ† ' + winner.name + ' WINS!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WIRE ALL BUTTONS â€” runs after DOM loaded
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {  // DOM already ready - script runs at bottom of body
  // Login
  document.getElementById('L_btn').addEventListener('click', doLogin);
  document.getElementById('pw').addEventListener('keydown', function(e) { if (e.key === 'Enter') doLogin(); });
  // Header
  document.getElementById('A_display').addEventListener('click', function() { window.open('index.html', '_blank'); });
  document.getElementById('A_reset').addEventListener('click', function() {
    if (!confirm('Full reset? All data cleared.')) return;
    editTeams = genDT(4);
    document.getElementById('teamCount').value = 4;
    renderTeamInputs();
    GREF.set(freshState());
    notif('Reset complete', 'info');
  });
  document.getElementById('A_sync').addEventListener('click', function() { upd({_sync: Date.now()}); notif('Synced!', 'success'); });
  // Setup
  document.getElementById('A_gen').addEventListener('click', genSlots);
  document.getElementById('A_allMoney').addEventListener('click', applyAll);
  document.getElementById('A_save').addEventListener('click', saveSetup);
  document.getElementById('A_start').addEventListener('click', startShow);
  // Questions
  document.getElementById('A_addQ').addEventListener('click', addQ);
  // Live
  document.getElementById('A_setQ').addEventListener('click', setQ);
  document.getElementById('A_openBet').addEventListener('click', openBetting);
  document.getElementById('A_closeBet').addEventListener('click', closeBetting);
  document.getElementById('A_timerStart').addEventListener('click', startTimer);
  document.getElementById('A_timerStop').addEventListener('click', stopTimer);
  document.getElementById('A_timerReset').addEventListener('click', resetTimer);
  document.getElementById('A_correct').addEventListener('click', function() { judgeAnswer(true); });
  document.getElementById('A_wrong').addEventListener('click', function() { judgeAnswer(false); });
  document.getElementById('A_nextQ').addEventListener('click', nextQ);
  document.getElementById('A_endGame').addEventListener('click', endGame);
  // Broadcast
  document.getElementById('A_annSend').addEventListener('click', sendAnn);
  document.getElementById('A_annClear').addEventListener('click', function() { upd({announcement: ''}); document.getElementById('annInput').value = ''; });
  // Tabs
  var tabs = document.querySelectorAll('.tab');
  for (var i = 0; i < tabs.length; i++) {
    (function(tab) {
      tab.addEventListener('click', function() {
        var all = document.querySelectorAll('.tab');
        for (var j = 0; j < all.length; j++) all[j].classList.remove('on');
        var panels = document.querySelectorAll('.tabp');
        for (var j = 0; j < panels.length; j++) panels[j].classList.remove('on');
        tab.classList.add('on');
        var panel = document.getElementById('tabp-' + tab.dataset.t);
        if (panel) panel.classList.add('on');
      });
    })(tabs[i]);
  }
})();
</script>
</body>
</html>