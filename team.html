<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEAM DEVICE Â· LOGISTICS AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--gold:#F5C518;--nb:#00C9FF;--ng:#00E878;--nr:#FF2D55;--no:#FF9500;--np:#BF5FFF;--bg:#04040E;--tc:#00C9FF;--ease:cubic-bezier(.22,1,.36,1)}
html,body{width:100%;min-height:100vh;background:var(--bg);color:#fff;font-family:'Rajdhani',sans-serif}
.bg{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 80% 60% at 20% 30%,rgba(0,50,140,.2),transparent 55%),radial-gradient(ellipse 60% 50% at 80% 80%,rgba(80,0,160,.18),transparent 55%),var(--bg)}
.scan{position:fixed;inset:0;z-index:1;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.04) 2px,rgba(0,0,0,.04) 4px)}
#phasebar{position:fixed;top:0;left:0;right:0;height:4px;z-index:800;transition:background 1s,box-shadow 1s}
#ann{position:fixed;top:0;left:0;right:0;z-index:700;padding:13px 30px;min-height:46px;background:linear-gradient(90deg,rgba(0,0,0,.95),rgba(8,10,30,.98),rgba(0,0,0,.95));border-bottom:2px solid rgba(245,197,24,.3);font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;color:var(--gold);text-align:center;display:flex;align-items:center;justify-content:center;transform:translateY(-100%);transition:transform .5s var(--ease)}
#ann.show{transform:translateY(0)}
#flash{position:fixed;inset:0;z-index:9000;pointer-events:none;opacity:0;transition:opacity .07s}
#flash.g{background:rgba(0,232,120,.28)}
#flash.r{background:rgba(255,45,85,.28)}
#flash.on{opacity:1}
.mpop{position:fixed;z-index:8990;font-family:'Orbitron',sans-serif;font-weight:900;font-size:36px;pointer-events:none;animation:mpop 2s var(--ease) forwards;text-shadow:0 0 24px currentColor}
@keyframes mpop{0%{opacity:1;transform:translateY(0) scale(.8)}40%{transform:translateY(-50px) scale(1.15)}100%{opacity:0;transform:translateY(-120px) scale(.9)}}
#app{position:relative;z-index:10;min-height:100vh;padding:54px 14px 20px;display:flex;flex-direction:column;gap:12px;max-width:560px;margin:0 auto}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 28px;border:none;border-radius:10px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:700;font-size:13px;letter-spacing:2px;text-transform:uppercase;transition:all .3s var(--ease)}
.btn:active{transform:scale(.96)!important}
.btn-gold{background:linear-gradient(135deg,#4a3000,var(--gold),#4a3000);color:#000;box-shadow:0 0 22px rgba(245,197,24,.45)}
.btn-gold:hover{box-shadow:0 0 50px rgba(245,197,24,.9);transform:translateY(-2px)}
.btn-green{background:linear-gradient(135deg,#004020,var(--ng),#004020);color:#000;box-shadow:0 0 20px rgba(0,232,120,.35)}
.btn-green:hover{box-shadow:0 0 45px rgba(0,232,120,.75);transform:translateY(-2px)}
.btn-blue{background:linear-gradient(135deg,#002a44,var(--nb),#002a44);color:#fff;box-shadow:0 0 20px rgba(0,201,255,.35)}
.btn-blue:hover{box-shadow:0 0 45px rgba(0,201,255,.75);transform:translateY(-2px)}
.btn-full{width:100%}
.btn:disabled{opacity:.3;cursor:not-allowed;transform:none!important;box-shadow:none!important}
/* HEADER */
.hdr{background:rgba(0,0,0,.7);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px 20px;display:flex;align-items:center;justify-content:space-between}
.team-name{font-family:'Bebas Neue',sans-serif;font-size:clamp(26px,6vw,40px);letter-spacing:3px;transition:color .4s,text-shadow .4s}
.team-money{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(22px,5vw,34px);color:var(--gold);text-shadow:0 0 18px var(--gold);transition:all .4s}
.team-stats{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:2px;color:rgba(255,255,255,.35);margin-top:3px}
/* PHASE INDICATOR */
.phase-ind{padding:10px 18px;border-radius:10px;display:flex;align-items:center;gap:12px;transition:all .5s;backdrop-filter:blur(10px)}
.ph-dot{width:10px;height:10px;border-radius:50%;animation:phdot 1.2s ease-in-out infinite}
@keyframes phdot{0%,100%{opacity:1}50%{opacity:.3}}
.ph-lbl{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2.5px;font-weight:700}
.ph-sub{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:600;flex:1;text-align:right;opacity:.7}
/* TIMER */
.timer-panel{background:rgba(0,0,0,.65);backdrop-filter:blur(12px);border:1px solid rgba(0,201,255,.2);border-radius:14px;padding:18px;text-align:center;transition:border-color .4s,box-shadow .4s}
.t-lbl{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:4px;color:rgba(255,255,255,.3);margin-bottom:4px}
.t-num{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(70px,18vw,100px);line-height:1;color:var(--nb);text-shadow:0 0 25px var(--nb);transition:color .3s,text-shadow .3s}
.t-num.warn{color:var(--no);text-shadow:0 0 25px var(--no);animation:tpulse .5s ease-in-out infinite}
.t-num.dang{color:var(--nr);text-shadow:0 0 40px var(--nr);animation:tpulse .22s ease-in-out infinite}
.t-status{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;margin-top:6px;transition:.3s}
@keyframes tpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
/* QUESTION CARD */
.q-card{background:rgba(4,8,28,.92);border:1px solid rgba(0,201,255,.2);border-radius:14px;padding:20px 22px;transition:border-color .5s,box-shadow .5s}
.q-card.ph-betting{border-color:rgba(245,197,24,.45);box-shadow:0 0 28px rgba(245,197,24,.07)}
.q-card.ph-answering{border-color:rgba(0,232,120,.4);box-shadow:0 0 28px rgba(0,232,120,.1)}
.q-card.ph-result{border-color:rgba(255,149,0,.35);box-shadow:0 0 22px rgba(255,149,0,.08)}
.q-num{font-family:'Orbitron',sans-serif;font-size:8px;letter-spacing:3px;color:var(--nb);margin-bottom:10px}
.q-text{font-family:'Rajdhani',sans-serif;font-size:clamp(16px,4vw,21px);font-weight:600;line-height:1.5}
/* LOCKED PANEL â€” shown during betting â€” hides EVERYTHING */
.betting-hidden-block{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:36px 20px;border-radius:12px;background:rgba(0,0,0,.55);border:1px dashed rgba(245,197,24,.35);margin-top:0;min-height:160px}
.lock-icon{font-size:54px;animation:lockbob 2s ease-in-out infinite}
@keyframes lockbob{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-8px) scale(1.1)}}
.lock-txt{font-family:'Orbitron',sans-serif;font-size:15px;letter-spacing:3px;color:var(--gold);text-shadow:0 0 14px rgba(245,197,24,.4)}
.lock-sub{font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.4);letter-spacing:1px;text-align:center;line-height:1.6}
/* OPTIONS REVEALED */
.opts-list{display:flex;flex-direction:column;gap:8px;margin-top:14px}
.qopt{padding:13px 16px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);font-family:'Rajdhani',sans-serif;font-size:clamp(14px,3.5vw,17px);font-weight:600;display:flex;gap:12px;align-items:center;transition:all .35s;animation:optin .3s both;cursor:pointer;width:100%;text-align:left;color:#fff}
.qopt:hover:not(:disabled){background:rgba(0,201,255,.08);border-color:rgba(0,201,255,.3);transform:translateX(4px)}
.qopt:disabled{cursor:not-allowed}
.qopt.sel{background:rgba(0,201,255,.14);border-color:var(--nb);box-shadow:0 0 18px rgba(0,201,255,.2)}
.qopt.cr{background:rgba(0,232,120,.18);border-color:var(--ng);box-shadow:0 0 20px rgba(0,232,120,.25);cursor:default}
.qopt.wr{background:rgba(255,45,85,.1);border-color:rgba(255,45,85,.3);cursor:default}
@keyframes optin{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
.oltr{font-family:'Orbitron',sans-serif;font-size:11px;font-weight:900;color:var(--nb);min-width:20px}
.qopt.sel .oltr{color:#fff}
.qopt.cr .oltr{color:var(--ng)}
/* BET PANEL */
.bet-panel{background:rgba(0,0,0,.6);backdrop-filter:blur(12px);border:1px solid rgba(245,197,24,.25);border-radius:14px;padding:18px 20px}
.bet-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--gold);margin-bottom:14px}
.bet-presets{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.bet-preset{padding:10px 8px;border-radius:8px;border:1px solid rgba(245,197,24,.2);background:rgba(245,197,24,.05);cursor:pointer;font-family:'Orbitron',sans-serif;font-size:11px;font-weight:700;color:var(--gold);text-align:center;transition:.3s;letter-spacing:1px}
.bet-preset:hover{background:rgba(245,197,24,.14);border-color:rgba(245,197,24,.5);box-shadow:0 0 14px rgba(245,197,24,.2)}
.bet-preset.on{background:rgba(245,197,24,.2);border-color:var(--gold);box-shadow:0 0 18px rgba(245,197,24,.3)}
.bet-input-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.bet-input{background:rgba(255,255,255,.04);border:1px solid rgba(245,197,24,.25);border-radius:8px;padding:12px 16px;color:var(--gold);font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;width:100%;outline:none;transition:.3s;text-align:center;letter-spacing:2px}
.bet-input:focus{border-color:var(--gold);box-shadow:0 0 16px rgba(245,197,24,.3)}
.bet-err{color:var(--nr);font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;min-height:16px;margin-bottom:8px;text-align:center}
.bet-submitted{display:flex;align-items:center;justify-content:center;gap:12px;padding:20px;border-radius:10px;background:rgba(0,232,120,.08);border:1px solid rgba(0,232,120,.3)}
/* ANSWER PANEL */
.ans-panel{background:rgba(4,8,28,.92);border:1px solid rgba(0,232,120,.25);border-radius:14px;padding:18px 20px}
.ans-ttl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:3px;color:var(--ng);margin-bottom:14px}
.locked-msg{display:flex;flex-direction:column;align-items:center;gap:10px;padding:20px;text-align:center}
.locked-msg .icon{font-size:40px}
/* RESULT PANEL */
.result-banner{padding:20px;border-radius:12px;text-align:center;animation:resin .5s var(--ease)}
@keyframes resin{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.result-banner.win{background:rgba(0,232,120,.1);border:1px solid rgba(0,232,120,.4)}
.result-banner.lose{background:rgba(255,45,85,.07);border:1px solid rgba(255,45,85,.3)}
.result-verdict{font-family:'Bebas Neue',sans-serif;font-size:52px;letter-spacing:4px}
.result-money{font-family:'Orbitron',sans-serif;font-weight:900;font-size:28px;margin-top:4px}
/* WAITING CARD */
.waiting-card{background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:28px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:14px}
.waiting-icon{font-size:50px;animation:wobble 2s ease-in-out infinite}
@keyframes wobble{0%,100%{transform:rotate(-8deg)}50%{transform:rotate(8deg)}}
.waiting-txt{font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;color:rgba(255,255,255,.5)}
/* WINNER */
#winner-panel{text-align:center;padding:28px 20px;display:flex;flex-direction:column;align-items:center;gap:16px}
.w-trophy{font-size:80px;animation:trophybob 1.2s ease-in-out infinite}
@keyframes trophybob{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-15px) scale(1.1)}}
/* â•â•â• CINEMATIC ADDITIONS â•â•â• */
#ptcls-team{position:fixed;inset:0;z-index:2;pointer-events:none;overflow:hidden}
.ptcl{position:absolute;border-radius:50%;animation:pfloat linear infinite}
@keyframes pfloat{0%{transform:translateY(110vh);opacity:0}10%{opacity:.7}90%{opacity:.4}100%{transform:translateY(-60px);opacity:0}}
/* BETTING OVERLAY â€” cinematic "Betting in Progress" */
#betting-overlay{position:fixed;inset:0;z-index:500;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;pointer-events:none;opacity:0;transition:opacity .6s;background:radial-gradient(ellipse 80% 60% at 50% 50%,rgba(245,197,24,.04),transparent 70%)}
#betting-overlay.active{opacity:1}
.bet-ov-ring{width:120px;height:120px;border-radius:50%;border:3px solid rgba(245,197,24,.3);border-top-color:var(--gold);animation:spinring 1.4s linear infinite;position:relative}
.bet-ov-icon{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:40px}
@keyframes spinring{to{transform:rotate(360deg)}}
.bet-ov-txt{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:4px;color:var(--gold);text-shadow:0 0 20px var(--gold);animation:bettingpulse 1.5s ease-in-out infinite}
@keyframes bettingpulse{0%,100%{opacity:1}50%{opacity:.5}}
.bet-ov-sub{font-family:'Rajdhani',sans-serif;font-size:15px;color:rgba(255,255,255,.45);letter-spacing:2px}
/* sound visualizer bars */
.viz-bars{display:flex;gap:3px;align-items:flex-end;height:18px}
.vbar{width:3px;border-radius:2px;background:var(--gold);opacity:.5;animation:vbar linear infinite}
@keyframes vbar{0%,100%{height:3px}50%{height:var(--h)}}
/* phase transitions */
.q-card{transition:border-color .6s,box-shadow .6s,transform .4s}
.q-card.ph-answering{animation:revealcard .5s cubic-bezier(.22,1,.36,1)}
@keyframes revealcard{0%{transform:scale(.97) translateY(8px);opacity:.5}100%{transform:scale(1) translateY(0);opacity:1}}
/* shake on wrong */
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
.shake{animation:shake .4s ease-in-out}
/* Floating money pop */
.mpop{position:fixed;z-index:8990;font-family:'Orbitron',sans-serif;font-weight:900;font-size:36px;pointer-events:none;animation:mpop 2s var(--ease) forwards;text-shadow:0 0 24px currentColor}
@keyframes mpop{0%{opacity:1;transform:translateY(0) scale(.8)}40%{transform:translateY(-50px) scale(1.15)}100%{opacity:0;transform:translateY(-120px) scale(.9)}}
/* spotlight glow on active team */
.hdr.active-spotlight{border-color:rgba(0,232,120,.6)!important;box-shadow:0 0 40px rgba(0,232,120,.2),0 0 80px rgba(0,232,120,.08)!important;animation:spotpulse 2s ease-in-out infinite}
@keyframes spotpulse{0%,100%{box-shadow:0 0 40px rgba(0,232,120,.2)}50%{box-shadow:0 0 70px rgba(0,232,120,.4)}}
/* result banner enter */
.result-banner{animation:resin .5s cubic-bezier(.22,1,.36,1)}

</style>
</head>
<body>
<div class="bg"></div>
<div class="scan"></div>
<div id="ptcls-team"></div>
<div id="phasebar"></div>
<div id="ann"></div>
<div id="flash"></div>
<!-- CINEMATIC BETTING OVERLAY -->
<div id="betting-overlay">
  <div class="bet-ov-ring"><div class="bet-ov-icon">ğŸ’°</div></div>
  <div class="bet-ov-txt">BETTING IN PROGRESS</div>
  <div class="viz-bars"><div class="vbar" style="--h:15px;animation-duration:.5s"></div><div class="vbar" style="--h:10px;animation-duration:.7s;animation-delay:.1s"></div><div class="vbar" style="--h:18px;animation-duration:.4s;animation-delay:.2s"></div><div class="vbar" style="--h:8px;animation-duration:.8s;animation-delay:.15s"></div><div class="vbar" style="--h:13px;animation-duration:.6s;animation-delay:.05s"></div></div>
  <div class="bet-ov-sub">Place your bet Â· Question &amp; options revealed after admin closes betting</div>
</div>
<div id="app">
  <div class="hdr">
    <div>
      <div class="team-name" id="team-name" style="color:var(--tc)">LOADING...</div>
      <div class="team-stats" id="team-stats">W: 0 Â· L: 0</div>
    </div>
    <div class="team-money" id="team-money">$â€”</div>
  </div>
  <div class="phase-ind" id="phase-ind">
    <div class="ph-dot" id="ph-dot"></div>
    <div class="ph-lbl" id="ph-lbl">CONNECTING...</div>
    <div class="ph-sub" id="ph-sub"></div>
  </div>
  <div class="timer-panel">
    <div class="t-lbl">TIME REMAINING</div>
    <div class="t-num" id="t-num">--</div>
    <div class="t-status" id="t-status" style="color:rgba(255,255,255,.3)">WAITING</div>
  </div>
  <div id="main-content"></div>
</div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyCSyzYtCd-uiolBucZnncuIWpnE5mPG9Cs",authDomain:"logistics-auction-show.firebaseapp.com",databaseURL:"https://logistics-auction-show-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"logistics-auction-show",storageBucket:"logistics-auction-show.firebasestorage.app",messagingSenderId:"596983567254",appId:"1:596983567254:web:91f5b863db7464886503b7"});
const DB=firebase.database(),GREF=DB.ref('gameState');

// â”€â”€ TEAM IDENTITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const params=new URLSearchParams(location.search);
let myName=params.get('team')||localStorage.getItem('LAS_TEAM')||'';
if(myName)localStorage.setItem('LAS_TEAM',myName);
else{document.getElementById('main-content').innerHTML='<div class="waiting-card"><div class="waiting-icon">âš </div><div class="waiting-txt">NO TEAM ASSIGNED</div><div style="font-family:Rajdhani,sans-serif;font-size:14px;color:rgba(255,255,255,.4)">Please spin from index.html</div><a href="index.html" style="font-family:Orbitron,sans-serif;font-size:11px;color:var(--nb);letter-spacing:2px;text-decoration:none">â† BACK TO SPIN</a></div>';document.getElementById('team-name').textContent='NO TEAM';}

const TEAM_COLORS=['#00C9FF','#FF2D55','#F5C518','#BF5FFF','#00E878','#FF9500','#00BFFF','#FF69B4','#7FFF00','#DC143C'];
const $m=v=>'$'+Number(v||0).toLocaleString();
const esc=s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const PCOLS={lobby:'#00C9FF',spin:'#BF5FFF',betting:'#F5C518',answering:'#00E878',result:'#FF9500',reveal:'#F5C518'};

// â”€â”€ PARTICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){var c=document.getElementById('ptcls-team');if(!c)return;var cols=['rgba(0,201,255,.3)','rgba(245,197,24,.15)','rgba(191,95,255,.15)','rgba(0,232,120,.15)'];for(var i=0;i<22;i++){var p=document.createElement('div');p.className='ptcl';var sz=1.5+Math.random()*3;p.style.cssText='left:'+Math.random()*100+'%;width:'+sz+'px;height:'+sz+'px;background:'+cols[i%cols.length]+';animation-duration:'+(14+Math.random()*18)+'s;animation-delay:-'+(Math.random()*24)+'s';c.appendChild(p);}})();

let ST={},prevVer=null,hasBet=false,hasAns=false,myBet=0,lastResTs=0,prevMoney=null,prevPhase=null;

// â”€â”€ EFFECTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function flash(t){const e=document.getElementById('flash');e.className=t+' on';setTimeout(()=>e.classList.remove('on'),200);}
function moneyPop(amount,correct){
  const pop=document.createElement('div');pop.className='mpop';
  const hdr=document.getElementById('team-money').getBoundingClientRect();
  pop.style.cssText=`left:${hdr.left}px;top:${hdr.top}px;color:${correct?'var(--ng)':'var(--nr)'}`;
  pop.textContent=(correct?'+':'-')+$m(amount);
  document.body.appendChild(pop);setTimeout(()=>pop.remove(),2100);
}
// â”€â”€ ANN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let annT=null;
function showAnn(txt){if(!txt)return;const el=document.getElementById('ann');el.textContent=txt;el.classList.add('show');clearTimeout(annT);annT=setTimeout(()=>el.classList.remove('show'),5500);}
// â”€â”€ PHASE BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setPhasebar(p){const c=PCOLS[p]||'#00C9FF';document.getElementById('phasebar').style.cssText=`background:linear-gradient(90deg,transparent,${c},transparent);box-shadow:0 0 14px ${c}`;}
// â”€â”€ PHASE INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PINFO={
  lobby:{l:'LOBBY',c:'#00C9FF',s:'Waiting for show to start'},
  spin:{l:'TEAM SPIN',c:'#BF5FFF',s:'Spin the wheel to join'},
  betting:{l:'BETTING OPEN',c:'#F5C518',s:'Place your bet now!'},
  answering:{l:'ANSWERING',c:'#00E878',s:'Active team is answering'},
  result:{l:'RESULT',c:'#FF9500',s:'Round complete'},
  reveal:{l:'CHAMPION',c:'#F5C518',s:'Game over!'}
};
function updatePhaseInd(st){
  const p=st.phase;const{l,c,s}=PINFO[p]||{l:p.toUpperCase(),c:'#00C9FF',s:''};
  document.getElementById('ph-dot').style.background=c;
  document.getElementById('ph-lbl').textContent=l;document.getElementById('ph-lbl').style.color=c;
  const psub=p==='answering'&&st.activeTeam===myName?'âš¡ YOUR TURN TO ANSWER!':p==='betting'?'Read question â†’ Place bet':s;
  document.getElementById('ph-sub').textContent=psub;
  document.getElementById('phase-ind').style.cssText=`background:${c}12;border:1px solid ${c}30;border-radius:10px;display:flex;align-items:center;gap:12px;padding:10px 18px;transition:all .5s;backdrop-filter:blur(10px)`;
}
// â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTimer(st){
  const el=document.getElementById('t-num'),es=document.getElementById('t-status');if(!el)return;
  let rem=st.timerRemaining||0;
  if(st.timerRunning&&st.timerStartedAt)rem=Math.max(0,(st.timerRemaining||0)-(Date.now()-st.timerStartedAt)/1000);
  const s=Math.ceil(rem);
  el.textContent=s>0?String(s).padStart(2,'0'):'00';
  el.className='t-num'+(s<=3&&s>0?' dang':s<=5&&s>0?' warn':'');
  if(es){es.textContent=st.timerRunning?'â— RUNNING':'â–  STOPPED';es.style.color=st.timerRunning?'var(--ng)':'rgba(255,255,255,.3)';}
  const tp=document.querySelector('.timer-panel');
  if(tp){if(s<=5&&s>0){tp.style.borderColor='rgba(255,45,85,.4)';tp.style.boxShadow='0 0 20px rgba(255,45,85,.15)';}else{tp.style.borderColor='rgba(0,201,255,.2)';tp.style.boxShadow='none';}}
}
// â”€â”€ FIREBASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GREF.on('value',snap=>{
  const d=snap.val();if(!d)return;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RESET DETECTION â€” version change = admin reset
  // Immediately redirect ALL team devices to index.html
  // so they can spin the wheel fresh
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(prevVer!==null && d.version!==prevVer){
    // Clear all local assignment data
    localStorage.removeItem('LAS_TEAM');
    localStorage.removeItem('LAS_SPUN_'+localStorage.getItem('LAS_DID'));
    // Hard redirect â€” back to spin wheel
    location.href='index.html';
    return;
  }
  prevVer=d.version;

  // Reset bet/ans flags on new betting phase
  if(prevPhase&&prevPhase!=='betting'&&d.phase==='betting'){hasBet=false;hasAns=false;myBet=0;}
  if(d.phase==='result'&&prevPhase==='answering'){hasAns=false;}
  prevPhase=d.phase;
  ST=d;
  renderAll(ST);
});
function renderAll(st){
  if(st.announcement)showAnn(st.announcement);
  setPhasebar(st.phase);
  updatePhaseInd(st);
  // Toggle betting overlay (shown over question but under bet panel)
  const bettingOv=document.getElementById('betting-overlay');
  if(bettingOv){bettingOv.classList.toggle('active',st.phase==='betting');}
  // Find my team
  const teams=Array.isArray(st.teams)?st.teams:[];
  const myIdx=teams.findIndex(t=>t.name===myName);
  const myTeam=myIdx>=0?teams[myIdx]:null;
  const tc=TEAM_COLORS[myIdx>=0?myIdx%TEAM_COLORS.length:0];
  // Update header + spotlight glow if active team
  const hdr=document.querySelector('.hdr');
  if(hdr){hdr.classList.toggle('active-spotlight',st.phase==='answering'&&st.activeTeam===myName);}
  if(myTeam){
    document.getElementById('team-name').textContent=myTeam.name.toUpperCase();
    document.getElementById('team-name').style.color=tc;
    // Money change effect
    if(prevMoney!==null&&myTeam.money!==prevMoney){
      const diff=myTeam.money-prevMoney;
      moneyPop(Math.abs(diff),diff>0);
      flash(diff>0?'g':'r');
      // Shake on wrong answer
      if(diff<0){const mc=document.getElementById('main-content');if(mc){mc.classList.add('shake');setTimeout(()=>mc.classList.remove('shake'),500);}}
    }
    prevMoney=myTeam.money;
    document.getElementById('team-money').textContent=$m(myTeam.money);
    document.getElementById('team-stats').textContent='W: '+(myTeam.wins||0)+' Â· L: '+(myTeam.losses||0);
  }
  renderTimer(st);
  renderMain(st,myTeam,tc);
}
function renderMain(st,myTeam,tc){
  const phase=st.phase;
  const qs=Array.isArray(st.questions)?st.questions:[],qi=st.currentQuestionIndex,q=qi>=0&&qs[qi]?qs[qi]:null;
  const mc=document.getElementById('main-content');
  const isActive=st.activeTeam===myName;
  const myBetAmt=st.bets&&st.bets[myName]?parseInt(st.bets[myName]):0;

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // LOBBY / SPIN â†’ show waiting
  if(phase==='lobby'||phase==='spin'){
    mc.innerHTML=`<div class="waiting-card"><div class="waiting-icon">ğŸ“¡</div><div class="waiting-txt">SHOW STARTING SOON</div><div style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.4)">Admin is setting up the game</div></div>`;
    return;
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // WINNER SCREEN
  if(phase==='reveal'){
    const w=st.winner;
    mc.innerHTML=`<div id="winner-panel"><div class="w-trophy">ğŸ†</div><div style="font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:4px;color:var(--nb)">CHAMPION</div><div style="font-family:'Bebas Neue',sans-serif;font-size:clamp(44px,10vw,80px);color:var(--gold);text-shadow:0 0 30px var(--gold)">${esc(w?w.name.toUpperCase():'WINNER')}</div><div style="font-family:'Orbitron',sans-serif;font-weight:900;font-size:32px;color:var(--ng)">${w?$m(w.money):''}</div>${w&&w.name===myName?'<div style="font-family:\'Bebas Neue\',sans-serif;font-size:36px;color:var(--gold);margin-top:12px;letter-spacing:3px">ğŸ‰ THAT\'S YOU!</div>':''}</div>`;
    return;
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // GAME PHASES: betting | answering | result
  let html='';

  // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  // â•‘  BETTING PHASE                           â•‘
  // â•‘  Question text AND options = HIDDEN      â•‘
  // â•‘  Teams only see bet input + "locked" UI  â•‘
  // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(phase==='betting'){
    html+=`<div class="q-card ph-betting">
      <div class="q-num">â³ ROUND ${(st.round||0)+1} â€” BETTING OPEN</div>
      <div class="betting-hidden-block">
        <div class="lock-icon">ğŸ”’</div>
        <div class="lock-txt">QUESTION HIDDEN</div>
        <div class="lock-sub">The question &amp; options will be revealed<br>once admin closes betting</div>
      </div>
    </div>`;
  }

  // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  // â•‘  ANSWERING / RESULT                      â•‘
  // â•‘  Question + options fully revealed       â•‘
  // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(phase==='answering'||phase==='result'){
    html+=`<div class="q-card ph-${phase}">`;
    if(q){
      html+=`<div class="q-num">QUESTION ${qi+1}</div>`;
      html+=`<div class="q-text">${esc(q.text)}</div>`;
      html+=`<div class="opts-list">`;
      q.options.forEach((o,i)=>{
        let cl='qopt';
        if(phase==='result'){if(i===q.correct)cl+=' cr';else if(i===st.selectedAnswer&&i!==q.correct)cl+=' wr';}
        else if(phase==='answering'&&st.selectedAnswer===i)cl+=' sel';
        const disabled=!isActive||hasAns||phase!=='answering'?'disabled':'';
        html+=`<button class="${cl}" data-ans="${i}" ${disabled} style="animation-delay:${i*.07}s"><span class="oltr">${'ABCD'[i]}</span>${esc(o)}</button>`;
      });
      html+=`</div>`;
    } else {
      html+=`<div class="q-num">WAITING</div><div class="q-text" style="color:rgba(255,255,255,.4)">Admin is selecting a question...</div>`;
    }
    html+=`</div>`;
  }

  // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  // â•‘  BETTING PANEL (only during betting)     â•‘
  // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(phase==='betting'){
    if(hasBet||myBetAmt>0){
      html+=`<div class="bet-panel"><div class="bet-submitted"><span style="font-size:32px">âœ…</span><div><div style="font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--ng)">BET PLACED!</div><div style="font-family:'Orbitron',sans-serif;font-weight:900;font-size:24px;color:var(--gold)">${$m(myBetAmt)}</div><div style="font-family:'Rajdhani',sans-serif;font-size:13px;color:rgba(255,255,255,.45)">Waiting for admin to close betting...</div></div></div></div>`;
    } else {
      const bal=myTeam?myTeam.money:10000;
      html+=`<div class="bet-panel">
        <div class="bet-ttl">ğŸ’° PLACE YOUR BET â€” Balance: ${$m(bal)}</div>
        <div class="bet-presets" id="bet-presets">
          <div class="bet-preset" data-pct="0.1">10%</div>
          <div class="bet-preset" data-pct="0.25">25%</div>
          <div class="bet-preset" data-pct="0.5">50%</div>
          <div class="bet-preset" data-pct="0.75">75%</div>
          <div class="bet-preset" data-pct="1">ALL IN</div>
          <div class="bet-preset" data-fixed="500">$500</div>
        </div>
        <div class="bet-input-row">
          <input class="bet-input" type="number" id="bet-val" placeholder="${Math.floor(bal*0.25)}" min="1" max="${bal}">
        </div>
        <div class="bet-err" id="bet-err"></div>
        <button class="btn btn-gold btn-full" id="btn-bet">ğŸ’° PLACE BET</button>
      </div>`;
    }
  }

  // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  // â•‘  ANSWERING PANEL                         â•‘
  // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(phase==='answering'){
    if(hasAns||st.selectedAnswer!==null&&st.selectedAnswer!==undefined){
      const ltr=st.selectedAnswer!==null&&st.selectedAnswer!==undefined?'ABCD'[st.selectedAnswer]:'?';
      html+=`<div class="ans-panel"><div class="ans-ttl">ANSWER SUBMITTED</div><div class="bet-submitted"><span style="font-size:28px">ğŸ“</span><div><div style="font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2px;color:var(--ng)">SUBMITTED [${ltr}]</div><div style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.45);margin-top:4px">Waiting for admin to judge...</div></div></div></div>`;
    } else if(isActive){
      html+=`<div class="ans-panel"><div class="ans-ttl">âš¡ YOUR TURN â€” SELECT AN ANSWER ABOVE</div><div style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.4);padding:10px 0">Tap an option to submit your answer. You can only answer once.</div></div>`;
    } else {
      html+=`<div class="ans-panel"><div class="locked-msg"><div class="icon">ğŸ”’</div><div style="font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:3px;color:rgba(255,255,255,.4)">${st.activeTeam?esc(st.activeTeam)+' IS ANSWERING':'WAITING FOR ACTIVE TEAM'}</div></div></div>`;
    }
  }

  // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  // â•‘  RESULT PANEL                            â•‘
  // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if(phase==='result'&&st.lastResult){
    const res=st.lastResult,isMe=res.teamName===myName,correct=res.correct;
    if(isMe){
      html+=`<div class="result-banner ${correct?'win':'lose'}"><div class="result-verdict" style="color:${correct?'var(--ng)':'var(--nr)'}">${correct?'âœ… CORRECT!':'âŒ WRONG!'}</div><div class="result-money" style="color:${correct?'var(--ng)':'var(--nr)'}">${correct?'+':'-'}${$m(res.betAmount)}</div><div style="font-family:'Rajdhani',sans-serif;font-size:14px;color:rgba(255,255,255,.45);margin-top:8px">${res.timeout?'Time ran out!':correct?'Great answer!':'Better luck next round!'}</div></div>`;
    } else {
      html+=`<div class="result-banner ${correct?'win':'lose'}" style="opacity:.7"><div style="font-family:'Orbitron',sans-serif;font-size:12px;letter-spacing:2px;color:rgba(255,255,255,.5)">${esc(res.teamName)} ${correct?'CORRECT âœ…':'WRONG âŒ'}</div><div style="font-family:'Orbitron',sans-serif;font-size:20px;font-weight:900;color:${correct?'var(--ng)':'var(--nr)'};">${correct?'+':'-'}${$m(res.betAmount)}</div></div>`;
    }
  }

  mc.innerHTML=html;

  // â”€â”€ WIRE BET INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(phase==='betting'&&!hasBet&&!myBetAmt){
    const bal=myTeam?myTeam.money:0;
    // Preset buttons
    document.querySelectorAll('.bet-preset').forEach(p=>{
      p.addEventListener('click',()=>{
        document.querySelectorAll('.bet-preset').forEach(x=>x.classList.remove('on'));p.classList.add('on');
        const pct=parseFloat(p.dataset.pct);const fixed=parseInt(p.dataset.fixed);
        const val=!isNaN(pct)?Math.floor(bal*pct):(!isNaN(fixed)?Math.min(fixed,bal):0);
        const inp=document.getElementById('bet-val');if(inp)inp.value=val;
      });
    });
    // Place bet
    const btnBet=document.getElementById('btn-bet');
    if(btnBet){btnBet.addEventListener('click',()=>{
      const inp=document.getElementById('bet-val');if(!inp)return;
      const v=parseInt(inp.value);const err=document.getElementById('bet-err');
      if(isNaN(v)||v<1){err.textContent='Enter a valid amount!';return;}
      if(v>bal){err.textContent='Bet exceeds your balance!';return;}
      if(!myName){err.textContent='No team assigned!';return;}
      const newBets=Object.assign({},ST.bets||{});newBets[myName]=v;
      GREF.update({bets:newBets});
      hasBet=true;myBet=v;
      btnBet.disabled=true;if(err)err.textContent='';
      renderMain(ST,myTeam,tc);
    });}
  }

  // â”€â”€ WIRE ANSWER BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if(phase==='answering'&&isActive&&!hasAns){
    document.querySelectorAll('[data-ans]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        if(hasAns)return;
        const idx=parseInt(btn.dataset.ans);
        GREF.update({selectedAnswer:idx});
        hasAns=true;
        // Visual feedback
        document.querySelectorAll('[data-ans]').forEach(b=>{b.disabled=true;b.classList.remove('sel');});
        btn.classList.add('sel');
        renderMain(ST,myTeam,tc);
      });
    });
  }
}

// â”€â”€ LIVE TIMER INTERVAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(()=>{if(ST&&ST.timerRunning)renderTimer(ST);},350);
</script>
</body>
</html>
